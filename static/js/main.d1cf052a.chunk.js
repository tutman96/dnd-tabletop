(this["webpackJsonpdnd-tt"]=this["webpackJsonpdnd-tt"]||[]).push([[0],{138:function(e,t,n){e.exports=n(228)},228:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(39),i=n.n(c),o=n(8),l=n(48),u=n(24),s=n(5),f=n(7),b=n(9),d=n(2),m=n(69),p=n(6),v=n(29),h=n(134),O=n(248),g=n(249),E=n(272),y=n(262),j=n(270),x=n(41),k=n(246),w=n(263),S=n(264),L=n(265),A=n(71),D=n(14),C=n.n(D),N=n(33),T=n(25),I=n(271),P=n(145);function R(e){var t=new P({name:e});return{useAllValues:function(){var e=Object(a.useState)(),n=Object(b.a)(e,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){function e(){t.keys().then(function(){var e=Object(T.a)(C.a.mark((function e(n){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Map,e.next=3,Promise.all(n.map(function(){var e=Object(T.a)(C.a.mark((function e(n){var r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getItem(n);case 2:r=e.sent,a.set(n,r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:c(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}e();var n=t.subscribe(e);return function(){n.unsubscribe()}}),[]),r},useOneValue:function(e){var n=Object(a.useState)(void 0),r=Object(b.a)(n,2),c=r[0],i=r[1];return Object(a.useEffect)((function(){t.getItem(e).then((function(e){i(e||null)}));var n=t.subscribe(e,(function(e){return i(e)}));return function(){n.unsubscribe()}}),[e]),[c,function(){var n=Object(T.a)(C.a.mark((function n(a){return C.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(a),n.next=3,t.setItem(e,a);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()]},createItem:function(e,n){t.setItem(e,n)},deleteItem:function(){var e=Object(T.a)(C.a.mark((function e(n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.removeItem(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),storage:t}}var M=n(32),z=n(121),U=n.n(z);function F(e){return new Promise((function(t){var n=new Image;n.src=URL.createObjectURL(e),n.onload=function(){t({width:n.width,height:n.height})}}))}function G(e){return new Promise((function(t){var n=document.createElement("video");n.src=URL.createObjectURL(e),n.addEventListener("loadedmetadata",(function(){t({width:n.videoWidth,height:n.videoHeight})}))}))}var _,B=R("asset_file").storage;function V(){var e=document.createElement("input");return e.type="file",e.multiple=!0,e.accept="image/*,video/*",e.click(),new Promise((function(t){e.onchange=function(){var e=Object(T.a)(C.a.mark((function e(n){var a,r,c,i;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.target.files){e.next=3;break}return e.abrupt("return");case 3:r=new Array,c=0;case 5:if(!(c<a.length)){e.next=17;break}if(i=a.item(c)){e.next=9;break}return e.abrupt("continue",14);case 9:return e.t0=r,e.next=12,X(i);case 12:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 14:c++,e.next=5;break;case 17:t(r);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}))}function X(e){return W.apply(this,arguments)}function W(){return(W=Object(T.a)(C.a.mark((function e(t){var n,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={id:Object(I.a)(),type:_.IMAGE,transform:{x:0,y:0,width:0,height:0,rotation:0}},0!==t.type.indexOf("image")){e.next=8;break}return e.next=4,F(t);case 4:a=e.sent,n.type=_.IMAGE,e.next=16;break;case 8:if(0!==t.type.indexOf("video")){e.next=15;break}return e.next=11,G(t);case 11:a=e.sent,n.type=_.VIDEO,e.next=16;break;case 15:throw new Error("Unknown file type");case 16:return n.size={width:a.width,height:a.height},n.transform.width=a.width,n.transform.height=a.height,e.next=21,B.setItem(n.id,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return H.apply(this,arguments)}function H(){return(H=Object(T.a)(C.a.mark((function e(t){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.removeItem(t.id);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.IMAGE=0]="IMAGE",e[e.VIDEO=1]="VIDEO"}(_||(_={}));var Z=new U.a({max:524288e3,length:function(e){return e?e.file.size:0},maxAge:36e5});function q(e){return K.apply(this,arguments)}function K(){return(K=Object(T.a)(C.a.mark((function e(t){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=new FileReader,a=document.createElement("img");n.onload=function(){n.result&&(a.src=n.result,e(a))},n.readAsDataURL(t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(T.a)(C.a.mark((function e(t){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("video")).src=URL.createObjectURL(t),n.loop=!0,n.muted=!0,n.autoplay=!0,n.play(),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $,ee=n(17),te=n(122),ne=n(233);function ae(){var e=Object(o.a)(["padding: ",";"]);return ae=function(){return e},e}function re(){var e=Object(o.a)(["\n            display: flex; \n            align-items: center;\n          "]);return re=function(){return e},e}function ce(){var e=Object(o.a)(["\n            display: flex; \n            align-items: center;\n          "]);return ce=function(){return e},e}function ie(){var e=Object(o.a)(["margin: 0 ",";"]);return ie=function(){return e},e}!function(e){e.DISPLAYED_SCENE="displayed_scene",e.TABLE_FREEZE="table_freeze",e.TABLE_RESOLUTION="table_resolution",e.TABLE_SIZE="table_size",e.PLAY_AUDIO_ON_TABLE="play_audio_on_table"}($||($={}));var oe=R("settings");function le(){return oe}var ue=le().useOneValue;function se(){var e=ue($.TABLE_RESOLUTION),t=Object(b.a)(e,2),n=t[0],a=t[1];return null===n?[{width:1920,height:1080},a]:[n,a]}function fe(){var e=ue($.TABLE_SIZE),t=Object(b.a)(e,2),n=t[0],a=t[1];return null===n?[45,a]:[n,a]}function be(){var e=ue($.PLAY_AUDIO_ON_TABLE),t=Object(b.a)(e,2),n=t[0],a=t[1];return null===n?[!1,a]:[n,a]}function de(){var e=se(),t=Object(b.a)(e,1)[0],n=fe(),a=Object(b.a)(n,1)[0];if(!t||!a)return null;var r=Math.atan(t.height/t.width),c=a*Math.cos(r);return t.width/c}var me=function(){var e=Object(s.b)(),t=se(),n=Object(b.a)(t,2),a=n[0],c=n[1],i=fe(),o=Object(b.a)(i,2),l=o[0],u=o[1],d=be(),m=Object(b.a)(d,2),h=m[0],O=m[1],g=Object(f.a)(ie(),e.spaces.sm);return void 0===a||void 0===l?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{variant:"h6"},"TV/Table Display Settings"),r.a.createElement(E.c,{label:"Resolution"},r.a.createElement("div",{className:Object(f.a)(ce())},r.a.createElement(E.b,{type:"number",min:1,placeholder:"width",value:a.width,onChange:function(e){var t=Number(e.target.value);isNaN(t)||c(Object(p.a)(Object(p.a)({},a),{},{width:t}))}}),r.a.createElement("div",{className:g},"x"),r.a.createElement(E.b,{type:"number",min:1,placeholder:"height",value:a.height,onChange:function(e){var t=Number(e.target.value);isNaN(t)||c(Object(p.a)(Object(p.a)({},a),{},{height:t}))}}))),r.a.createElement(E.c,{label:"Screen Size"},r.a.createElement("div",{className:Object(f.a)(re())},r.a.createElement(E.b,{type:"number",min:1,max:200,value:l,onChange:function(e){var t=Number(e.target.value);!isNaN(t)&&t<=200&&t>1&&u(t)}}),r.a.createElement("div",{className:g},"inches"))),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6"},"Other Settings"),r.a.createElement(E.a,{checked:h,disabled:void 0===h,onChange:function(e){O(e.target.checked)},label:"Play Audio on Table"}))},pe=function(){var e=Object(s.b)(),t=Object(a.useState)(!1),n=Object(b.a)(t,2),c=n[0],i=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(te.a,{content:"Settings",placement:"right"},r.a.createElement(h.b,{variant:"ghost",color:e.colors.text.muted,size:"lg",icon:r.a.createElement(ne.a,null),label:"Settings",onClick:function(){return i(!0)}})),r.a.createElement(j.a,{isOpen:c,onRequestClose:function(){return i(!1)},title:"Settings"},r.a.createElement("div",{className:Object(f.a)(ae(),e.spaces.lg)},r.a.createElement(me,null))))},ve=function(e){var t=e.rectTransform,n=e.onTransform,c=e.isSelected,i=e.onSelected,o=e.snapOffset,l=e.children,u=e.rotateEnabled,f=e.scaleEnabled,b=e.skewEnabled,d=e.strokeEnabled,m=Object(s.b)(),p=Object(a.useRef)(),v=Object(a.useRef)(),h=de();return Object(a.useEffect)((function(){var e,t,n;c&&(null===(e=v.current)||void 0===e||e.setNodes([p.current]),null===(t=v.current)||void 0===t||null===(n=t.getLayer())||void 0===n||n.batchDraw())}),[c]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.Group,{ref:p,onMouseDown:function(e){var t;0===e.evt.button&&c&&(null===(t=p.current)||void 0===t||t.startDrag(e),e.cancelBubble=!0)},x:t.x,y:t.y,height:t.height,width:t.width,rotation:t.rotation,onClick:function(e){0===e.evt.button&&(e.cancelBubble=!0,i())},onDragEnd:function(e){var t=p.current,a=t.scaleX(),r=t.scaleY(),c=Math.round(100*t.rotation())/100,i=e.target.x(),l=e.target.y();if(o&&h&&c%90===0){var u=o.x%h,s=o.y%h;i=Math.round((i+u)/h)*h-u,l=Math.round((l+s)/h)*h-s,e.target.x(i),e.target.y(l)}n({x:i,y:l,rotation:c,width:t.width()*a,height:t.height()*r})},onTransformEnd:function(e){var t=p.current,a=t.scaleX(),r=t.scaleY(),c=t.rotation();t.scaleX(1),t.scaleY(1),n({x:t.x(),y:t.y(),rotation:c,width:t.width()*a,height:t.height()*r})}},l),c&&r.a.createElement(ee.Transformer,{rotateEnabled:u,resizeEnabled:f,enabledAnchors:!1===b?["top-left","top-right","bottom-left","bottom-right"]:void 0,ref:v,borderStrokeWidth:!1===d?0:void 0,anchorFill:m.colors.background.overlay,anchorStroke:m.colors.palette.blue.light,rotationSnaps:[0,45,90,135,180,225,270,315],rotateAnchorOffset:20}))},he=function(e){var t=e.asset,n=e.onUpdate,c=e.selected,i=e.onSelected,o=e.playAudio,l=function(e){var t=Object(a.useState)(Z.get(e.id)),n=Object(b.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){void 0===r&&B.getItem(e.id).then(function(){var t=Object(T.a)(C.a.mark((function t(n){var a,r;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.type===_.IMAGE?q(n):J(n);case 2:a=t.sent,r={file:n,element:a},Z.set(e.id,r),c(r);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[r,e.type,e.id]),null===r?null:null===r||void 0===r?void 0:r.element}(t);Object(a.useEffect)((function(){if(t.type===_.VIDEO&&l)return l.muted=!o,function(){l.muted=!0}}),[t,o,l]);var u=t.calibration?t.calibration.xOffset*(t.transform.width/t.size.width):0,s=t.calibration?t.calibration.yOffset*(t.transform.height/t.size.height):0;return r.a.createElement(ve,{isSelected:c,onSelected:i,rectTransform:t.transform,snapOffset:t.snapToGrid?{x:u,y:s}:void 0,onTransform:function(e){n(Object(p.a)(Object(p.a)({},t),{},{transform:e}))}},l&&r.a.createElement(ee.Image,{image:l,width:t.transform.width,height:t.transform.height}))},Oe=n(59),ge=n.n(Oe),Ee=n(257),ye=n(55),je={Delete:"\u232b"},xe=function(e){var t=e.label,n=e.icon,c=e.keyboardShortcuts,i=Object(ye.a)(e,["label","icon","keyboardShortcuts"]);return Object(a.useEffect)((function(){if(c&&i.onClick){var e=function(e){var t;c.includes(e.key)&&"INPUT"!==(null===(t=window.document.activeElement)||void 0===t?void 0:t.tagName)&&i.onClick(e)};return window.addEventListener("keyup",e),function(){return window.removeEventListener("keyup",e)}}}),[c,i.onClick]),r.a.createElement(x.a,Object.assign({},i,{variant:"ghost",iconBefore:n,size:"md"}),t+(c&&c.length?" (".concat(je[c[0]]||c[0],")"):""))},ke=n(77);function we(){var e=Object(o.a)(["\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 0; left: 0; right: 0;\n\t\t\t\tmin-height: 40px;\n\t\t\t\tbackground-color: ",";\n\t\t\t\tbox-shadow: ",";\n\t\t\t\tz-index: 100;\n\t\t\t\t> span {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t}\n\t\t\t"]);return we=function(){return e},e}var Se=function(e){var t=e.children,n=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(we(),n.colors.background.tint1,n.shadows.md)},t)},Le=Object(ke.a)([void 0,function(){}],(function(){return Object(a.useState)(void 0)})),Ae=function(e){var t=e.children,n=Le(),c=Object(b.a)(n,1)[0];return Object(a.useEffect)((function(){c&&i.a.render(r.a.createElement(s.a,null,t),c)}),[t,c]),Object(a.useEffect)((function(){if(c)return function(){i.a.unmountComponentAtNode(c)}}),[c]),null},De=function(e){var t=e.children,n=Object(a.useRef)(),c=Le(),i=Object(b.a)(c,2)[1];return Object(a.useEffect)((function(){i(n.current)}),[n,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Se,null,r.a.createElement("span",{ref:n})),t)},Ce=n(242),Ne=n(234),Te=n(235);function Ie(){var e=Object(o.a)(["\n            display: flex; \n            align-items: center;\n          "]);return Ie=function(){return e},e}function Pe(){var e=Object(o.a)(["\n            display: flex; \n            align-items: center;\n          "]);return Pe=function(){return e},e}function Re(){var e=Object(o.a)(["margin: 0 ",";"]);return Re=function(){return e},e}var Me=function(e){var t=e.calibration,n=e.onUpdate,c=Object(s.b)(),i=Object(f.a)(Re(),c.spaces.sm);function o(e,a){var r=Number(a.target.value);if(!isNaN(r)){var c,i=Object(p.a)({},t),o=Object(N.a)(e);try{for(o.s();!(c=o.n()).done;){i[c.value]=r}}catch(l){o.e(l)}finally{o.f()}n(i)}}var l=Object(a.useState)(t.ppiX===t.ppiY),u=Object(b.a)(l,2),d=u[0],m=u[1];return Object(a.useEffect)((function(){d&&t.ppiX!==t.ppiY&&m(!1)}),[t,n,d]),r.a.createElement(r.a.Fragment,null,r.a.createElement(E.c,{label:"Pixels per Inch"},r.a.createElement("div",{className:Object(f.a)(Pe())},r.a.createElement(E.b,{type:"number",min:1,placeholder:"Horizontal PPI",value:t.ppiX,onChange:function(e){return o(d?["ppiX","ppiY"]:["ppiX"],e)}}),r.a.createElement("div",{className:i},r.a.createElement(h.b,{variant:"ghost",label:d?"Unlock PPI":"Lock PPI",icon:d?r.a.createElement(Ne.a,null):r.a.createElement(Te.a,null),onClick:function(){t.ppiX!==t.ppiY&&n(Object(p.a)(Object(p.a)({},t),{},{ppiY:t.ppiX})),m(!d)}})),r.a.createElement(E.b,{type:"number",min:1,placeholder:"Vertical PPI",value:d?t.ppiX:t.ppiY,disabled:d,onChange:function(e){return o(["ppiY"],e)}}))),r.a.createElement(E.c,{label:"Offset"},r.a.createElement("div",{className:Object(f.a)(Ie())},r.a.createElement(E.b,{type:"number",placeholder:"Horizontal Offset",value:t.xOffset,onChange:function(e){return o(["xOffset"],e)}}),r.a.createElement("div",{className:i},"x"),r.a.createElement(E.b,{type:"number",placeholder:"Vertical Offset",value:t.yOffset,onChange:function(e){return o(["yOffset"],e)}}))))},ze=n(236),Ue=n(237),Fe=n(238),Ge=n(232),_e=n(239),Be=n(240),Ve=n(241);function Xe(){var e=Object(o.a)(["\n          ",";\n          flex-direction: column;\n          margin-top: ",";\n          border-radius: ",";\n        "]);return Xe=function(){return e},e}function We(){var e=Object(o.a)(["\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: space-between;\n            height: 100%;\n          "]);return We=function(){return e},e}function Ye(){var e=Object(o.a)(["\n          ",";\n          border-radius: 50%;\n          width: ","px;\n          height: ","px;\n          align-items: center;\n          justify-content: space-between;\n          overflow: hidden;\n        "]);return Ye=function(){return e},e}function He(){var e=Object(o.a)(["\n        position: relative;\n        float: right;\n        z-index: 1;\n        padding: ",";\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      "]);return He=function(){return e},e}function Ze(){var e=Object(o.a)(["\n    width: "," !important;\n    height: "," !important;\n  "]);return Ze=function(){return e},e}function qe(){var e=Object(o.a)(["\n    display: flex;\n    background-color: ",";\n    box-shadow: ",";\n  "]);return qe=function(){return e},e}var Ke=function(e){var t=e.onActivateRepeat,n=Object(ye.a)(e,["onActivateRepeat"]),c=Object(a.useState)(!1),i=Object(b.a)(c,2),o=i[0],l=i[1];return Object(a.useEffect)((function(){if(o&&t){var e,n=Date.now();return e=requestAnimationFrame((function a(){var r=(Date.now()-n)/200;r>100&&(r=100),t(r),e=requestAnimationFrame(a)})),function(){return cancelAnimationFrame(e)}}}),[o,t]),r.a.createElement(h.b,Object.assign({variant:"ghost"},n,{onMouseDown:function(){return l(!0)},onMouseUp:function(){return l(!1)}}))},Je=function(e){var t=e.onPanZoom,n=e.onHome,a=Object(s.b)(),c=Object(f.a)(qe(),a.colors.background.layer,a.shadows.md),i=Object(f.a)(Ze(),a.spaces.lg,a.spaces.lg);return r.a.createElement("div",{className:Object(f.a)(He(),a.spaces.md)},r.a.createElement("div",{className:Object(f.a)(Ye(),c,75,75)},r.a.createElement(Ke,{label:"Pan Left",size:"lg",icon:r.a.createElement(ze.a,null),onActivateRepeat:function(e){return t({x:-e,y:0,z:0})},className:i}),r.a.createElement("div",{className:Object(f.a)(We())},r.a.createElement(Ke,{label:"Pan Up",size:"lg",icon:r.a.createElement(Ue.a,null),onActivateRepeat:function(e){return t({x:0,y:-e,z:0})},className:i}),r.a.createElement(Ke,{label:"Home",size:"sm",icon:r.a.createElement(Fe.a,null),onClick:n,className:i}),r.a.createElement(Ke,{label:"Pan Down",size:"lg",icon:r.a.createElement(Ge.a,null),onActivateRepeat:function(e){return t({x:0,y:e,z:0})},className:i})),r.a.createElement(Ke,{label:"Pan Right",size:"lg",icon:r.a.createElement(_e.a,null),onActivateRepeat:function(e){return t({x:e,y:0,z:0})},className:i})),r.a.createElement("div",{className:Object(f.a)(Xe(),c,a.spaces.md,a.radii.sm)},r.a.createElement(Ke,{variant:"ghost",size:"sm",icon:r.a.createElement(Be.a,null),label:"Zoom In",onActivateRepeat:function(e){return t({x:0,y:0,z:e})}}),r.a.createElement(Ke,{variant:"ghost",size:"sm",icon:r.a.createElement(Ve.a,null),label:"Zoom Out",onActivateRepeat:function(e){return t({x:0,y:0,z:-e})}})))};function Qe(){var e=Object(o.a)(["\t\t\t\t\n\t\t\t\tbackground-color: ",";\n\t\t\t\tbackground-image: linear-gradient(45deg, "," 25%, transparent 25%, transparent 75%, "," 75%, ","),\n\t\t\t\tlinear-gradient(45deg, "," 25%, transparent 25%, transparent 75%, "," 75%, ",");\n\t\t\t\tbackground-size: 20px 20px;\n\t\t\t\tbackground-position: 0 0, 10px 10px;\n\t\t\t\twidth: ","px;\n\t\t\t\theight: ","px;\n\t\t\t"]);return Qe=function(){return e},e}var $e=function(e){var t=e.initialZoom,n=void 0===t?1:t,c=e.width,i=e.height,o=e.className,l=e.children,u=Object(s.b)(),b=Object(a.useRef)(),d=Object(a.useCallback)((function(e){if(1!==e&&b.current){var t=b.current,n=t.getSize(),a=n.width/2,r=n.height/2,c=t.scaleX(),i=(a-t.x())/c,o=(r-t.y())/c,l=e>0?c*e:c/-e;t.scale({x:l,y:l}),t.setPosition({x:a-i*l,y:r-o*l})}}),[b]);Object(a.useEffect)((function(){var e=function(e){var t,n="Equal"===e.code,a="Minus"===e.code;(e.ctrlKey||e.metaKey)&&(n||a)&&(e.preventDefault(),d(n?1.15:-1.15),null===(t=b.current)||void 0===t||t.batchDraw())};return window.document.addEventListener("keydown",e),function(){window.document.removeEventListener("keydown",e)}}),[b,d]);var m=Object(a.useCallback)((function(e){if(b.current){d(Math.abs(1+.005*e.z));var t=b.current,n=t.x(),a=t.y(),r=n-2*e.x,c=a-2*e.y;t.position({x:r,y:c}),t.batchDraw()}}),[b,d]),p=Object(a.useCallback)((function(){b.current&&(b.current.position({x:0,y:0}),b.current.scale({x:n,y:n}),b.current.batchDraw())}),[b,n]);return Object(a.useEffect)((function(){b.current&&(b.current.scale({x:n,y:n}),b.current.batchDraw())}),[b]),r.a.createElement("div",{className:Object(f.b)(Object(f.a)(Qe(),u.colors.background.tint2,u.colors.background.tint1,u.colors.background.tint1,u.colors.background.tint1,u.colors.background.tint1,u.colors.background.tint1,u.colors.background.tint1,c,i),o)},r.a.createElement(Je,{onPanZoom:m,onHome:p}),r.a.createElement(ee.Stage,{ref:b,width:c,height:i,onMouseDown:function(e){var t;1!==e.evt.button&&2!==e.evt.button||(null===(t=b.current)||void 0===t||t.startDrag(e),e.cancelBubble=!0)},onWheel:function(e){e.evt.preventDefault();var t=-e.evt.deltaX,n=-e.evt.deltaY,a=0;e.evt.ctrlKey&&(a=n,n=0);var r=b.current,c=r.scaleX(),i=r.getPointerPosition();if(i){var o=(i.x-r.x())/c,l=(i.y-r.y())/c;if(0!==t||0!==n||0!==a){var u=1+.004*Math.abs(a),s=a<0?c/u:c*u;r.scale({x:s,y:s});var f={x:i.x-o*s+1*t,y:i.y-l*s+1*n};r.position(f),r.batchDraw()}}},onContextMenu:function(e){return e.evt.preventDefault(),!1}},l))},et=Object(ke.a)([!0,function(){}],(function(){return Object(a.useState)(!0)}));function tt(){var e=Object(s.b)(),t=et(),n=Object(b.a)(t,1)[0];return Object(p.a)(Object(p.a)({},e),{},{headerHeight:56,sceneListWidth:n?240:0,sidebarWidth:48,visualAssetSizerSize:650})}function nt(){var e=Object(o.a)(["\n        margin-left: -",";\n      "]);return nt=function(){return e},e}var at=function(e){var t=e.asset,n=e.onUpdate,a=tt();if(!de()||!t.calibration)return null;for(var c=Array(),i=1;i<3;i+=2)c.push({width:3*t.calibration.ppiX,height:1*t.calibration.ppiY,x:0,y:t.calibration.ppiY*i}),c.push({width:1*t.calibration.ppiX,height:3*t.calibration.ppiY,x:t.calibration.ppiX*i,y:0});return r.a.createElement($e,{width:a.visualAssetSizerSize,height:a.visualAssetSizerSize,className:Object(f.a)(nt(),a.spaces.lg),initialZoom:a.visualAssetSizerSize/t.size.width},r.a.createElement(ee.Layer,null,r.a.createElement(he,{asset:Object(p.a)(Object(p.a)({},t),{},{transform:Object(p.a)(Object(p.a)({},t.size),{},{rotation:0,x:0,y:0})}),onSelected:function(){},selected:!1,onUpdate:function(){},playAudio:!1})),r.a.createElement(ee.Layer,null,r.a.createElement(ve,{rectTransform:{width:3*t.calibration.ppiX,height:3*t.calibration.ppiY,x:t.calibration.xOffset,y:t.calibration.yOffset,rotation:0},rotateEnabled:!1,strokeEnabled:!1,isSelected:!0,onSelected:function(){},onTransform:function(e){n({ppiX:Math.round(e.width/3*100)/100,ppiY:Math.round(e.height/3*100)/100,xOffset:Math.round(100*e.x)/100,yOffset:Math.round(100*e.y)/100})}},r.a.createElement(ee.Rect,{x:0,y:0,width:3*t.calibration.ppiX,height:3*t.calibration.ppiY,strokeWidth:1,stroke:a.colors.palette.blue.base,strokeScaleEnabled:!1}),c.map((function(e,t){return r.a.createElement(ee.Rect,Object.assign({key:t},e,{strokeWidth:1,stroke:a.colors.palette.blue.base,strokeScaleEnabled:!1}))})))))};function rt(){var e=Object(o.a)(["\n                display: flex;\n                margin-top: ",";\n                justify-content: flex-end;\n              "]);return rt=function(){return e},e}function ct(){var e=Object(o.a)(["padding: ",";"]);return ct=function(){return e},e}var it,ot=function(e){var t=e.asset,n=e.onUpdate,c=Object(s.b)(),i=Object(a.useState)(!1),o=Object(b.a)(i,2),l=o[0],u=o[1],d=Object(a.useState)(),m=Object(b.a)(d,2),h=m[0],O=m[1];return Object(a.useEffect)((function(){t&&O(t.calibration||{ppiX:150,ppiY:150,xOffset:0,yOffset:0})}),[t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(xe,{label:"Calibrate Size",icon:r.a.createElement(Ce.a,null),onClick:function(){return u(!0)},disabled:!t}),h&&t&&r.a.createElement(j.a,{isOpen:l,onRequestClose:function(){return u(!1)},title:"Asset Calibration"},r.a.createElement("div",{className:Object(f.a)(ct(),c.spaces.lg)},r.a.createElement(v.a,{variant:"paragraph",muted:!0},"Drag the corners of the selection box to align with the existing grid on your map. Then drag the box to match the size of the grid squares."),r.a.createElement(at,{asset:Object(p.a)(Object(p.a)({},t),{},{calibration:h}),onUpdate:O}),r.a.createElement(Me,{calibration:h,onUpdate:O}),r.a.createElement("div",{className:Object(f.a)(rt(),c.spaces.lg)},r.a.createElement(x.a,{variant:"ghost",intent:"primary",onClick:function(){n(Object(p.a)(Object(p.a)({},t),{},{calibration:h})),u(!1)}},"Save")))))},lt=n(27),ut=n(128),st=n(250),ft=n(251),bt=n(247),dt=n(252),mt=n(253),pt=n(254),vt=n(129),ht=n(255),Ot=n(256);!function(e){e[e.ASSETS=0]="ASSETS",e[e.FOG=1]="FOG",e[e.TABLE_VIEW=2]="TABLE_VIEW"}(it||(it={}));var gt=it,Et=n(245),yt=n(243),jt=n(244);function xt(){var e=Object(o.a)(["\n          min-width: 2rem;\n          text-align: center;\n        "]);return xt=function(){return e},e}function kt(){var e=Object(o.a)(["\n        display: flex;\n        align-items: center;\n        padding: 0 ",";\n      "]);return kt=function(){return e},e}var wt=function(e){var t,n=e.zoom,a=e.onUpdate,c=Object(s.b)();return t=n<1?"1/".concat(+(1/n).toFixed(1),"x"):"".concat(+n.toFixed(1),"x"),r.a.createElement("div",{className:Object(f.a)(kt(),c.spaces.sm)},"Zoom:",r.a.createElement(h.b,{variant:"ghost",icon:r.a.createElement(yt.a,null),label:"Zoom Out",size:"sm",onClick:function(){var e=Math.round(n/1.5*100)/100;e>.95&&e<1.05&&(e=1),a(e)}}),r.a.createElement("div",{className:Object(f.a)(xt())},t),r.a.createElement(h.b,{variant:"ghost",icon:r.a.createElement(jt.a,null),label:"Zoom In",size:"sm",onClick:function(){var e=Math.round(1.5*n*100)/100;e>.95&&e<1.05&&(e=1),a(e)}}),1!==n&&r.a.createElement(x.a,{variant:"ghost",size:"xs",onClick:function(){a(1)}},"Reset Zoom"))},St={id:"TABLE_VIEW",name:"TV/Table View",type:gt.TABLE_VIEW,visible:!0},Lt=function(e){var t=e.layer,n=e.active,c=e.showBorder,i=e.showGrid,o=e.onUpdate,l=Object(s.b)(),u=se(),f=Object(b.a)(u,1)[0],d=de(),m=Object(a.useState)(t.options),v=Object(b.a)(m,2),h=v[0],O=v[1];Object(a.useEffect)((function(){O(t.options)}),[t.options,O]);var g=Object(a.useRef)(),E=Object(a.useRef)();Object(a.useEffect)((function(){var e,t,a;n&&(null===(e=E.current)||void 0===e||e.setNodes([g.current]),null===(t=E.current)||void 0===t||null===(a=t.getLayer())||void 0===a||a.batchDraw())}),[n]);var y=Object(a.useMemo)((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe,{icon:r.a.createElement(Et.a,null),label:"Reset View",onClick:function(){o(Object(p.a)(Object(p.a)({},t),{},{options:Object(p.a)(Object(p.a)({},t.options),{},{offset:{x:0,y:0},rotation:0,scale:1})}))}}),r.a.createElement(xe,{label:t.options.displayGrid?"Hide Grid":"Show Grid",icon:t.options.displayGrid?r.a.createElement(k.a,null):r.a.createElement(bt.a,null),onClick:function(){o(Object(p.a)(Object(p.a)({},t),{},{options:Object(p.a)(Object(p.a)({},t.options),{},{displayGrid:!t.options.displayGrid})}))}}),r.a.createElement(wt,{zoom:t.options.scale,onUpdate:function(e){t.options=Object(p.a)(Object(p.a)({},t.options),{},{scale:e}),o(t)}}))}),[t,o]),j=Object(a.useMemo)((function(){if(!f||!d)return null;var e=f.width/h.scale,t=f.height/h.scale,a=new Array;if(i){for(var c=Math.floor(h.offset.x/d)*d;c<=h.offset.x+e;c+=d)a.push({start:{x:c,y:h.offset.y},end:{x:c,y:h.offset.y+t}});for(var o=Math.floor(h.offset.y/d)*d;o<=h.offset.y+t;o+=d)a.push({start:{x:h.offset.x,y:o},end:{x:h.offset.x+e,y:o}})}return r.a.createElement(ee.Group,{clipFunc:function(n){n.beginPath(),n.rect(h.offset.x,h.offset.y,e,t),n.rotate(h.rotation),n.closePath()},opacity:h.displayGrid?1:n?.5:0},a.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement(ee.Line,{key:"l".concat(t),points:[e.start.x,e.start.y,e.end.x,e.end.y],stroke:l.colors.palette.gray.light,dash:[1,1],strokeWidth:1,strokeScaleEnabled:!1}),r.a.createElement(ee.Line,{key:"d".concat(t),points:[e.start.x,e.start.y,e.end.x,e.end.y],stroke:l.colors.palette.gray.dark,dash:[1,1],dashOffset:1,strokeWidth:1,strokeScaleEnabled:!1}))})))}),[i,h,n,f,d,l]);if(!f||null===d)return null;var x=f.width,w=f.height;return r.a.createElement(ee.Layer,{listening:n},n&&r.a.createElement(Ae,null,y),j,c||n?r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.Group,{ref:g,x:h.offset.x,y:h.offset.y,width:x,height:w,scaleX:1/h.scale,scaleY:1/h.scale,rotation:h.rotation,onMouseDown:function(e){var t;0===e.evt.button&&n&&(null===(t=g.current)||void 0===t||t.startDrag(e),e.cancelBubble=!0)},onDragMove:function(e){var t=g.current.rotation();O({offset:{x:e.target.x(),y:e.target.y()},rotation:t,displayGrid:h.displayGrid,scale:h.scale})},onDragEnd:function(){t.options=Object(p.a)({},h),o(t)},onTransform:function(){var e=g.current,t=1/e.scaleX();O(Object(p.a)(Object(p.a)({},h),{},{offset:{x:e.x(),y:e.y()},scale:t}))},onTransformEnd:function(){t.options=Object(p.a)({},h),o(t)}},r.a.createElement(ee.Rect,{width:x,height:w,stroke:n?l.colors.palette.blue.base:l.colors.palette.gray.light,dash:[10,10],strokeWidth:5,listening:n})),n&&r.a.createElement(ee.Transformer,{rotateEnabled:!1,resizeEnabled:!0,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],ref:E,borderStrokeWidth:0,anchorFill:l.colors.background.overlay,anchorStroke:l.colors.palette.blue.light})):null)};function At(){var e=Object(o.a)(["\n                display: flex;\n                margin-top: ",";\n                justify-content: flex-end;\n              "]);return At=function(){return e},e}function Dt(){var e=Object(o.a)(["padding: ",";"]);return Dt=function(){return e},e}var Ct=function(e){var t=e.layer,n=e.onUpdate,c=Object(s.b)(),i=Object(a.useState)(!1),o=Object(b.a)(i,2),l=o[0],u=o[1],d=Object(a.useState)(null===t||void 0===t?void 0:t.name),m=Object(b.a)(d,2),v=m[0],g=m[1];return Object(a.useEffect)((function(){t&&g(t.name)}),[t,l]),r.a.createElement(r.a.Fragment,null,r.a.createElement(h.b,{variant:"ghost",disabled:!t||t.id===St.id,icon:r.a.createElement(O.a,null),label:"Edit",onClick:function(){return u(!0)}}),t&&r.a.createElement(j.a,{isOpen:l,onRequestClose:function(){return u(!1)},title:"Edit Layer"},r.a.createElement("div",{className:Object(f.a)(Dt(),c.spaces.lg)},r.a.createElement(E.c,{label:"Name"},r.a.createElement(E.b,{placeholder:"Name",value:v,onChange:function(e){return g(e.target.value)}})),r.a.createElement("div",{className:Object(f.a)(At(),c.spaces.lg)},r.a.createElement(x.a,{variant:"ghost",intent:"primary",onClick:function(){v&&n(Object(p.a)(Object(p.a)({},t),{},{name:v})),u(!1)}},"Save")))))};function Nt(){var e=Object(o.a)(["\n                display: flex;\n                margin-top: ",";\n                justify-content: flex-end;\n              "]);return Nt=function(){return e},e}function Tt(){var e=Object(o.a)(["padding: ",";"]);return Tt=function(){return e},e}var It=function(e){var t=e.layer,n=e.onDelete,c=Object(s.b)(),i=Object(a.useState)(!1),o=Object(b.a)(i,2),l=o[0],u=o[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.b,{variant:"ghost",disabled:!t||t.id===St.id,color:c.colors.intent.danger.base,icon:r.a.createElement(g.a,null),label:"Delete",onClick:function(){return u(!0)}}),t&&r.a.createElement(j.a,{isOpen:l,onRequestClose:function(){return u(!1)},title:"Delete Layer"},r.a.createElement("div",{className:Object(f.a)(Tt(),c.spaces.lg)},r.a.createElement(v.a,{variant:"paragraph",muted:!0},"Are you sure you want to delete '",t.name,"'?"),r.a.createElement("div",{className:Object(f.a)(Nt(),c.spaces.lg)},r.a.createElement(x.a,{variant:"ghost",intent:"danger",onClick:function(){n(),u(!1)}},"Delete")))))};function Pt(){var e=Object(o.a)(["\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\t\tbackground-color: ",";\n\t\t\t\t\t\t"]);return Pt=function(){return e},e}function Rt(){var e=Object(o.a)(["\n\t\t\t\t\t\t\t\tbackground-color: "," !important;\n\t\t\t\t\t\t\t\tpadding: "," !important;\n\t\t\t\t\t\t\t"]);return Rt=function(){return e},e}function Mt(){var e=Object(o.a)(["\n\t\t\t\t\t\t\tbackground-color: "," !important;\n\t\t\t\t\t\t\tpadding: "," !important;\n\t\t\t\t\t\t"]);return Mt=function(){return e},e}function zt(){var e=Object(o.a)(["\n\t\t\t\t\t\tmax-height: 350px;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t\t"]);return zt=function(){return e},e}function Ut(){var e=Object(o.a)(["\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twidth: 300px;\n\t\t\t\t"]);return Ut=function(){return e},e}function Ft(){var e=Object(o.a)(["\n\t\t\t\tposition: absolute;\n\t\t\t\tright: ",";\n\t\t\t\tbottom: ",";\n\t\t\t"]);return Ft=function(){return e},e}var Gt=function(e){var t=e.scene,n=e.activeLayerId,a=e.setActiveLayer,c=e.updateLayer,i=e.addLayer,o=e.moveActiveLayer,l=e.deleteActiveLayer,u=t.layers.findIndex((function(e){return e.id===n})),b=u===t.layers.length-1,d=0===u,m=t.layers.find((function(e){return e.id===n})),O=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(Ft(),O.spaces.md,O.spaces.md)},r.a.createElement(ut.a,{className:Object(f.a)(Ut())},r.a.createElement(st.a,{className:Object(f.a)(zt())},r.a.createElement(st.b,{className:Object(f.a)(Mt(),n===St.id?O.colors.intent.primary.base:"initial",O.spaces.sm),contentBefore:r.a.createElement(h.b,{variant:"ghost",label:St.name,icon:r.a.createElement(ft.a,null),disabled:!0,size:"sm"}),primary:St.name,contentAfter:" ",onClick:function(){return a(St.id)}}),Array.from(t.layers).reverse().map((function(e){return r.a.createElement(st.b,{key:e.id,className:Object(f.a)(Rt(),m===e?O.colors.intent.primary.base:"initial",O.spaces.sm),contentBefore:r.a.createElement(h.b,{variant:"ghost",label:e.visible?"Hide Layer":"Show Layer",onClick:function(t){c(Object(p.a)(Object(p.a)({},e),{},{visible:!e.visible})),t.preventDefault()},icon:e.visible?r.a.createElement(bt.a,null):r.a.createElement(k.a,null),size:"sm"}),primary:e.name,contentAfter:r.a.createElement(v.a,{variant:"subtitle"},gt[e.type]),onClick:function(){return a(e.id)}})}))),r.a.createElement("div",{className:Object(f.a)(Pt(),O.colors.background.tint1)},r.a.createElement(It,{layer:m,onDelete:l}),r.a.createElement("div",null,r.a.createElement(h.b,{variant:"ghost",disabled:null===n||n===St.id||b,icon:r.a.createElement(dt.a,null),label:"Layer Up",onClick:function(){return o("up")}}),r.a.createElement(h.b,{variant:"ghost",disabled:null===n||n===St.id||d,icon:r.a.createElement(mt.a,null),label:"Layer Down",onClick:function(){return o("down")}}),r.a.createElement(Ct,{layer:m,onUpdate:c})),r.a.createElement(pt.a,{placement:"top-end",content:r.a.createElement(vt.c,null,r.a.createElement(vt.a,{contentBefore:r.a.createElement(ht.a,null),onPress:function(){return i(gt.ASSETS)}},"Asset Layer"),r.a.createElement(vt.a,{contentBefore:r.a.createElement(Ot.a,null),onPress:function(){return i(gt.FOG)}},"Fog Layer (beta)"))},r.a.createElement(h.b,{variant:"ghost",icon:r.a.createElement(Be.a,null),label:"Add Layer"})))))},_t=n(132),Bt=n.n(_t);function Vt(){var e=Object(o.a)(["\n\t\t\t\tflex-grow: 2;\n\t\t\t\twidth: calc(100vw - ","px);\n\t\t\t\theight: calc(100vh - ","px);\n\t\t\t"]);return Vt=function(){return e},e}var Xt=r.a.createContext(null);function Wt(e){if(e.current){var t=e.current.parent,n=t.getAbsolutePosition(),a=t.getSize(),r=t.getAbsoluteScale();return{x:(-n.x+a.width/2)/r.x,y:(-n.y+a.height/2)/r.y}}return{x:0,y:0}}var Yt=function(e){var t=e.scene,n=e.onUpdate,c=tt(),i=Object(a.useState)(null),o=Object(b.a)(i,2),l=o[0],u=o[1],s=Object(a.useRef)(),d=Bt()(s),m=se(),v=Object(b.a)(m,1)[0];Object(a.useEffect)((function(){l!==St.id&&(null!==l&&t.layers.some((function(e){return e.id===l}))||!t.layers.length||u(t.layers[0].id))}),[l,t]);var h=Object(a.useCallback)((function(e){var a=t.layers.findIndex((function(t){return t.id===e.id}));t.layers[a]=e,n(Object(p.a)({},t))}),[t,n]);function O(){return(O=Object(T.a)(C.a.mark((function e(){var a,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.layers.find((function(e){return e.id===l})))){e.next=7;break}return e.next=4,gn(t,a);case 4:r=e.sent,n(Object(p.a)(Object(p.a)({},r),{},{layers:Object(lt.a)(r.layers)})),u(null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=v?Math.min(d.height/v.height,d.width/v.width):1;return r.a.createElement("div",{ref:s,className:Object(f.a)(Vt(),c.sceneListWidth+c.sidebarWidth,c.headerHeight)},0!==d.height&&v?r.a.createElement(De,null,r.a.createElement($e,{width:d.width||1,height:d.height||1,initialZoom:g},r.a.createElement(Xt.Provider,{value:t},t.layers.map((function(e){var t=hn[e.type];return t&&!1!==e.visible?r.a.createElement(t,{key:e.id,layer:e,isTable:!1,onUpdate:h,active:l===e.id}):null})),r.a.createElement(Lt,{layer:Object(p.a)(Object(p.a)({},St),{},{options:t.table}),isTable:!1,active:l===St.id,onUpdate:function(e){n(Object(p.a)(Object(p.a)({},t),{},{table:e.options}))},showBorder:!0,showGrid:!0})))):null,r.a.createElement(Gt,{scene:t,activeLayerId:l,setActiveLayer:u,updateLayer:function(e){var a=t.layers.findIndex((function(t){return t.id===e.id}));t.layers[a]=e,n(Object(p.a)(Object(p.a)({},t),{},{layers:Object(lt.a)(t.layers)}))},addLayer:function(e){var a=On(e);a.name="Layer "+(t.layers.length+1),t.layers.push(a),u(a.id),n(Object(p.a)({},t))},editActiveLayerName:function(e){var a=t.layers.find((function(e){return e.id===l}));a&&(a.name=e,n(Object(p.a)(Object(p.a)({},t),{},{layers:Object(lt.a)(t.layers)})))},moveActiveLayer:function(e){var a=t.layers.findIndex((function(e){return e.id===l}));if(-1!==a){var r="up"===e?a+1:a-1;if(r>t.layers.length-1||r<0)return;var c=t.layers[a],i=t.layers[r];t.layers[r]=c,t.layers[a]=i,n(Object(p.a)(Object(p.a)({},t),{},{layers:Object(lt.a)(t.layers)}))}},deleteActiveLayer:function(){return O.apply(this,arguments)}}))};function Ht(){var e=Object(o.a)(["flex-grow: 2;"]);return Ht=function(){return e},e}var Zt=function(e){var t=e.layer,n=e.onUpdate,c=e.active,i=e.isTable,o=Object(a.useState)(null),l=Object(b.a)(o,2),u=l[0],s=l[1],d=Object(a.useRef)(),m=de(),v=be(),h=Object(b.a)(v,1)[0],O=Object(a.useCallback)(Object(T.a)(C.a.mark((function e(){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u||!t.assets.has(u)){e.next=7;break}return a=t.assets.get(u),t.assets.delete(u),e.next=5,Y(a);case 5:n(Object(p.a)({},t)),s(null);case 7:case"end":return e.stop()}}),e)}))),[u,t,n,s]);Object(a.useEffect)((function(){if(d.current&&Array.from(t.assets.values()).some((function(e){return e.type===_.VIDEO}))){var e=Date.now(),n=new ge.a.Animation((function(){var t=Date.now();if(!i&&t-e<100)return!1;e=t}),d.current);return n.start(),function(){n.stop()}}}),[d,t,i]),Object(a.useEffect)((function(){var e;if(null===(e=d.current)||void 0===e?void 0:e.parent){var t=d.current.parent;return t.on("click.konva",n),function(){t.off("click.konva",n)}}function n(){s(null)}}),[d,s]),Object(a.useEffect)((function(){c||null===u||s(null)}),[c,u]);var y=Object(a.useMemo)((function(){var e=Array.from(t.assets.values()).find((function(e){return e.id===u}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe,{icon:r.a.createElement(Ee.a,null),label:"Add Asset",onClick:Object(T.a)(C.a.mark((function e(){var a,r,c,i,o;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:a=e.sent,r=Wt(d),c=Object(N.a)(a);try{for(c.s();!(i=c.n()).done;)(o=i.value).transform.x=r.x-o.transform.width/2,o.transform.y=r.y-o.transform.height/2,t.assets.set(o.id,o)}catch(l){c.e(l)}finally{c.f()}n(Object(p.a)({},t));case 7:case"end":return e.stop()}}),e)})))}),r.a.createElement(ot,{asset:e,onUpdate:function(e){e.transform=function(e,t){return e.calibration?Object(p.a)(Object(p.a)({},e.transform),{},{width:e.size.width/e.calibration.ppiX*t,height:e.size.height/e.calibration.ppiY*t}):e.transform}(e,m),t.assets.set(e.id,e),n(Object(p.a)({},t))}}),r.a.createElement(E.a,{label:"Snap to Grid",disabled:!e,checked:!!(null===e||void 0===e?void 0:e.snapToGrid),onChange:function(a){e.snapToGrid=a.target.checked,n(Object(p.a)({},t))}}),r.a.createElement("div",{className:Object(f.a)(Ht())}),r.a.createElement(xe,{icon:r.a.createElement(g.a,null),label:"Delete Asset",disabled:null===u,onClick:O,keyboardShortcuts:["Delete","Backspace"]}))}),[t,d,m,u,n,O]);return r.a.createElement(r.a.Fragment,null,c&&r.a.createElement(Ae,null,y),r.a.createElement(ee.Layer,{ref:d,listening:c},Array.from(t.assets.values()).map((function(e){return r.a.createElement(he,{key:e.id,asset:e,selected:c&&u===e.id,onSelected:function(){return c&&s(e.id)},onUpdate:function(e){t.assets.set(e.id,e),n(Object(p.a)({},t))},playAudio:i&&!!h})}))))},qt=n(258),Kt=n(259),Jt=n(260),Qt=n(261);function $t(e){var t=Object(a.useState)(!1),n=Object(b.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){function t(t){t.key===e&&c(!0)}var n=function(t){t.key===e&&c(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[c,e]),r}var en,tn=function(e){var t=e.firstAnchor,n=e.position,c=e.onClick,i=e.onMove,o=e.onMoveEnd,l=Object(s.b)(),u=Object(a.useRef)();return r.a.createElement(ee.Shape,{x:n.x,y:n.y,ref:u,onMouseDown:function(e){var t;0===e.evt.button&&(null===(t=u.current)||void 0===t||t.startDrag(e),e.cancelBubble=!0)},onMouseUp:function(e){0===e.evt.button&&c()},sceneFunc:function(e,t){var n=7/t.getAbsoluteScale().x;e.beginPath(),e.ellipse(0,0,n,n,0,0,2*Math.PI,!1),e.closePath(),e.fillStrokeShape(t)},onDragMove:function(e){i({x:e.target.x(),y:e.target.y()},e),e.cancelBubble=!0},onDragEnd:function(e){return o()},stroke:l.colors.palette.blue.base,strokeWidth:3,strokeScaleEnabled:!1,fill:t?l.colors.palette.blue.base:void 0})};!function(e){e[e.FOG=0]="FOG",e[e.FOG_CLEAR=1]="FOG_CLEAR",e[e.LIGHT_OBSTRUCTION=2]="LIGHT_OBSTRUCTION"}(en||(en={}));var nn=function(e){var t=e.polygon,n=e.onUpdate,c=e.adding,i=e.onAdded,o=e.selectable,l=e.selected,u=e.onSelected,f=e.closed,d=Object(ye.a)(e,["polygon","onUpdate","adding","onAdded","selectable","selected","onSelected","closed"]),m=Object(s.b)(),p=Object(a.useRef)(),v=Object(a.useState)(t.verticies),h=Object(b.a)(v,2),O=h[0],g=h[1];Object(a.useEffect)((function(){g(t.verticies)}),[t.verticies]);var E=O.reduce((function(e,t){return Math.min(e,t.x)}),Number.MAX_VALUE),y=O.reduce((function(e,t){return Math.min(e,t.y)}),Number.MAX_VALUE),j=O.map((function(e){return[e.x-E,e.y-y]})).flat();Object(a.useEffect)((function(){if(p.current&&c){var e=p.current.parent.parent;e.container().style.cursor="crosshair";var a=function(a){if(0===a.evt.button&&p.current){var r=e.getAbsoluteTransform().copy();r.invert();var c=p.current.getStage().getPointerPosition(),o=r.point(c),l=O[0];f&&l&&i&&Math.sqrt(Math.pow(o.x-l.x,2)+Math.pow(o.y-l.y,2))<7/e.getAbsoluteScale().x?i():(t.verticies=[].concat(Object(lt.a)(O),[o]),n(t))}};return e.on("mouseup.konva",a),function(){e.off("mouseup.konva",a),e.container().style.cursor="default"}}}),[p,c,O,n,i,t,f]);var x=$t("Escape"),k=$t("Enter")||x;return Object(a.useEffect)((function(){c&&k&&i&&i()}),[c,k,i]),r.a.createElement(ee.Group,{ref:p,x:E,y:y,listening:o,onClick:function(e){0===e.evt.button&&u&&o&&(e.cancelBubble=!0,u())},onMouseDown:function(e){var t;0===e.evt.button&&l&&!c&&(null===(t=p.current)||void 0===t||t.startDrag(e))},onDragMove:function(e){var t=e.target.x(),n=e.target.y(),a=t-E,r=n-y;g(O.map((function(e){return{x:e.x+a,y:e.y+r}})))},onDragEnd:function(){t.verticies=O,n(t)}},r.a.createElement(ee.Line,Object.assign({},d,{closed:f,points:j})),l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.Line,{closed:f,stroke:m.colors.palette.blue.base,strokeWidth:3,dash:[4,4],strokeScaleEnabled:!1,points:j}),O.map((function(e,a){return r.a.createElement(tn,{key:a,position:{x:e.x-E,y:e.y-y},onClick:function(){c&&0===a&&i&&i()},onMove:function(e,t){var n={x:e.x+E,y:e.y+y};O[a]=n;var r=O.reduce((function(e,t){return Math.min(e,t.x)}),Number.MAX_VALUE),c=O.reduce((function(e,t){return Math.min(e,t.y)}),Number.MAX_VALUE),i={x:n.x-r,y:n.y-c};t.target.x(i.x),t.target.y(i.y),g(Object(lt.a)(O))},onMoveEnd:function(){t.verticies=O,n(t)},firstAnchor:f&&c&&0===a})}))))};function an(e,t){var n=e.a.x,a=e.a.y,r=e.b.x-e.a.x,c=e.b.y-e.a.y,i=t.a.x,o=t.a.y,l=t.b.x-t.a.x,u=t.b.y-t.a.y,s=Math.sqrt(r*r+c*c),f=Math.sqrt(l*l+u*u);if(r/s===l/f&&c/s===u/f)return null;var b=(r*(o-a)+c*(n-i))/(l*c-u*r),d=(i+l*b-n)/r;return d<0||b<0||b>1?null:{x:n+r*d,y:a+c*d,distance:d}}function rn(e){return e.brightLightDistance=void 0===e.brightLightDistance?4:e.brightLightDistance,e.dimLightDistance=void 0===e.dimLightDistance?8:e.dimLightDistance,e}var cn=function(e){var t=e.light,n=e.displayIcon,c=e.fogPolygons,i=e.obstructionPolygons,o=e.onUpdate,l=(e.isTable,e.selected),u=e.onSelected,f=Object(s.b)(),d=de()||86,m=Object(a.useRef)(),p=Object(a.useState)(t.position),v=Object(b.a)(p,2),h=v[0],O=v[1];Object(a.useEffect)((function(){O(t.position)}),[t.position,O]);var g=function(e,t){var n=e.x,a=e.x,r=e.y,c=e.y;return t.forEach((function(e){e.verticies.forEach((function(e){n=Math.min(n,e.x),a=Math.max(a,e.x),r=Math.min(r,e.y),c=Math.max(c,e.y)}))})),n-=10,r-=10,a+=10,c+=10,{type:en.LIGHT_OBSTRUCTION,verticies:[{x:n,y:r},{x:a,y:r},{x:a,y:c},{x:n,y:c},{x:n,y:r}],visibleOnTable:!0}}(h,c),E=rn(t),y=function(e,t){var n,a=new Array,r=new Array,c=Object(N.a)(t);try{for(c.s();!(n=c.n()).done;){var i=n.value;if(0!==i.verticies.length){var o,l=null,u=Object(N.a)(i.verticies);try{for(u.s();!(o=u.n()).done;){var s=o.value;a.push(s),l&&r.push({a:l,b:s}),l=s}}catch(k){u.e(k)}finally{u.f()}}}}catch(k){c.e(k)}finally{c.f()}for(var f=new Array,b=0;b<a.length;b++){var d=a[b],m=Math.atan2(d.y-e.y,d.x-e.x);d.angle=m,f.push(m-1e-5,m,m+1e-5)}for(var p=new Array,v=0;v<f.length;v++){for(var h=f[v],O=Math.cos(h),g=Math.sin(h),E={a:{x:e.x,y:e.y},b:{x:e.x+O,y:e.y+g}},y=null,j=0;j<r.length;j++){var x=an(E,r[j]);x&&((!y||x.distance<y.distance)&&(y=x))}y&&(y.angle=h,p.push(y))}return{type:en.FOG_CLEAR,visibleOnTable:!0,verticies:p.sort((function(e,t){return e.angle-t.angle}))}}(h,[].concat(Object(lt.a)(i.filter((function(e){return e.visibleOnTable}))),[g])).verticies.map((function(e){return[e.x,e.y]})).flat();m.current&&m.current.setZIndex(9999);var j=Math.max(0,Math.min(1,E.brightLightDistance/E.dimLightDistance));return isNaN(j)&&(j=0),r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.Line,{name:"Polygon",points:y,listening:!1,closed:!0,fillRadialGradientStartPoint:h,fillRadialGradientEndPoint:h,fillRadialGradientStartRadius:0,fillRadialGradientEndRadius:d*Math.max(E.brightLightDistance,E.dimLightDistance),fillRadialGradientColorStops:[0,"rgba(255,255,255,1)",j,"rgba(255,255,255,0.30)",1,"rgba(255,255,255,0)"],globalCompositeOperation:"destination-out"}),n&&r.a.createElement(ee.Shape,{name:"Icon",x:t.position.x,y:t.position.y,ref:m,onMouseDown:function(e){var t;0===e.evt.button&&l&&(null===(t=m.current)||void 0===t||t.startDrag(e),e.cancelBubble=!0)},sceneFunc:function(e,t){var n=10/t.getAbsoluteScale().x;e.beginPath(),e.ellipse(0,0,n,n,0,0,2*Math.PI,!1),e.closePath(),e.fillStrokeShape(t)},onDragMove:function(e){O({x:e.target.x(),y:e.target.y()})},onDragEnd:function(e){t.position={x:e.target.x(),y:e.target.y()},o(t)},onClick:function(e){0===e.evt.button&&(e.cancelBubble=!0,u())},fill:f.colors.palette.violet.lightest,strokeEnabled:l,stroke:l?f.colors.palette.blue.base:void 0,strokeWidth:5,strokeScaleEnabled:!1,dash:[2,2]}))};function on(){var e=Object(o.a)(["\n                display: flex;\n                margin-top: ",";\n                justify-content: flex-end;\n              "]);return on=function(){return e},e}function ln(){var e=Object(o.a)(["\n                    margin: 0 "," "," 0;\n                  "]);return ln=function(){return e},e}function un(){var e=Object(o.a)(["\n                padding: "," 0;\n                display: flex;\n                flex-direction: row;\n                flex-wrap: wrap;\n              "]);return un=function(){return e},e}function sn(){var e=Object(o.a)(["padding: ",";"]);return sn=function(){return e},e}var fn=[{name:"Torch / Light Spell",brightLightDistance:4,dimLightDistance:8},{name:"Lantern",brightLightDistance:6,dimLightDistance:12},{name:"Produce Flame Spell",brightLightDistance:2,dimLightDistance:4},{name:"Dancing Lights Spell",brightLightDistance:0,dimLightDistance:2},{name:"Daylight Spell",brightLightDistance:12,dimLightDistance:24}],bn=function(e){var t=e.light,n=e.onUpdate,c=Object(s.b)(),i=Object(a.useState)(!1),o=Object(b.a)(i,2),l=o[0],u=o[1],d=Object(a.useState)(t),m=Object(b.a)(d,2),h=m[0],O=m[1];function g(e,t){var n=Number(t.target.value);isNaN(n)||O(Object(p.a)(Object(p.a)({},h),{},Object(M.a)({},e,n/5)))}return Object(a.useEffect)((function(){O(t)}),[t,O]),r.a.createElement(r.a.Fragment,null,r.a.createElement(xe,{icon:r.a.createElement(Ce.a,null),label:"Configure",keyboardShortcuts:["r"],disabled:!t,onClick:function(){return u(!0)}}),h&&r.a.createElement(j.a,{isOpen:l,onRequestClose:function(){return u(!1)},title:"Configure Light"},r.a.createElement("div",{className:Object(f.a)(sn(),c.spaces.lg)},r.a.createElement(v.a,{variant:"lead"},"Predefined Lights"),r.a.createElement("div",{className:Object(f.a)(un(),c.spaces.md)},fn.map((function(e){return r.a.createElement(x.a,{key:e.name,variant:"outline",size:"sm",className:Object(f.a)(ln(),c.spaces.sm,c.spaces.sm),intent:e.brightLightDistance===h.brightLightDistance&&e.dimLightDistance===h.dimLightDistance?"primary":"none",onClick:function(){O(Object(p.a)(Object(p.a)({},h),{},{brightLightDistance:e.brightLightDistance,dimLightDistance:e.dimLightDistance}))}},e.name)}))),r.a.createElement(v.a,{variant:"lead"},"Parameters"),r.a.createElement(E.c,{label:"Bright Light Distance (ft)"},r.a.createElement(E.b,{type:"number",value:5*h.brightLightDistance+"",onChange:function(e){return g("brightLightDistance",e)},min:0})),r.a.createElement(E.c,{label:"Dim Light Distance (ft)"},r.a.createElement(E.b,{type:"number",value:5*h.dimLightDistance+"",onChange:function(e){return g("dimLightDistance",e)},min:0})),r.a.createElement("div",{className:Object(f.a)(on(),c.spaces.lg)},r.a.createElement(x.a,{variant:"ghost",intent:"primary",onClick:function(){n(Object(p.a)({},h)),u(!1)}},"Save")))))};function dn(){var e=Object(o.a)(["\n        filter: blur(","px);\n      "]);return dn=function(){return e},e}function mn(){var e=Object(o.a)(["flex-grow: 2;"]);return mn=function(){return e},e}var pn,vn=function(e){var t,n=e.layer,c=e.isTable,i=e.onUpdate,o=e.active,l=Object(s.b)(),u=Object(a.useRef)(),d=de(),m=Object(a.useState)(null),v=Object(b.a)(m,2),h=v[0],O=v[1],E=Object(a.useState)(null),y=Object(b.a)(E,2),j=y[0],x=y[1],w=Object(a.useState)(null),S=Object(b.a)(w,2),L=S[0],A=S[1],D=(t={},Object(M.a)(t,en.FOG,n.fogPolygons),Object(M.a)(t,en.FOG_CLEAR,n.fogClearPolygons),Object(M.a)(t,en.LIGHT_OBSTRUCTION,n.obstructionPolygons),t);Object(a.useEffect)((function(){o||(x(null),O(null),A(null))}),[o,x,O,A]),Object(a.useEffect)((function(){var e;if((null===(e=u.current)||void 0===e?void 0:e.parent)&&!h){var t=u.current.parent;return t.on("click",n),function(){t.off("click",n)}}function n(e){0===e.evt.button&&(A(null),x(null))}}),[u,h,x,A]);var C=Object(a.useMemo)((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe,{label:"Add Fog",icon:r.a.createElement(qt.a,null),keyboardShortcuts:["a"],onClick:function(){var e={verticies:[],type:en.FOG,visibleOnTable:!0};x(e),O(e),A(null)}}),r.a.createElement(xe,{label:"Add Fog Clear",icon:r.a.createElement(Kt.a,null),keyboardShortcuts:["s"],onClick:function(){var e={verticies:[],type:en.FOG_CLEAR,visibleOnTable:!0};x(e),O(e),A(null)}}),r.a.createElement(xe,{label:"Add Light",icon:r.a.createElement(Jt.a,null),onClick:function(){var e={position:Wt(u)};n.lightSources.push(e),A(e),i(Object(p.a)({},n))},keyboardShortcuts:["e"]}),r.a.createElement(xe,{label:"Add Wall",icon:r.a.createElement(Qt.a,null),onClick:function(){var e={verticies:[],type:en.LIGHT_OBSTRUCTION,visibleOnTable:!0};x(e),O(e),A(null)},keyboardShortcuts:["w"]}),r.a.createElement(xe,{label:j&&j.visibleOnTable?"Hide on Table":"Show on Table",disabled:!j,icon:j&&j.visibleOnTable?r.a.createElement(k.a,null):r.a.createElement(bt.a,null),keyboardShortcuts:["d"],onClick:function(){j&&(j.visibleOnTable=!j.visibleOnTable,i(Object(p.a)({},n)))}}),r.a.createElement(bn,{light:L,onUpdate:function(e){var t=n.lightSources.indexOf(L);n.lightSources[t]=e,A(e),i(Object(p.a)({},n))}}),r.a.createElement("div",{className:Object(f.a)(mn())}),r.a.createElement(xe,{icon:r.a.createElement(g.a,null),label:"Delete",disabled:null===j&&null===L,onClick:function(){if(j){var e=D[j.type],t=e.indexOf(j);-1!==t&&e.splice(t,1),i(Object(p.a)({},n)),x(null)}else if(L){var a=n.lightSources.indexOf(L);-1!==a&&n.lightSources.splice(a,1),i(Object(p.a)({},n)),A(null)}},keyboardShortcuts:["Delete","Backspace"]}))}),[j,L,n,i,D,u]);Object(a.useEffect)((function(){c&&u.current&&d&&(u.current.canvas._canvas.className=Object(f.a)(dn(),.05*d))}),[u,c,d]);var N=Object(a.useCallback)((function(){if(h){var e=D[h.type];if(h.type!==en.LIGHT_OBSTRUCTION&&(null===h||void 0===h?void 0:h.verticies)&&h.verticies.length<3)return console.log("removing polygon because < 3 verticies"),O(null),void x(null);O(null),x(null),e.push(h),i(Object(p.a)({},n))}}),[O,n,i,h,D]),T=Object(a.useCallback)((function(){i(Object(p.a)({},n))}),[i,n]),I=Object(a.useCallback)((function(e){if(c)switch(e.type){case en.FOG:return{fill:"black",closed:!0};case en.FOG_CLEAR:return{fill:"black",globalCompositeOperation:"destination-out",closed:!0};case en.LIGHT_OBSTRUCTION:return{closed:!1}}else switch(e.type){case en.FOG:return{opacity:e.visibleOnTable?o?.7:.4:.3,fill:"black",closed:!0};case en.FOG_CLEAR:return{opacity:e.visibleOnTable?o?.3:1:.6,fill:l.colors.palette.violet.lightest,globalCompositeOperation:o?void 0:"destination-out",closed:!0};case en.LIGHT_OBSTRUCTION:return{stroke:o?e.visibleOnTable?l.colors.palette.violet.base:l.colors.palette.violet.lightest:void 0,strokeWidth:o?10:void 0,hitStrokeWidth:20,lineCap:"round",strokeScaleEnabled:!1,closed:!1}}}),[c,o,l]),P=function(e){return function(t,n){if(t.type=e,c&&!t.visibleOnTable)return null;var a=I(t),i=j===t;return r.a.createElement(nn,Object.assign({key:n,polygon:t},a,{selectable:!h,selected:i,onSelected:function(){x(t),A(null)},adding:!1,onUpdate:T}))}};return n.lightSources.forEach(rn),r.a.createElement(ee.Layer,{ref:u,listening:o},o&&r.a.createElement(Ae,null,C),n.fogPolygons.map(P(en.FOG)),n.fogClearPolygons.map(P(en.FOG_CLEAR)),n.lightSources.map((function(e,t){return r.a.createElement(cn,{key:"rcr".concat(t),light:e,displayIcon:!c,isTable:c,obstructionPolygons:n.obstructionPolygons,fogPolygons:n.fogPolygons,onUpdate:function(e){n.lightSources[t]=e,i(Object(p.a)({},n))},selected:L===e,onSelected:function(){A(e),x(null)}})})),n.obstructionPolygons.map(P(en.LIGHT_OBSTRUCTION)),h&&function(){var e=I(h);return r.a.createElement(nn,Object.assign({key:"adding",polygon:h},e,{selectable:!1,selected:!0,adding:!0,onAdded:N,onUpdate:T}))}())},hn=(pn={},Object(M.a)(pn,gt.ASSETS,Zt),Object(M.a)(pn,gt.FOG,vn),pn);function On(e){var t={id:Object(I.a)(),name:"Untitled",type:e,visible:!0};return e===gt.ASSETS?t.assets=new Map:e===gt.FOG&&(t.lightSources=[],t.obstructionPolygons=[],t.fogPolygons=[],t.fogClearPolygons=[]),t}function gn(e,t){return En.apply(this,arguments)}function En(){return(En=Object(T.a)(C.a.mark((function e(t,n){var a,r,c,i;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(a=t.layers.indexOf(n))){e.next=3;break}return e.abrupt("return",t);case 3:if(n.type!==gt.ASSETS){e.next=12;break}r=0,c=Array.from(n.assets.values());case 5:if(!(r<c.length)){e.next=12;break}return i=c[r],e.next=9,Y(i);case 9:r++,e.next=5;break;case 12:return t.layers.splice(a,1),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var yn=R("scene");function jn(){return Object(p.a)(Object(p.a)({},yn),{},{deleteItem:function(){var e=Object(T.a)(C.a.mark((function e(t){var n,a,r,c,i,o,l;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.storage.getItem(t);case 2:n=e.sent,a=Object(N.a)(n.layers),e.prev=4,a.s();case 6:if((r=a.n()).done){e.next=20;break}if((c=r.value).type===gt.ASSETS){e.next=10;break}return e.abrupt("continue",18);case 10:i=0,o=Array.from(c.assets.values());case 11:if(!(i<o.length)){e.next=18;break}return l=o[i],e.next=15,Y(l);case 15:i++,e.next=11;break;case 18:e.next=6;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(4),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:return e.next=30,yn.deleteItem(t);case 30:case"end":return e.stop()}}),e,null,[[4,22,25,28]])})));return function(t){return e.apply(this,arguments)}}()})}function xn(){var e=Object(o.a)(["\n\t\t\t\t\tbackground-color: ",";\n\t\t\t\t\tpadding: "," ",";\n\t\t\t\t\tbox-shadow: ",";\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\theight: ","px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\tbackground-color: ",";\n\t\t\t\t"]);return xn=function(){return e},e}function kn(){var e=Object(o.a)(["\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-grow: 1;\n\t\t\t"]);return kn=function(){return e},e}function wn(){var e=Object(o.a)(["\n\t\t\t\t\t","\n\t\t\t\t\tmin-width: 168px;\n\t\t\t\t"]);return wn=function(){return e},e}function Sn(){var e=Object(o.a)(["\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\twidth: 1rem;\n\t\t\t\t"]);return Sn=function(){return e},e}function Ln(){var e=Object(o.a)(["\n                display: flex;\n                margin-top: ",";\n                justify-content: flex-end;\n              "]);return Ln=function(){return e},e}function An(){var e=Object(o.a)(["padding: ",";"]);return An=function(){return e},e}function Dn(){var e=Object(o.a)(["\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 200;\n\t\t\t"]);return Dn=function(){return e},e}var Cn=jn(),Nn=Cn.useOneValue,Tn=Cn.deleteItem,In=le().useOneValue;function Pn(e){var t=e.name,n=e.onUpdate,c=e.onDelete,i=Object(s.b)(),o=Object(a.useState)(!1),l=Object(b.a)(o,2),u=l[0],d=l[1],m=Object(a.useState)(!1),p=Object(b.a)(m,2),k=p[0],w=p[1],S=Object(a.useState)(t),L=Object(b.a)(S,2),A=L[0],D=L[1];return Object(a.useEffect)((function(){D(t)}),[t]),r.a.createElement("div",{className:Object(f.a)(Dn())},!u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{variant:"lead"},t),r.a.createElement(h.b,{icon:r.a.createElement(O.a,null),size:"sm",variant:"ghost",label:"Edit Name",onClick:function(){return d(!0)}}),r.a.createElement(h.b,{icon:r.a.createElement(g.a,null),size:"sm",variant:"ghost",label:"Delete Scene",onClick:function(){return w(!0)}})),u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(E.b,{value:A,onChange:function(e){return D(e.target.value)}}),r.a.createElement(h.b,{icon:r.a.createElement(y.a,null),size:"sm",variant:"ghost",label:"Save Name",onClick:function(){n(A),d(!1)},disabled:!A.trim()})),r.a.createElement(j.a,{isOpen:k,onRequestClose:function(){return w(!1)},title:"Delete Scene"},r.a.createElement("div",{className:Object(f.a)(An(),i.spaces.lg)},r.a.createElement(v.a,{variant:"paragraph",muted:!0},"Are you sure you want to delete '",t,"'?"),r.a.createElement("div",{className:Object(f.a)(Ln(),i.spaces.lg)},r.a.createElement(x.a,{variant:"ghost",intent:"danger",onClick:function(){c(),w(!1)}},"Delete")))))}function Rn(e){var t=e.scene,n=Object(s.b)(),a=In($.DISPLAYED_SCENE),c=Object(b.a)(a,2),i=c[0],o=c[1],l=In($.TABLE_FREEZE),u=Object(b.a)(l,2),d=u[0],m=u[1],p=i===t.id;return r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{iconBefore:p?r.a.createElement(k.a,null):r.a.createElement(w.a,null),intent:"none",variant:"outline",onPress:function(){o(p?null:t.id),m(!1)}},p?"Hide TV/Table View":"Send to Table"),r.a.createElement("span",{className:Object(f.a)(Sn())}),r.a.createElement(x.a,{iconBefore:d?r.a.createElement(S.a,null):r.a.createElement(L.a,null),variant:"outline",disabled:!p,onPress:function(){return m(!d)},className:Object(f.a)(wn(),d?"\n\t\t\t\t\t\tborder-color: ".concat(n.colors.intent.success.dark," !important;\n\t\t\t\t\t\tbackground: ").concat(d?n.colors.intent.success.base:"initial"," !important;\n\t\t\t\t\t"):"")},d?"Unpause Table":"Pause Table"))}var Mn=function(e){var t=e.onSceneDelete,n=tt(),a=Object(u.i)(),c=Nn(a.params.id),i=Object(b.a)(c,2),o=i[0],l=i[1],s=In($.DISPLAYED_SCENE),d=Object(b.a)(s,1)[0],m=In($.TABLE_FREEZE),v=Object(b.a)(m,1)[0];return a.params.id?void 0===o?r.a.createElement(A.a,{label:"Loading scene...",center:!0}):null===o?null:r.a.createElement("div",{className:Object(f.a)(kn())},r.a.createElement("div",{className:Object(f.a)(xn(),n.colors.background.layer,n.spaces.sm,n.spaces.md,n.shadows.sm,n.headerHeight,d!==o.id||v?"initial":n.colors.intent.success.dark)},r.a.createElement(Pn,{name:o.name,onUpdate:function(e){return l(Object(p.a)(Object(p.a)({},o),{},{name:e}))},onDelete:function(){return Tn(o.id).then((function(){return t()}))}}),r.a.createElement("div",null),r.a.createElement("div",null,r.a.createElement(Rn,{scene:o}))),r.a.createElement(Yt,{scene:o,onUpdate:l})):null},zn=n(266),Un=n(267),Fn=n(268);function Gn(){var e=Object(o.a)(["\n              background: "," !important;\n            "]);return Gn=function(){return e},e}function _n(){var e=Object(o.a)(["\n          overflow: auto;\n        "]);return _n=function(){return e},e}function Bn(){var e=Object(o.a)(["\n          display: flex;\n          padding: ",";\n        "]);return Bn=function(){return e},e}function Vn(){var e=Object(o.a)(["\n        display: ",";\n        width: ","px;\n        flex-shrink: 0;\n        flex-direction: column;\n        z-index: 300;\n      "]);return Vn=function(){return e},e}function Xn(){var e=Object(o.a)(["\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      "]);return Xn=function(){return e},e}function Wn(){var e=Object(o.a)(["\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      "]);return Wn=function(){return e},e}var Yn=jn(),Hn=Yn.useAllValues,Zn=Yn.createItem,qn=le().useOneValue;function Kn(){return r.a.createElement(st.a,null,r.a.createElement(st.b,{primary:r.a.createElement(zn.a,{animated:!0})}))}function Jn(e){var t=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(Wn())},r.a.createElement("div",{className:Object(f.a)(Xn())},r.a.createElement(Un.a,{width:"150px",height:"150px",color:"#BDBEBF"}),r.a.createElement(x.a,{iconBefore:r.a.createElement(Be.a,null),variant:"ghost",color:t.colors.text.muted,onClick:e.onAdd,size:"xl"},"Add a scene")))}function Qn(e){var t=e.scene,n=Object(s.b)(),a=qn($.DISPLAYED_SCENE),c=Object(b.a)(a,1)[0],i=qn($.TABLE_FREEZE),o=Object(b.a)(i,1)[0];return c===t.id?o?r.a.createElement(L.a,{color:n.colors.palette.yellow.base}):r.a.createElement(S.a,{color:n.colors.palette.green.base}):null}var $n=function(e){var t=e.onSceneSelect,n=e.selectedSceneId,c=tt(),i=Hn(),o=Object(a.useState)(""),l=Object(b.a)(o,2),u=l[0],s=l[1];function d(){var e=function(){var e=On(gt.ASSETS);return e.name="Layer 1",{id:Object(I.a)(),name:"Untitled",table:{offset:{x:0,y:0},rotation:0,scale:1,displayGrid:!0},layers:[e]}}();i&&(e.name="Scene ".concat(i.size+1)),Zn(e.id,e),t(e)}if(!i)return r.a.createElement(Kn,null);if(0===i.size)return r.a.createElement(Jn,{onAdd:d});var m=Array.from(i.values());return u&&(m=m.filter((function(e){return e.name.toLowerCase().includes(u.toLowerCase())}))),m=m.sort((function(e,t){return e.name.localeCompare(t.name)})),r.a.createElement(st.a,{className:Object(f.a)(Vn(),c.sceneListWidth>0?"flex":"none",c.sceneListWidth)},r.a.createElement("div",{className:Object(f.a)(Bn(),c.spaces.sm)},r.a.createElement(E.b,{type:"search",placeholder:"Find a scene...",onChange:function(e){return s(e.target.value)},value:u}),r.a.createElement(te.a,{content:"Add Scene"},r.a.createElement(h.b,{icon:r.a.createElement(Fn.a,null),label:"Add Scene",variant:"ghost",onClick:d}))),r.a.createElement("div",{className:Object(f.a)(_n())},m.map((function(e){return r.a.createElement(st.b,{primary:e.name,key:e.id,contentAfter:r.a.createElement(Qn,{scene:e}),onPress:function(){return t(e)},className:Object(f.a)(Gn(),n===e.id?c.colors.intent.primary.dark:void 0)})}))))};function ea(){var e=Object(o.a)(["\n              display: flex;\n              flex-direction: row;\n              width: 100%;\n              height: 100vh;\n            "]);return ea=function(){return e},e}var ta=function(){var e=Object(s.b)(),t=Object(u.g)(),n=Object(u.i)(),a=function(){var e=Object(u.i)(),t=Object(u.i)({path:e.path+"/:id"});return null===t||void 0===t?void 0:t.params.id}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{title:"D&D Tabletop"}),r.a.createElement(d.a,{styles:{html:{background:e.colors.background.default,color:e.colors.text.default,fontFamily:e.fonts.base},body:{padding:0,margin:0,width:"100vw",height:"100vh","*:focus":{outline:"none"},overflow:"hidden"}}}),r.a.createElement(u.d,null,r.a.createElement(u.b,{path:["".concat(n.path),"".concat(n.path,"/:id")],exact:!0},r.a.createElement("div",{className:Object(f.a)(ea())},r.a.createElement($n,{onSceneSelect:function(e){t.push("".concat(n.path,"/").concat(e.id))},selectedSceneId:a}),r.a.createElement(Mn,{onSceneDelete:function(){return t.push("".concat(n.path,"/"))}})))))};function na(){var e=Object(o.a)(["\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\ttop: ","px;\n\t\t\t\t\t\tleft: ","px;\n\t\t\t\t\t"]);return na=function(){return e},e}var aa=jn().useOneValue,ra=le().useOneValue,ca=function(){var e=ra($.DISPLAYED_SCENE),t=Object(b.a)(e,1)[0],n=ra($.TABLE_FREEZE),c=Object(b.a)(n,1)[0],i=se(),o=Object(b.a)(i,1)[0],l=aa(t),u=Object(b.a)(l,1)[0],s=Object(a.useState)(null),v=Object(b.a)(s,2),h=v[0],O=v[1],g=Object(a.useState)({width:window.innerWidth,height:window.innerHeight}),E=Object(b.a)(g,2),y=E[0],j=E[1],x=.05*(de()||100)*2;return Object(a.useEffect)((function(){c||void 0===u||O(u)}),[u,c]),Object(a.useEffect)((function(){function e(){j({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),o?r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{styles:{body:{background:"black",margin:0,padding:0,overflow:"hidden"}}}),r.a.createElement(m.a,{title:"D&D Table View"}),h&&r.a.createElement(ee.Stage,{width:y.width+2*x,height:y.width+2*x,offsetX:h.table.offset.x-x,offsetY:h.table.offset.y-x,scaleX:h.table.scale,scaleY:h.table.scale,className:Object(f.a)(na(),-x,-x)},r.a.createElement(Xt.Provider,{value:h},h.layers.map((function(e){var t=hn[e.type];return t&&!1!==e.visible?r.a.createElement(t,{key:e.id,isTable:!0,layer:e,onUpdate:function(){},active:!1}):null})),r.a.createElement(Lt,{layer:Object(p.a)(Object(p.a)({},St),{},{options:h.table}),isTable:!0,active:!1,onUpdate:function(){},showBorder:!1,showGrid:h.table.displayGrid})))):null},ia=n(269),oa={home:{name:"Home",path:"/",sidebarIcon:function(){return r.a.createElement("img",{width:32,height:32,src:"favicon.png",alt:"home icon"})},main:function(){return r.a.createElement(u.a,{to:oa.scenes.path})},exact:!0},scenes:{name:"Scenes",path:"/scenes",sidebarIcon:Un.a,main:function(){return r.a.createElement(ta,null)},useOnClick:function(){var e=et(),t=Object(b.a)(e,2),n=t[0],a=t[1];return function(){a(!n)}}},table:{name:"TV/Table View",path:"/table",sidebarIcon:ia.a,main:function(){return r.a.createElement(ca,null)},popout:!0,exact:!0}},la=oa;function ua(){var e=Object(o.a)(["flex-grow: 1;"]);return ua=function(){return e},e}function sa(){var e=Object(o.a)(["\n\t\t\t\twidth: ","px;\n\t\t\t\theight: 100vh;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tbackground-color: ",";\n\t\t\t\tz-index: 300;\n\t\t\t"]);return sa=function(){return e},e}var fa=function(e){var t=e.route,n=Object(s.b)(),a=!!Object(u.i)({path:t.path,exact:t.exact}),c=t.useOnClick?t.useOnClick():void 0,i=r.a.createElement(te.a,{content:t.name,placement:"right"},r.a.createElement(h.b,{variant:"ghost",color:a?n.colors.text.default:n.colors.text.muted,size:"lg",icon:r.a.createElement(t.sidebarIcon,null),label:t.name}));return a?r.a.createElement("div",{onClick:c},i):r.a.createElement(l.b,{to:t.path,target:t.popout?"_blank":void 0},i)},ba=function(){var e=tt(),t=Object(u.h)();return Object.keys(la).map((function(e){return la[e]})).some((function(e){return e.exact&&e.popout&&e.path===t.pathname}))||t.pathname===la.home.path?null:r.a.createElement("div",{className:Object(f.a)(sa(),e.sidebarWidth,e.colors.background.default)},Object.keys(la).map((function(e){var t=la[e];return r.a.createElement(fa,{key:e,route:t})})),r.a.createElement("div",{className:Object(f.a)(ua())}),r.a.createElement(pe,null))};function da(){var e=Object(o.a)(["\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t"]);return da=function(){return e},e}ge.a.showWarnings=!1;var ma=function(){return r.a.createElement(s.a,null,r.a.createElement(l.a,null,r.a.createElement("div",{className:Object(f.a)(da())},r.a.createElement(ba,null),r.a.createElement(u.d,null,Object.keys(la).map((function(e){var t=la[e];return r.a.createElement(u.b,{key:e,path:t.path,exact:t.exact,component:t.main})}))))))};i.a.render(r.a.createElement(ma,null),document.getElementById("root"))}},[[138,1,2]]]);
//# sourceMappingURL=main.d1cf052a.chunk.js.map