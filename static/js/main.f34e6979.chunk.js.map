{"version":3,"sources":["storage.ts","scene/canvas/transformableAsset.tsx","scene/asset/storage.ts","scene/asset/video.tsx","scene/asset/index.tsx","scene/asset/image.tsx","scene/layer/assetLayer/imageAsset.tsx","scene/layer/assetLayer/videoAsset.tsx","scene/layer/toolbarItem.tsx","scene/layer/toolbar.tsx","scene/layer/index.tsx","scene/layer/toolbarPortal.tsx","scene/layer/assetLayer/index.tsx","scene/index.tsx","settings/index.tsx","scene/list.tsx","scene/canvas/draggableStage.tsx","scene/canvas/layerList.tsx","scene/canvas/index.tsx","scene/editor.tsx","scene/page.tsx","table/page.tsx","sidebar.tsx","routes.tsx","App.tsx","index.tsx"],"names":["RTStorage","require","useGlobalStorage","name","storage","useAllValues","useState","data","setState","useEffect","handleStorageChange","keys","then","a","items","Map","Promise","all","map","k","getItem","item","set","subscription","subscribe","unsubscribe","useOneValue","key","undefined","lastData","d","newData","setItem","createItem","object","TransformableAsset","rectTransform","onTransform","isSelected","onSelected","children","theme","useTheme","groupRef","useRef","trRef","current","setNode","getLayer","batchDraw","Fragment","onClick","e","evt","button","cancelBubble","ref","draggable","x","y","height","width","rotation","onDragEnd","node","scaleX","scaleY","target","Math","max","onTransformEnd","anchorFill","colors","background","overlay","anchorStroke","palette","blue","light","rotationSnaps","rotateAnchorOffset","fileStorage","useAssetFileDatabase","getVideoSize","file","res","video","document","createElement","src","URL","createObjectURL","addEventListener","videoWidth","videoHeight","AssetType","createVideoAsset","asset","id","v4","type","VIDEO","transform","deleteVideoAsset","removeItem","getNewAssets","fileDialogInput","multiple","accept","click","onchange","files","assets","Array","i","length","indexOf","createImageAsset","push","deleteAsset","IMAGE","deleteImageAsset","getImageSize","img","Image","onload","ImageAsset","onUpdate","selected","imageEl","setImageEl","useImageAssetFile","fr","FileReader","result","readAsDataURL","newRect","image","VideoAsset","videoEl","setVideoEl","useVideoAssetFile","muted","autoplay","play","ToolbarItem","label","keyboardShortcuts","otherProps","onKeyPress","includes","window","removeEventListener","Tooltip","content","placement","IconButton","variant","LayerType","Toolbar","className","css","tint1","shadows","md","useToolbarPortal","singletonHook","ToolbarPortal","portal","ReactDOM","render","unmountComponentAtNode","ToolbarPortalProvider","setPortal","console","log","AssetTypeToComponent","AssetLayer","layer","layerActive","active","selectedAsset","setSelectedAsset","layerRef","deleteSelectedAsset","useCallback","has","get","delete","from","values","some","anim","Konva","Animation","start","stop","toolbar","useMemo","icon","IconFilePlus","IconTrash2","disabled","Component","updatedAsset","LayerTypeToComponent","ASSETS","deleteLayer","scene","layers","splice","useSceneDatabase","Settings","useSettingsDatabase","useOneSettingValue","useTableResolution","TABLE_RESOLUTION","tableResolution","setTableResolution","useTableSize","TABLE_SIZE","tableSize","setTableSize","ScreenSizeSettings","formItemMargin","spaces","sm","Text","min","placeholder","value","onChange","Number","isNaN","SettingsSidebarItem","dialogOpen","setDialogOpen","color","text","size","IconSettings","Dialog","isOpen","onRequestClose","title","lg","LoadingScenes","List","primary","Skeleton","animated","NoScenes","props","IconFilm","Button","iconBefore","IconPlus","onAdd","SceneStatusIcon","DISPLAYED_SCENE","displayedScene","TABLE_FREEZE","tableFreeze","IconPause","yellow","base","IconPlay","green","SceneList","onSceneSelect","selectedSceneId","allValues","addNewScene","IconPlusCircle","contentAfter","onPress","intent","dark","DraggableStage","containerRef","containerSize","useComponentSize","stageRef","zoom","setZoom","SCENE_LIST_WIDTH","HEADER_HEIGHT","tint2","scale","onWheel","preventDefault","oldScale","stage","pointer","getPointerPosition","mousePointTo","newZoom","deltaY","newPos","position","onContextMenu","LayerList","activeLayer","setActiveLayer","addLayer","moveActiveLayer","deleteActiveLayer","layerIndex","findIndex","l","isActiveLayerTop","isActiveLayerBottom","Layer","reverse","contentBefore","Avatar","danger","IconArrowUp","IconArrowDown","Popover","Menu","IconFile","IconCloudDrizzle","FOG","TableViewOverlay","offset","showGrid","showBorder","ppi","theta","atan","widthInch","cos","useTablePPI","lines","xOffset","end","yOffset","line","points","stroke","gray","dash","strokeWidth","listening","Canvas","onLayerUpdate","updatedLayer","find","newScene","createNewLayer","editActiveLayerName","direction","swapIndex","currentLayer","layerToSwap","SceneNameHeader","updateName","inEdit","setInEdit","localName","setLocalName","IconEdit2","IconCheck","success","trim","TableDisplayButton","updateDisplayedScene","updateTableFreeze","IconUpload","heading","SceneEditor","match","useRouteMatch","params","updateScene","Spinner","center","IconRotateCcw","IconRotateCw","ScenePage","history","useHistory","routeMatch","currentSelectedScene","matchedSceneRoute","path","useCurrentSelectedScene","Helmet","styles","html","default","fontFamily","fonts","body","padding","margin","outline","overflow","exact","TablePage","tableScene","setTableScene","innerWidth","innerHeight","windowSize","setWindowSize","onResize","SidebarItem","route","to","popout","sidebarIcon","Sidebar","location","useLocation","Object","routes","routeName","pathname","home","SIDEBAR_WIDTH","alt","main","scenes","table","IconMap","App","component","getElementById"],"mappings":"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","file":"static/js/main.f34e6979.chunk.js","sourcesContent":["// import { openDB, IDBPDatabase, DBSchema, IDBPObjectStore } from 'idb';\n// import { useState, useEffect } from 'react';\n// import { EventEmitter } from 'events';\n\n// const STORE_NAME = 'keyval';\n// const INDEX_NAME = 'id';\n// interface Schema<T> extends DBSchema {\n// \tkeyval: {\n// \t\tkey: string | number,\n// \t\tvalue: T\n// \t}\n// }\n// type KeyValDatabase<T extends { id: string | number }> = IDBPDatabase<Schema<T>>\n\n// const changeEmitter = new EventEmitter();\n\n// export function useDB<T extends { id: string | number }>(name: string) {\n// \tconst [db, setDB] = useState<KeyValDatabase<T> | undefined>(undefined);\n\n// \tuseEffect(() => {\n// \t\topenDB<Schema<T>>(name, 1, {\n// \t\t\tupgrade(db) {\n// \t\t\t\tdb.createObjectStore(STORE_NAME, {\n// \t\t\t\t\tkeyPath: INDEX_NAME,\n// \t\t\t\t\tautoIncrement: true,\n// \t\t\t\t});\n// \t\t\t},\n// \t\t}).then((db) => setDB(db))\n// \t}, [])\n\n// \tif (!db) {\n// \t\treturn undefined;\n// \t}\n\n// \treturn db;\n// }\n\n// export function useAllValues<T extends { id: string | number }>(db: KeyValDatabase<T> | undefined) {\n// \tconst [values, setValues] = useState<Array<T> | undefined>(undefined);\n\n// \tuseEffect(() => {\n// \t\tif (!db) {\n// \t\t\treturn;\n// \t\t}\n\n// \t\tfunction onChange() {\n// \t\t\tdb?.getAll(STORE_NAME).then((v) => setValues(v))\n// \t\t}\n\n// \t\tconst event = 'change:' + db.name;\n// \t\tchangeEmitter.on(event, onChange);\n// \t\tonChange();\n\n// \t\treturn () => { changeEmitter.off(event, onChange) }\n// \t}, [db])\n\n// \tif (!db) {\n// \t\treturn undefined;\n// \t}\n\n// \treturn values;\n// }\n\n// export function useOneValue<T extends { id: string | number }>(db: KeyValDatabase<T> | undefined, id: string | number) {\n// \tconst [value, setValue] = useState<T | undefined>(undefined);\n\n// \tuseEffect(() => {\n// \t\tif (!db) {\n// \t\t\treturn;\n// \t\t}\n\n// \t\tfunction onChange() {\n// \t\t\tif (value?.id !== id) setValue(undefined);\n// \t\t\tdb?.get(STORE_NAME, id).then((v) => setValue(v))\n// \t\t}\n\n// \t\tconst event = 'change:' + db.name;\n// \t\tchangeEmitter.on(event, onChange);\n// \t\tonChange();\n\n// \t\treturn () => { changeEmitter.off(event, onChange) }\n// \t}, [db, id])\n\n// \tif (!db) {\n// \t\treturn undefined;\n// \t}\n\n// \treturn value;\n// }\n\n// export function useObjectCreator<T extends { id: string | number }>(db: KeyValDatabase<T> | undefined): (object: T) => void {\n// \tif (!db) {\n// \t\treturn () => { }\n// \t}\n\n// \treturn (object: T) => {\n// \t\tdb.add(STORE_NAME, object)\n// \t\t\t.then(() => {\n// \t\t\t\tchangeEmitter.emit('change:' + db.name);\n// \t\t\t})\n// \t}\n// }\n\n// export function useObjectUpdator<T extends { id: string | number }>(db: KeyValDatabase<T> | undefined): (object: T) => void {\n// \tif (!db) {\n// \t\treturn () => { }\n// \t}\n\n// \treturn (object: T) => {\n// \t\tdb.put(STORE_NAME, object)\n// \t\t\t.then(() => {\n// \t\t\t\tchangeEmitter.emit('change:' + db.name);\n// \t\t\t})\n// \t}\n// }\n\n\n\nimport { useState, useEffect, Dispatch, SetStateAction } from 'react';\nconst RTStorage = require('rt-storage');\n\ninterface IRTStorage<T> {\n\tgetItem<V extends T>(key: string): Promise<V>;\n\tsetItem<V extends T>(key: string, value: V): Promise<V>;\n\tremoveItem(key: string): Promise<void>;\n\tkeys(): Promise<Array<string>>;\n\tsubscribe<V extends T>(handler: (value: V) => void): { unsubscribe: () => void };\n\tsubscribe<V extends T>(key: string, handler: (value: V) => void): { unsubscribe: () => void };\n}\n\nexport default function useGlobalStorage<T>(name: string) {\n\tconst storage = new RTStorage({ name }) as IRTStorage<T>;\n\tconst useOneValue = <V extends T = T>(key: string) => {\n\t\tconst [data, setState] = useState<V | null | undefined>(undefined);\n\n\t\tuseEffect(() => {\n\t\t\tstorage.getItem<V>(key).then((lastData) => {\n\t\t\t\tif (lastData) {\n\t\t\t\t\tsetState(lastData);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetState(null);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst subscription = storage.subscribe(key, (d: V) => setState(d));\n\t\t\treturn () => {\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t};\n\t\t}, [key]);\n\n\t\tconst setData = async (newData: V) => {\n\t\t\tsetState(newData);\n\t\t\tawait storage.setItem(key, newData);\n\t\t}\n\n\t\treturn [data, setData] as [V | null | undefined, Dispatch<SetStateAction<V>>];\n\t}\n\n\treturn {\n\t\tuseAllValues: () => {\n\t\t\tconst [data, setState] = useState<Map<string, T>>();\n\n\t\t\tuseEffect(() => {\n\t\t\t\tfunction handleStorageChange() {\n\t\t\t\t\tstorage.keys()\n\t\t\t\t\t\t.then(async (keys: string[]) => {\n\t\t\t\t\t\t\tconst items = new Map<string, T>();\n\t\t\t\t\t\t\tawait Promise.all(keys.map(async (k) => {\n\t\t\t\t\t\t\t\tconst item = await storage.getItem(k)\n\t\t\t\t\t\t\t\titems.set(k, item);\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\tsetState(items);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\thandleStorageChange();\n\t\t\t\tconst subscription = storage.subscribe(handleStorageChange);\n\t\t\t\treturn () => {\n\t\t\t\t\tsubscription.unsubscribe();\n\t\t\t\t};\n\t\t\t}, []);\n\n\t\t\treturn data;\n\t\t},\n\t\tuseOneValue,\n\t\tcreateItem: (key: string, object: T) => {\n\t\t\tstorage.setItem(key, object);\n\t\t},\n\t\tstorage\n\t};\n};","import React, { useRef, useEffect } from 'react';\nimport { Group, Transformer } from 'react-konva';\nimport Konva from 'konva';\nimport { IRect } from 'konva/types/types';\nimport { useTheme } from 'sancho';\n\nexport type AssetTransform = IRect & { rotation: number };\n\ntype Props = { rectTransform: AssetTransform, onTransform: (newRect: AssetTransform) => void, isSelected: boolean, onSelected: () => void };\nconst TransformableAsset: React.SFC<Props> = ({ rectTransform, onTransform, isSelected, onSelected, children }) => {\n\tconst theme = useTheme();\n\n\tconst groupRef = useRef<Konva.Group>();\n\tconst trRef = useRef<Konva.Transformer>();\n\n\tuseEffect(() => {\n\t\tif (isSelected) {\n\t\t\t// we need to attach transformer manually\n\t\t\ttrRef.current?.setNode(groupRef.current);\n\t\t\ttrRef.current?.getLayer()?.batchDraw();\n\t\t}\n\t}, [isSelected]);\n\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<Group\n\t\t\t\tonClick={(e) => {\n\t\t\t\t\tif (e.evt.button === 0) {\n\t\t\t\t\t\tonSelected();\n\t\t\t\t\t\te.cancelBubble = true;\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tref={groupRef as any}\n\t\t\t\tdraggable={isSelected}\n\t\t\t\tx={rectTransform.x}\n\t\t\t\ty={rectTransform.y}\n\t\t\t\theight={rectTransform.height}\n\t\t\t\twidth={rectTransform.width}\n\t\t\t\trotation={rectTransform.rotation}\n\t\t\t\tonDragEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = node.rotation();\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx: e.target.x(),\n\t\t\t\t\t\ty: e.target.y(),\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: Math.max(5, node.width() * scaleX),\n\t\t\t\t\t\theight: Math.max(node.height() * scaleY)\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t\tonTransformEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = node.rotation();\n\n\t\t\t\t\tnode.scaleX(1);\n\t\t\t\t\tnode.scaleY(1);\n\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx: node.x(),\n\t\t\t\t\t\ty: node.y(),\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: node.width() * scaleX,\n\t\t\t\t\t\theight: node.height() * scaleY\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Group>\n\t\t\t{isSelected && (\n\t\t\t\t<Transformer\n\t\t\t\t\tref={trRef as any}\n\t\t\t\t\tanchorFill={theme.colors.background.overlay}\n\t\t\t\t\tanchorStroke={theme.colors.palette.blue.light}\n\t\t\t\t\trotationSnaps={[0, 45, 90, 135, 180, 225, 270, 315]}\n\t\t\t\t\trotateAnchorOffset={20}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</React.Fragment>\n\t);\n}\nexport default TransformableAsset;","import useGlobalStorage from \"../../storage\";\n\nconst fileStorage = useGlobalStorage<File>('asset_file');\nexport function useAssetFileDatabase() {\n\treturn fileStorage;\n}","import { v4 } from \"uuid\";\n\nimport { IVideoAsset } from \"../layer/assetLayer/videoAsset\";\nimport { useAssetFileDatabase } from \"./storage\";\nimport { AssetType } from \".\";\n\nfunction getVideoSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst video = document.createElement('video');\n\t\tvideo.src = URL.createObjectURL(file);\n\t\tvideo.addEventListener('loadedmetadata', () => {\n\t\t\tres({\n\t\t\t\twidth: video.videoWidth,\n\t\t\t\theight: video.videoHeight\n\t\t\t})\n\t\t});\n\t})\n}\n\nconst { storage: fileStorage } = useAssetFileDatabase();\n\nexport async function createVideoAsset(file: File) {\n\tconst { width, height } = await getVideoSize(file);\n\tconst asset = {\n\t\tid: v4(),\n\t\ttype: AssetType.VIDEO,\n\t\ttransform: {\n\t\t\tx: 0, y: 0,\n\t\t\twidth, height,\n\t\t\trotation: 0\n\t\t}\n\t} as IVideoAsset;\n\tawait fileStorage.setItem(asset.id, file);\n\treturn asset;\n}\n\nexport async function deleteVideoAsset(asset: IVideoAsset) {\n\tawait fileStorage.removeItem(asset.id);\n}\n\nexport function useVideoAssetFile(asset: IVideoAsset) {\n\treturn useAssetFileDatabase().useOneValue(asset.id);\n}","import { createImageAsset, deleteImageAsset } from \"./image\";\nimport { createVideoAsset, deleteVideoAsset } from \"./video\";\nimport { AssetTransform } from \"../canvas/transformableAsset\";\n\nexport enum AssetType {\n\tIMAGE,\n\tVIDEO\n}\n\nexport interface IAsset {\n\tid: string;\n\ttransform: AssetTransform;\n\ttype: AssetType;\n}\n\nexport function getNewAssets() {\n\tconst fileDialogInput = document.createElement('input');\n\tfileDialogInput.type = \"file\";\n\tfileDialogInput.multiple = true;\n\tfileDialogInput.accept = 'image/*,video/*';\n\n\tfileDialogInput.click();\n\treturn new Promise<Array<IAsset>>((res) => {\n\t\tfileDialogInput.onchange = async (e) => {\n\t\t\tconst files = (e!.target as HTMLInputElement).files;\n\t\t\tif (!files) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst assets = new Array<IAsset>();\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst file = files.item(i);\n\t\t\t\tif (!file) continue;\n\n\t\t\t\tif (file.type.indexOf('image') === 0) {\n\t\t\t\t\tassets.push(await createImageAsset(file));\n\t\t\t\t}\n\t\t\t\telse if (file.type.indexOf('video') === 0) {\n\t\t\t\t\tassets.push(await createVideoAsset(file));\n\t\t\t\t}\n\t\t\t}\n\t\t\tres(assets);\n\t\t}\n\t});\n}\n\nexport async function deleteAsset(asset: IAsset) {\n\tif (asset.type === AssetType.IMAGE) {\n\t\tawait deleteImageAsset(asset);\n\t}\n\telse if (asset.type === AssetType.VIDEO) {\n\t\tawait deleteVideoAsset(asset);\n\t}\n}","import { v4 } from \"uuid\";\n\nimport { IImageAsset } from \"../layer/assetLayer/imageAsset\";\nimport { useAssetFileDatabase } from \"./storage\";\nimport { AssetType } from \".\";\n\nfunction getImageSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst img = new Image();\n\t\timg.src = URL.createObjectURL(file);\n\t\timg.onload = () => {\n\t\t\tres({\n\t\t\t\twidth: img.width,\n\t\t\t\theight: img.height\n\t\t\t})\n\t\t}\n\t})\n}\n\nconst { storage: fileStorage } = useAssetFileDatabase();\n\nexport async function createImageAsset(file: File) {\n\tconst { width, height } = await getImageSize(file);\n\tconst asset = {\n\t\tid: v4(),\n\t\ttype: AssetType.IMAGE,\n\t\ttransform: {\n\t\t\tx: 0, y: 0,\n\t\t\twidth, height,\n\t\t\trotation: 0\n\t\t}\n\t} as IImageAsset;\n\tawait fileStorage.setItem(asset.id, file);\n\treturn asset;\n}\n\nexport async function deleteImageAsset(asset: IImageAsset) {\n\tawait fileStorage.removeItem(asset.id);\n}\n\nexport function useImageAssetFile(asset: IImageAsset) {\n\treturn useAssetFileDatabase().useOneValue(asset.id);\n}","import React, { useEffect, useState } from 'react';\nimport { Image } from 'react-konva';\n\nimport TransformableAsset from '../../canvas/transformableAsset';\nimport { useImageAssetFile } from '../../asset/image';\nimport { IAssetComponentProps } from '.';\nimport { IAsset } from '../../asset';\n\nexport interface IImageAsset extends IAsset {\n\n}\n\ninterface Props extends IAssetComponentProps<IImageAsset> { };\nconst ImageAsset: React.SFC<Props> = ({ asset, onUpdate, selected, onSelected }) => {\n\tconst [imageEl, setImageEl] = useState<HTMLImageElement>();\n\n\tconst [file] = useImageAssetFile(asset);\n\n\tuseEffect(() => {\n\t\tif (file) {\n\t\t\tvar fr = new FileReader();\n\t\t\tconst img = document.createElement('img') as HTMLImageElement;\n\t\t\tfr.onload = function () {\n\t\t\t\tif (fr.result) {\n\t\t\t\t\timg.src = fr.result as string;\n\t\t\t\t\tsetImageEl(img);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfr.readAsDataURL(file);\n\t\t}\n\t}, [file])\n\n\treturn (\n\t\t\t<TransformableAsset\n\t\t\t\tisSelected={selected}\n\t\t\t\tonSelected={onSelected}\n\t\t\t\trectTransform={asset.transform}\n\t\t\t\tonTransform={(newRect) => {\n\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t...asset,\n\t\t\t\t\t\ttransform: newRect\n\t\t\t\t\t})\n\t\t\t\t}}>\n\t\t\t\t{imageEl && <Image\n\t\t\t\t\timage={imageEl}\n\t\t\t\t\twidth={asset.transform.width}\n\t\t\t\t\theight={asset.transform.height}\n\t\t\t\t/>}\n\t\t\t</TransformableAsset>\n\t);\n}\n\nexport default ImageAsset;","import React, { useEffect, useState } from 'react';\nimport { Image } from 'react-konva';\n\nimport { IAsset } from '../../asset';\nimport TransformableAsset from '../../canvas/transformableAsset';\nimport { useVideoAssetFile } from '../../asset/video';\nimport { IAssetComponentProps } from '.';\n\nexport interface IVideoAsset extends IAsset {\n}\n\ninterface Props extends IAssetComponentProps<IVideoAsset> { };\nconst VideoAsset: React.SFC<Props> = ({ asset, onUpdate, selected, onSelected }) => {\n\tconst [videoEl, setVideoEl] = useState<HTMLVideoElement>();\n\tconst [file] = useVideoAssetFile(asset);\n\n\tuseEffect(() => {\n\t\tif (file) {\n\t\t\tconst video = document.createElement('video');\n\t\t\tvideo.src = URL.createObjectURL(file);\n\t\t\tvideo.muted = true;\n\t\t\tvideo.autoplay = true;\n\t\t\tvideo.play();\n\t\t\tsetVideoEl(video);\n\t\t}\n\t}, [file])\n\n\treturn (\n\t\t<TransformableAsset\n\t\t\tisSelected={selected}\n\t\t\tonSelected={onSelected}\n\t\t\trectTransform={asset.transform}\n\t\t\tonTransform={(newRect) => {\n\t\t\t\tonUpdate({\n\t\t\t\t\t...asset,\n\t\t\t\t\ttransform: newRect\n\t\t\t\t})\n\t\t\t}}>\n\t\t\t{videoEl && <Image\n\t\t\t\timage={videoEl}\n\t\t\t\twidth={asset.transform.width}\n\t\t\t\theight={asset.transform.height}\n\t\t\t/>}\n\t\t</TransformableAsset>\n\t);\n}\n\nexport default VideoAsset;","import { IconButtonProps, IconButton, Tooltip } from \"sancho\";\nimport React, { useEffect, MouseEvent } from \"react\";\n\ntype Props = IconButtonProps & { keyboardShortcuts?: string[], onClick?: (e: MouseEvent<HTMLButtonElement> | KeyboardEvent) => void };\nconst ToolbarItem: React.SFC<Props> = ({ label, keyboardShortcuts, ...otherProps }) => {\n\n\tuseEffect(() => {\n\t\tif (keyboardShortcuts && otherProps.onClick) {\n\t\t\tconst onKeyPress = (e: KeyboardEvent) => {\n\t\t\t\tif (keyboardShortcuts!.includes(e.key)) otherProps.onClick!(e);\n\t\t\t}\n\t\t\twindow.addEventListener('keyup', onKeyPress);\n\t\t\treturn () => window.removeEventListener('keyup', onKeyPress);\n\t\t}\n\t}, [keyboardShortcuts, otherProps.onClick])\n\n\treturn (\n\t\t<Tooltip content={label} placement=\"bottom\">\n\t\t\t<IconButton\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel={label}\n\t\t\t\t{...otherProps}\n\t\t\t/>\n\t\t</Tooltip>\n\t)\n}\nexport default ToolbarItem;","import React from \"react\";\nimport { css } from \"emotion\";\nimport { useTheme } from \"sancho\";\n\nconst Toolbar: React.SFC = ({ children }) => {\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 0; left: 0; right: 0;\n\t\t\t\tmin-height: 40px;\n\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\tbox-shadow: ${theme.shadows.md};\n\t\t\t\tz-index: 100;\n\t\t\t`}\n\t\t>\n\t\t\t{children}\n\t\t</div>\n\t);\n}\nexport default Toolbar;","import AssetLayer, { IAssetLayer } from \"./assetLayer\";\nimport { v4 } from \"uuid\";\nimport { IScene } from \"..\";\nimport { deleteAsset } from \"../asset\";\n\nexport enum LayerType {\n\tASSETS,\n\tFOG,\n\tTABLE_OVERLAY,\n}\n\nexport interface ILayer {\n\tid: string\n\ttype: LayerType\n\tname: string\n}\n\nexport interface ILayerComponentProps<T extends ILayer> {\n\tlayer: T;\n\tonUpdate: (layer: T) => void;\n\tactive: boolean;\n}\n\nexport const LayerTypeToComponent = {\n\t[LayerType.ASSETS]: AssetLayer,\n} as { [type: string]: React.SFC<ILayerComponentProps<any>> }\n\nexport function createNewLayer(type: LayerType) {\n\tconst layer: ILayer = {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\ttype: type\n\t};\n\tif (type === LayerType.ASSETS) {\n\t\t(layer as IAssetLayer).assets = new Map();\n\t}\n\treturn layer;\n}\n\nexport async function deleteLayer(scene: IScene, layer: ILayer) {\n\tconst i = scene.layers.indexOf(layer);\n\tif (i === -1) return scene;\n\tif (layer.type === LayerType.ASSETS) {\n\t\tfor (const asset of Array.from((layer as IAssetLayer).assets.values())) {\n\t\t\tawait deleteAsset(asset);\n\t\t}\n\t}\n\tscene.layers.splice(i, 1);\n\treturn scene;\n}\n// delete layer w/ assets","import React, { useEffect, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { singletonHook } from 'react-singleton-hook';\nimport { DarkMode } from 'sancho';\nimport Toolbar from './toolbar';\n\nconst useToolbarPortal = singletonHook([undefined, () => { }], () => useState<HTMLElement | undefined>(undefined));\n\nconst ToolbarPortal: React.SFC = ({ children }) => {\n\tconst [portal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tif (portal) {\n\t\t\tReactDOM.render(<DarkMode>{children}</DarkMode>, portal);\n\t\t\treturn () => ReactDOM.unmountComponentAtNode(portal);\n\t\t}\n\t\treturn () => { }\n\t}, [children, portal])\n\n\treturn null;\n}\nexport default ToolbarPortal;\n\nexport const ToolbarPortalProvider: React.SFC = ({ children }) => {\n\tconst node = useRef<HTMLSpanElement>();\n\tconst [, setPortal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tconsole.log('set portal')\n\t\tsetPortal(node.current);\n\t}, [node, setPortal]);\n\n\treturn (\n\t\t<>\n\t\t\t<Toolbar>\n\t\t\t\t<span ref={node as any} />\n\t\t\t</Toolbar>\n\t\t\t{children}\n\t\t</>\n\t)\n}","import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { Layer } from \"react-konva\";\nimport ImageAsset from './imageAsset';\nimport VideoAsset from './videoAsset';\nimport { IAsset, AssetType, deleteAsset, getNewAssets } from '../../asset';\nimport { ILayer, ILayerComponentProps } from '..';\nimport Konva from 'konva';\nimport { IconFilePlus, IconTrash2 } from 'sancho';\nimport ToolbarItem from '../toolbarItem';\nimport ToolbarPortal from '../toolbarPortal';\n\nexport interface IAssetComponentProps<T extends IAsset> {\n\tasset: T;\n\tonUpdate: (asset: T) => void;\n\tselected: boolean;\n\tonSelected: () => void;\n}\n\nexport const AssetTypeToComponent = {\n\t[AssetType.IMAGE]: ImageAsset,\n\t[AssetType.VIDEO]: VideoAsset\n} as { [type: string]: React.SFC<IAssetComponentProps<any>> }\n\nexport interface IAssetLayer extends ILayer {\n\tassets: Map<string, IAsset>\n}\n\ninterface Props extends ILayerComponentProps<IAssetLayer> { }\nconst AssetLayer: React.SFC<Props> = ({ layer, onUpdate, active: layerActive }) => {\n\tconst [selectedAsset, setSelectedAsset] = useState<string | null>(null);\n\tconst layerRef = useRef<Konva.Layer>();\n\n\tconst deleteSelectedAsset = useCallback(async () => {\n\t\tif (selectedAsset && layer.assets.has(selectedAsset)) {\n\t\t\tconst asset = layer.assets.get(selectedAsset)!;\n\t\t\tlayer.assets.delete(selectedAsset);\n\t\t\tawait deleteAsset(asset);\n\t\t\tonUpdate({ ...layer });\n\t\t\tsetSelectedAsset(null);\n\t\t}\n\t}, [selectedAsset, layer, onUpdate, setSelectedAsset])\n\n\t// Animate the layer if there are any video assets\n\tuseEffect(() => {\n\t\tif (!layerRef.current) return;\n\t\tif (!Array.from(layer.assets.values()).some((asset) => asset.type === AssetType.VIDEO)) return;\n\n\t\tconst anim = new Konva.Animation(() => { }, layerRef.current);\n\t\tanim.start();\n\t\treturn () => { anim.stop() }\n\t}, [layerRef, layer])\n\n\t// Reset selected asset when active layer changes\n\tuseEffect(() => {\n\t\tif (!layerActive && selectedAsset !== null) {\n\t\t\tsetSelectedAsset(null);\n\t\t}\n\t}, [layerActive, selectedAsset])\n\n\tconst toolbar = useMemo(() => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconFilePlus />}\n\t\t\t\t\tlabel=\"Add Asset\"\n\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\tconst assets = await getNewAssets();\n\t\t\t\t\t\tfor (const asset of assets) {\n\t\t\t\t\t\t\tlayer.assets.set(asset.id, asset);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonUpdate({ ...layer })\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\tlabel=\"Delete Asset\"\n\t\t\t\t\tdisabled={selectedAsset === null}\n\t\t\t\t\tonClick={deleteSelectedAsset}\n\t\t\t\t\tkeyboardShortcuts={['Delete', 'Backspace']}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}, [layer, selectedAsset, onUpdate, deleteSelectedAsset]);\n\n\treturn (\n\t\t<>\n\t\t\t{layerActive && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n\t\t\t<Layer ref={layerRef as any}>\n\t\t\t\t{\n\t\t\t\t\tArray.from(layer.assets.values())\n\t\t\t\t\t\t.map((asset) => {\n\t\t\t\t\t\t\tconst Component = AssetTypeToComponent[asset.type];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\t\tkey={asset.id}\n\t\t\t\t\t\t\t\t\tasset={asset}\n\t\t\t\t\t\t\t\t\tselected={layerActive && selectedAsset === asset.id}\n\t\t\t\t\t\t\t\t\tonSelected={() => layerActive && setSelectedAsset(asset.id)}\n\t\t\t\t\t\t\t\t\tonUpdate={(updatedAsset) => {\n\t\t\t\t\t\t\t\t\t\tlayer.assets.set(updatedAsset.id, updatedAsset);\n\t\t\t\t\t\t\t\t\t\tonUpdate({ ...layer });\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</Layer>\n\t\t</>\n\t);\n}\nexport default AssetLayer;","import { v4 } from \"uuid\";\n\nimport useGlobalStorage from \"../storage\";\nimport { ILayer, LayerType } from \"./layer\";\nimport { IAssetLayer } from \"./layer/assetLayer\";\n\nexport interface IScene {\n\tid: string;\n\tname: string;\n\tlayers: Array<ILayer>;\n}\n\nconst storage = useGlobalStorage<IScene>('scene');\nexport function useSceneDatabase() {\n\treturn storage;\n}\n\nexport function createNewScene(): IScene {\n\treturn {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\tlayers: [\n\t\t\t{\n\t\t\t\tid: v4(),\n\t\t\t\ttype: LayerType.ASSETS,\n\t\t\t\tname: 'Layer 1',\n\t\t\t\tassets: new Map()\n\t\t\t} as IAssetLayer\n\t\t]\n\t};\n}","import useGlobalStorage from \"../storage\";\nimport React, { useState, SetStateAction, Dispatch } from \"react\";\nimport { IconButton, useTheme, IconSettings, Dialog, Tooltip, Text, InputGroup, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nexport enum Settings {\n  DISPLAYED_SCENE = 'displayed_scene',\n  TABLE_FREEZE = 'table_freeze',\n  TABLE_RESOLUTION = 'table_resolution',\n  TABLE_SIZE = 'table_size'\n}\n\nconst storage = useGlobalStorage<unknown>('settings');\nexport function useSettingsDatabase() {\n  return storage;\n}\n\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype TableResolution = { width: number, height: number };\nexport function useTableResolution(): [TableResolution | undefined, Dispatch<SetStateAction<TableResolution>>] {\n  const [tableResolution, setTableResolution] = useOneSettingValue<TableResolution>(Settings.TABLE_RESOLUTION);\n\n  if (tableResolution === null) {\n    return [\n      { width: 1920, height: 1080 },\n      setTableResolution\n    ]\n  }\n\n  return [tableResolution, setTableResolution];\n}\n\nexport function useTableSize(): [number | undefined, Dispatch<SetStateAction<number>>] {\n  const [tableSize, setTableSize] = useOneSettingValue<number>(Settings.TABLE_SIZE);\n\n  if (tableSize === null) {\n    return [\n      45,\n      setTableSize\n    ]\n  }\n\n  return [tableSize, setTableSize];\n}\n\nexport function useTablePPI(): number | null {\n  const [tableResolution] = useTableResolution();\n\tconst [tableSize] = useTableSize();\n\tif (!tableResolution || !tableSize) {\n\t\treturn null;\n  }\n  \n  const theta = Math.atan(tableResolution.height / tableResolution.width);\n\tconst widthInch = tableSize * Math.cos(theta);\n\t// const heightInch = tableSize * Math.sin(theta);\n\n  const ppi = tableResolution.width / widthInch;\n  return ppi;\n}\n\nconst ScreenSizeSettings: React.SFC = () => {\n  const theme = useTheme();\n  \n  const [tableResolution, setTableResolution] = useTableResolution();\n  const [tableSize, setTableSize] = useTableSize();\n\n  const formItemMargin = css`margin: 0 ${theme.spaces.sm};`;\n  \n  if (tableResolution === undefined || tableSize === undefined) {\n    return null;\n  }\n\n  return (\n    <>\n      <Text variant=\"h6\">Table Display Settings</Text>\n      <InputGroup label=\"Resolution\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"width\"\n            value={tableResolution.width}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, width: value })\n              }\n            }}\n          />\n          <div className={formItemMargin}>x</div>\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"height\"\n            value={tableResolution.height}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, height: value })\n              }\n            }}\n          />\n        </div>\n      </InputGroup>\n      <InputGroup label=\"Screen Size\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            value={tableSize}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableSize(value)\n              }\n            }}\n          />\n          <div className={formItemMargin}>inches</div>\n        </div>\n      </InputGroup>\n    </>\n  );\n}\n\nconst SettingsSidebarItem: React.SFC = () => {\n  const theme = useTheme();\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  return (\n    <>\n      <Tooltip content=\"Settings\" placement=\"right\">\n        <IconButton\n          variant=\"ghost\"\n          color={theme.colors.text.muted}\n          size=\"lg\"\n          icon={<IconSettings />}\n          label=\"Settings\"\n          onClick={() => setDialogOpen(true)}\n        />\n      </Tooltip>\n      <Dialog\n        isOpen={dialogOpen}\n        onRequestClose={() => setDialogOpen(false)}\n        title=\"Settings\"\n      >\n        <div className={css`padding: ${theme.spaces.lg};`}>\n          <ScreenSizeSettings />\n        </div>\n      </Dialog>\n    </>\n  );\n}\nexport default SettingsSidebarItem;","import React from \"react\";\nimport { List, ListItem, Skeleton, Input, useTheme, IconButton, IconPlusCircle, Button, IconPlus, IconFilm, IconPlay, IconPause } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { IScene, useSceneDatabase, createNewScene } from \".\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\n\nconst { useAllValues, createItem } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nexport const SCENE_LIST_WIDTH = 240;\n\nfunction LoadingScenes() {\n  return <List><ListItem primary={<Skeleton animated />} /></List>\n}\n\nfunction NoScenes(props: { onAdd: () => void }) {\n  const theme = useTheme();\n\n  return (\n    <div\n      className={css`\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      `}\n    >\n      <div\n        className={css`\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      `}\n      >\n        <IconFilm size=\"xl\" color=\"#BDBEBF\" />\n        <Button iconBefore={<IconPlus />} variant=\"ghost\" color={theme.colors.text.muted} onClick={props.onAdd}>Add a scene</Button>\n      </div>\n    </div>\n  )\n}\n\nfunction SceneStatusIcon({ scene }: { scene: IScene }) {\n  const theme = useTheme();\n  const [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n  const [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n  if (displayedScene === scene.id) {\n    if (!tableFreeze) {\n      return <IconPlay color={theme.colors.palette.green.base} />;\n    }\n    else {\n      return <IconPause color={theme.colors.palette.yellow.base} />;\n    }\n  }\n  else {\n    return null;\n  }\n}\n\ntype Props = { onSceneSelect: (scene: IScene) => any, selectedSceneId: string };\nconst SceneList: React.SFC<Props> = ({ onSceneSelect, selectedSceneId }) => {\n  const theme = useTheme();\n\n  const allValues = useAllValues();\n\n  function addNewScene() {\n    const scene = createNewScene();\n    createItem(scene.id, scene);\n    onSceneSelect(scene);\n  }\n\n  if (!allValues) {\n    return <LoadingScenes />\n  }\n\n  if (allValues.size === 0) {\n    return <NoScenes onAdd={addNewScene} />\n  }\n\n  return (\n    <List\n      className={css`\n        width: ${SCENE_LIST_WIDTH}px;\n        flex-shrink: 0;\n        display: flex;\n        flex-direction: column;\n        z-index: 300;\n      `}\n    >\n      <div\n        className={css`\n          display: flex;\n          padding: ${theme.spaces.sm};\n        `}\n      >\n        <Input type=\"search\" placeholder=\"Find a scene...\" />\n        <IconButton icon={<IconPlusCircle />} label=\"Add Scene\" variant=\"ghost\" onClick={addNewScene} />\n      </div>\n      <div\n        className={css`\n          overflow: auto;\n        `}\n      >\n        {Array.from(allValues.values()).map((scene) => (\n          <ListItem\n            primary={scene.name}\n            key={scene.id}\n            contentAfter={<SceneStatusIcon scene={scene} />}\n            onPress={() => onSceneSelect(scene)}\n            className={css`\n              background: ${selectedSceneId === scene.id ? theme.colors.intent.primary.dark : undefined} !important;\n            `}\n          />\n        ))}\n      </div>\n    </List>\n  );\n};\nexport default SceneList;","import React, { useRef, useState } from 'react';\nimport useComponentSize from '@rehooks/component-size';\nimport { css } from 'emotion';\nimport Konva from 'konva';\nimport { Stage } from 'react-konva';\nimport { useTheme } from 'sancho';\nimport { SCENE_LIST_WIDTH } from '../list';\nimport { HEADER_HEIGHT } from '../editor';\n\nconst ZOOM_SPEED = 1.1;\n\ntype Props = { onClick?: () => void, draggable?: boolean };\nconst DraggableStage: React.SFC<Props> = ({ children, onClick, draggable }) => {\n\tconst theme = useTheme();\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst containerSize = useComponentSize(containerRef);\n\tconst stageRef = useRef<Konva.Stage>();\n\n\tconst [zoom, setZoom] = useState(1);\n\n\treturn (\n\t\t<div\n\t\t\tref={containerRef}\n\t\t\tclassName={css`\n\t\t\t\tflex-grow: 2;\n\t\t\t\twidth: calc(100vw - ${SCENE_LIST_WIDTH + 48}px);\n\t\t\t\theight: calc(100vh - ${HEADER_HEIGHT}px);\n\t\t\t\t\n\t\t\t\tbackground-color: ${theme.colors.background.tint2};\n\t\t\t\tbackground-image: linear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1}),\n\t\t\t\tlinear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1});\n\t\t\t\tbackground-size: 20px 20px;\n\t\t\t\tbackground-position: 0 0, 10px 10px;\n\t\t\t`}\n\t\t>\n\t\t\t<Stage\n\t\t\t\tref={stageRef as any}\n\t\t\t\twidth={containerSize.width}\n\t\t\t\theight={containerSize.height}\n\t\t\t\tdraggable={draggable === undefined ? true : draggable}\n\t\t\t\tonClick={onClick}\n\t\t\t\tscale={{ x: zoom, y: zoom }}\n\t\t\t\tonWheel={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\t\t\t\t\tconst oldScale = zoom;\n\n\t\t\t\t\tconst stage = stageRef.current!;\n\t\t\t\t\tconst pointer = stage.getPointerPosition();\n\n\t\t\t\t\tif (!pointer) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar mousePointTo = {\n\t\t\t\t\t\tx: (pointer.x - stage.x()) / oldScale,\n\t\t\t\t\t\ty: (pointer.y - stage.y()) / oldScale,\n\t\t\t\t\t};\n\n\t\t\t\t\tvar newZoom =\n\t\t\t\t\t\te.evt.deltaY > 0 ? oldScale / ZOOM_SPEED : oldScale * ZOOM_SPEED;\n\n\t\t\t\t\tsetZoom(newZoom);\n\n\t\t\t\t\tvar newPos = {\n\t\t\t\t\t\tx: pointer.x - mousePointTo.x * newZoom,\n\t\t\t\t\t\ty: pointer.y - mousePointTo.y * newZoom,\n\t\t\t\t\t};\n\t\t\t\t\tstage.position(newPos);\n\t\t\t\t\tstage.batchDraw();\n\t\t\t\t}}\n\t\t\t\tonContextMenu={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Stage>\n\t\t</div>\n\t);\n}\nexport default DraggableStage;","import { IScene } from \"..\";\nimport { LayerType } from \"../layer\";\nimport { useTheme, Layer, List, ListItem, IconButton, IconTrash2, Popover, MenuList, MenuItem, IconFile, IconCloudDrizzle, IconPlus, Avatar, Text, IconArrowUp, IconArrowDown } from \"sancho\";\nimport React from \"react\";\nimport { css } from \"emotion\";\n\ntype Props = {\n\tscene: IScene,\n\tactiveLayer: string | null,\n\tsetActiveLayer: (layer: string) => void,\n\taddLayer: (type: LayerType) => void,\n\teditActiveLayerName: (name: string) => void, // TODO\n\tmoveActiveLayer: (direction: \"up\" | \"down\") => void;\n\tdeleteActiveLayer: () => void\n};\nconst LayerList: React.SFC<Props> = ({ scene, activeLayer, setActiveLayer, addLayer, moveActiveLayer, deleteActiveLayer }) => {\n\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayer);\n\tconst isActiveLayerTop = layerIndex === scene.layers.length - 1;\n\tconst isActiveLayerBottom = layerIndex === 0;\n\t\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: absolute;\n\t\t\t\tright: ${theme.spaces.md};\n\t\t\t\tbottom: ${theme.spaces.md};\n\t\t\t`}\n\t\t>\n\t\t\t<Layer\n\t\t\t\tclassName={css`\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twidth: 300px;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<List\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tmax-height: 350px;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{Array.from(scene.layers).reverse().map((layer) => (\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\t\tbackground-color: ${activeLayer === layer.id ? theme.colors.intent.primary.base : 'initial'} !important;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\tcontentBefore={<Avatar name={layer.name} />}\n\t\t\t\t\t\t\tprimary={layer.name}\n\t\t\t\t\t\t\tcontentAfter={<Text variant=\"subtitle\">{LayerType[layer.type]}</Text>}\n\t\t\t\t\t\t\tonClick={() => setActiveLayer(layer.id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{/* Delete Layer */}\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tdisabled={activeLayer === null}\n\t\t\t\t\t\tcolor={theme.colors.intent.danger.base}\n\t\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\t\tlabel=\"Delete Layer\"\n\t\t\t\t\t\tonClick={deleteActiveLayer}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* Move Layer */}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayer === null || isActiveLayerTop}\n\t\t\t\t\t\t\ticon={<IconArrowUp />}\n\t\t\t\t\t\t\tlabel=\"Layer Up\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('up')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayer === null || isActiveLayerBottom}\n\t\t\t\t\t\t\ticon={<IconArrowDown />}\n\t\t\t\t\t\t\tlabel=\"Layer Down\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('down')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Add Layer Button */}\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tplacement=\"top-end\"\n\t\t\t\t\t\tcontent={\n\t\t\t\t\t\t\t<MenuList>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconFile />} onPress={() => addLayer(LayerType.ASSETS)}>Asset Layer</MenuItem>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconCloudDrizzle />} onPress={() => addLayer(LayerType.FOG)}>Fog Layer</MenuItem>\n\t\t\t\t\t\t\t</MenuList>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<IconButton variant=\"ghost\" icon={<IconPlus />} label=\"Add Layer\" />\n\t\t\t\t\t</Popover>\n\t\t\t\t</div>\n\t\t\t</Layer>\n\t\t</div>\n\t);\n}\nexport default LayerList;","import React, { useState, useEffect, useCallback } from 'react';\nimport { Layer, Rect, Line } from 'react-konva';\nimport { useTheme } from 'sancho';\n\nimport { IScene } from '..';\nimport DraggableStage from './draggableStage';\nimport { useTableResolution, useTablePPI } from '../../settings';\nimport { Vector2d } from 'konva/types/types';\nimport { LayerTypeToComponent, LayerType, ILayer, createNewLayer } from '../layer';\nimport { deleteLayer } from '../layer';\nimport LayerList from './layerList';\nimport { ToolbarPortalProvider } from '../layer/toolbarPortal';\n\nconst TableViewOverlay: React.SFC<{ offset: Vector2d, rotation: number, showBorder: boolean, showGrid: boolean }> = ({ offset, rotation, showGrid, showBorder }) => {\n\tconst theme = useTheme();\n\tconst [tableResolution] = useTableResolution();\n\tconst ppi = useTablePPI();\n\n\tif (!tableResolution || ppi === null) {\n\t\treturn null;\n\t}\n\n\tconst lines = new Array<{ start: Vector2d, end: Vector2d }>();\n\n\tif (showGrid) {\n\t\tfor (let xOffset = 0; xOffset <= tableResolution.width; xOffset += ppi) {\n\t\t\tlines.push({\n\t\t\t\tstart: { x: xOffset, y: 0 },\n\t\t\t\tend: { x: xOffset, y: tableResolution.height }\n\t\t\t})\n\t\t}\n\n\t\tfor (let yOffset = 0; yOffset <= tableResolution.height; yOffset += ppi) {\n\t\t\tlines.push({\n\t\t\t\tstart: { x: 0, y: yOffset },\n\t\t\t\tend: { x: tableResolution.width, y: yOffset }\n\t\t\t})\n\t\t}\n\t}\n\n\treturn (\n\t\t<Layer>\n\t\t\t{lines.map((line, i) => (\n\t\t\t\t<Line\n\t\t\t\t\tkey={i}\n\t\t\t\t\tx={offset.x}\n\t\t\t\t\ty={offset.y}\n\t\t\t\t\trotation={rotation}\n\t\t\t\t\tpoints={[line.start.x, line.start.y, line.end.x, line.end.y]}\n\t\t\t\t\tstroke={theme.colors.palette.gray.dark}\n\t\t\t\t\tdash={[1, 1]}\n\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t/>\n\t\t\t))}\n\t\t\t{showBorder &&\n\t\t\t\t<Rect\n\t\t\t\t\tx={offset.x}\n\t\t\t\t\ty={offset.y}\n\t\t\t\t\trotation={rotation}\n\t\t\t\t\twidth={tableResolution.width}\n\t\t\t\t\theight={tableResolution.height}\n\t\t\t\t\tstroke={theme.colors.palette.gray.light}\n\t\t\t\t\tdash={[10, 10]}\n\t\t\t\t\tstrokeWidth={5}\n\t\t\t\t\tlistening={false}\n\t\t\t\t/>\n\t\t\t}\n\t\t</Layer>\n\t)\n}\n\ntype Props = { scene: IScene, onUpdate: (scene: IScene) => void };\nconst Canvas: React.SFC<Props> = ({ scene, onUpdate }) => {\n\tconst [activeLayer, setActiveLayer] = useState<string | null>(null);\n\n\t// Default selected layer to the first layer\n\tuseEffect(() => {\n\t\tif (\n\t\t\t(activeLayer === null || !scene.layers.some((l) => l.id === activeLayer)) &&\n\t\t\tscene.layers.length\n\t\t) {\n\t\t\tsetActiveLayer(scene.layers[0].id);\n\t\t}\n\t}, [activeLayer, scene])\n\n\tconst onLayerUpdate = useCallback((updatedLayer: ILayer) => {\n\t\tconst i = scene.layers.findIndex((l) => l.id === updatedLayer.id);\n\t\tscene.layers[i] = updatedLayer;\n\t\tonUpdate({ ...scene })\n\t}, [scene, onUpdate]);\n\n\tfunction addLayer(type: LayerType) {\n\t\tconst layer = createNewLayer(type);\n\t\tlayer.name = 'Layer ' + (scene.layers.length + 1);\n\t\tscene.layers.push(layer);\n\t\tonUpdate({ ...scene });\n\t}\n\n\tfunction editActiveLayerName(name: string) {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayer);\n\t\tif (!layer) return;\n\n\t\tlayer.name = name;\n\t\tonUpdate({\n\t\t\t...scene,\n\t\t\tlayers: [...scene.layers]\n\t\t});\n\t}\n\n\tfunction moveActiveLayer(direction: 'up' | 'down') {\n\t\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayer);\n\t\tif (layerIndex !== -1) {\n\t\t\tconst swapIndex = direction === 'up' ? layerIndex + 1 : layerIndex - 1;\n\t\t\tif (swapIndex > scene.layers.length - 1 || swapIndex < 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentLayer = scene.layers[layerIndex];\n\t\t\tconst layerToSwap = scene.layers[swapIndex];\n\n\t\t\tscene.layers[swapIndex] = currentLayer;\n\t\t\tscene.layers[layerIndex] = layerToSwap;\n\n\t\t\tonUpdate({\n\t\t\t\t...scene,\n\t\t\t\tlayers: [...scene.layers]\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function deleteActiveLayer() {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayer);\n\t\tif (layer) {\n\t\t\tconst newScene = await deleteLayer(scene, layer);\n\t\t\tonUpdate({\n\t\t\t\t...newScene,\n\t\t\t\tlayers: [...newScene.layers]\n\t\t\t});\n\t\t\tsetActiveLayer(null);\n\t\t}\n\t}\n\n\treturn (\n\t\t<ToolbarPortalProvider>\n\t\t\t{/* Canvas */}\n\t\t\t<DraggableStage>\n\t\t\t\t{\n\t\t\t\t\tscene.layers.map((layer) => {\n\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\tif (!Component) return null;\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\tonUpdate={onLayerUpdate}\n\t\t\t\t\t\t\t\tactive={activeLayer === layer.id}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t<TableViewOverlay offset={{ x: 0, y: 0 }} rotation={0} showGrid={true} showBorder={true} />\n\t\t\t</DraggableStage>\n\n\t\t\t<LayerList\n\t\t\t\tscene={scene}\n\t\t\t\tactiveLayer={activeLayer}\n\t\t\t\tsetActiveLayer={setActiveLayer}\n\t\t\t\taddLayer={addLayer}\n\t\t\t\teditActiveLayerName={editActiveLayerName}\n\t\t\t\tmoveActiveLayer={moveActiveLayer}\n\t\t\t\tdeleteActiveLayer={deleteActiveLayer}\n\t\t\t/>\n\t\t</ToolbarPortalProvider>\n\t);\n}\nexport default Canvas;","import React, { useState, useEffect } from \"react\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport { Spinner, Text, useTheme, IconButton, IconPlay, IconRotateCcw, IconRotateCw, IconPause, IconUpload, IconEdit2, IconCheck, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { useSceneDatabase, IScene } from \".\";\nimport Canvas from \"./canvas\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nexport const HEADER_HEIGHT = 56;\n\nfunction SceneNameHeader({ name, onUpdate: updateName }: { name: string, onUpdate: (name: string) => void }) {\n\tconst theme = useTheme();\n\tconst [inEdit, setInEdit] = useState(false);\n\tconst [localName, setLocalName] = useState(name);\n\n\tuseEffect(() => {\n\t\tsetLocalName(name);\n\t}, [name]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 200;\n\t\t\t`}\n\t\t>\n\t\t\t{!inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Text variant=\"lead\">{name}</Text>\n\t\t\t\t\t<IconButton icon={<IconEdit2 />} size=\"sm\" variant=\"ghost\" label=\"Edit Name\" onClick={() => setInEdit(true)} />\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Input value={localName} onChange={(e) => setLocalName(e.target.value)} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon={<IconCheck />}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tcolor={theme.colors.intent.success.base}\n\t\t\t\t\t\tlabel=\"Save Name\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tupdateName(localName);\n\t\t\t\t\t\t\tsetInEdit(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!localName.trim()}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t}\n\t\t</div >\n\t);\n}\n\nfunction TableDisplayButton({ scene }: { scene: IScene }) {\n\tconst theme = useTheme();\n\tconst [displayedScene, updateDisplayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze, updateTableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n\tif (displayedScene === scene.id) {\n\t\tif (tableFreeze) {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPlay />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Unfreeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.green.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(false)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t\telse {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPause />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Freeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.yellow.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(true)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t}\n\telse {\n\t\treturn (\n\t\t\t<IconButton\n\t\t\t\ticon={<IconUpload />}\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel=\"Display on Table\"\n\t\t\t\tcolor={theme.colors.text.heading} onPress={() => {\n\t\t\t\t\tupdateDisplayedScene(scene.id);\n\t\t\t\t\tupdateTableFreeze(false)\n\t\t\t\t}}\n\t\t\t/>\n\t\t)\n\t}\n}\n\ntype Props = {};\nconst SceneEditor: React.SFC<Props> = () => {\n\tconst theme = useTheme();\n\n\tconst match = useRouteMatch<{ id: string }>();\n\tconst [scene, updateScene] = useOneValue(match.params.id);\n\n\tif (!match.params.id) {\n\t\treturn null;\n\t}\n\n\tif (scene === undefined) {\n\t\treturn <Spinner label=\"Loading scene...\" center />\n\t}\n\t\n\tif (scene === null) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-grow: 1;\n\t\t\t`}\n\t\t>\n\t\t\t{/* Header */}\n\t\t\t<div\n\t\t\t\tclassName={css`\n\t\t\t\t\tbackground-color: ${theme.colors.background.layer};\n\t\t\t\t\tpadding: ${theme.spaces.sm} ${theme.spaces.md};\n\t\t\t\t\tbox-shadow: ${theme.shadows.sm};\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\theight: ${HEADER_HEIGHT}px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<SceneNameHeader name={scene.name} onUpdate={(name) => updateScene({ ...scene, name })} />\n\t\t\t\t<div>\n\t\t\t\t\t<IconButton icon={<IconRotateCcw />} variant=\"ghost\" label=\"Undo\" />\n\t\t\t\t\t<IconButton icon={<IconRotateCw />} variant=\"ghost\" label=\"Redo\" />\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<TableDisplayButton scene={scene} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Canvas */}\n\t\t\t<Canvas scene={scene} onUpdate={updateScene} />\n\t\t</div>\n\t);\n}\nexport default SceneEditor;","import React from \"react\";\nimport { css } from 'emotion'\nimport { Global } from '@emotion/core'\nimport { useTheme } from 'sancho';\nimport { Helmet } from 'react-helmet';\nimport { Switch, Route, useRouteMatch, useHistory } from \"react-router-dom\";\n\nimport SceneEditor from \"../scene/editor\";\nimport SceneList from \"../scene/list\";\nimport { IScene } from \".\";\n\nfunction useCurrentSelectedScene() {\n  const routeMatch = useRouteMatch();\n  const matchedSceneRoute = useRouteMatch<{ id: string }>({ path: routeMatch.path + '/:id' });\n  return matchedSceneRoute?.params.id;\n}\n\ntype Props = {};\nconst ScenePage: React.SFC<Props> = () => {\n  const theme = useTheme();\n  const history = useHistory();\n  const routeMatch = useRouteMatch();\n\n  const currentSelectedScene = useCurrentSelectedScene();\n\n  function onSceneSelect(scene: IScene) {\n    history.push(`${routeMatch.path}/${scene.id}`)\n  }\n\n  return (\n    <>\n      <Helmet\n        title='D&amp;D Tabletop'\n      />\n      <Global\n        styles={{\n          html: {\n            background: theme.colors.background.default,\n            color: theme.colors.text.default,\n            fontFamily: theme.fonts.base,\n          },\n          body: {\n            padding: 0,\n            margin: 0,\n            width: '100vw',\n            height: '100vh',\n            \"*:focus\": {\n              outline: 'none'\n            },\n            overflow: 'hidden'\n          }\n        }}\n      />\n      <Switch>\n        <Route path={[`${routeMatch.path}`, `${routeMatch.path}/:id`]} exact>\n          <div\n            className={css`\n              display: flex;\n              flex-direction: row;\n              width: 100%;\n              height: 100vh;\n            `}\n          >\n            <SceneList onSceneSelect={onSceneSelect} selectedSceneId={currentSelectedScene!} />\n            <SceneEditor />\n          </div>\n        </Route>\n      </Switch>\n    </>\n  );\n};\nexport default ScenePage;","import React, { useState, useEffect } from 'react';\nimport { useSettingsDatabase, Settings } from '../settings';\nimport { useSceneDatabase, IScene } from '../scene';\nimport { Stage } from 'react-konva';\nimport { Global } from '@emotion/core';\nimport { Helmet } from 'react-helmet';\nimport { LayerTypeToComponent } from '../scene/layer';\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype Props = {};\nconst TablePage: React.SFC<Props> = () => {\n\tconst [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n\tconst [scene] = useOneValue(displayedScene as string);\n\tconst [tableScene, setTableScene] = useState<IScene | null>();\n\n\tconst [windowSize, setWindowSize] = useState({ width: window.innerWidth, height: window.innerHeight })\n\n\tuseEffect(() => {\n\t\tif (!tableFreeze && scene) {\n\t\t\tsetTableScene(scene);\n\t\t}\n\t}, [scene, tableFreeze])\n\n\tuseEffect(() => {\n\t\tfunction onResize() {\n\t\t\tsetWindowSize({ width: window.innerWidth, height: window.innerHeight });\n\t\t}\n\t\twindow.addEventListener('resize', onResize);\n\t\treturn () => window.removeEventListener('resize', onResize)\n\t}, [])\n\n\treturn (\n\t\t<>\n\t\t\t<Global\n\t\t\t\tstyles={{\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tbackground: 'black',\n\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<Helmet title=\"D&amp;D Table View\" />\n\t\t\t{tableScene &&\n\t\t\t\t<Stage\n\t\t\t\t\t{...windowSize}\n\t\t\t\t>\n\t\t\t\t\t{\n\t\t\t\t\t\ttableScene.layers.map((layer) => {\n\t\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\t\tif (!Component) return null;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\t\tonUpdate={() => { }}\n\t\t\t\t\t\t\t\t\tactive={false}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t</Stage>\n\t\t\t}\n\t\t</>\n\t)\n}\nexport default TablePage;","import React from 'react';\nimport { useRouteMatch, Link, useLocation } from 'react-router-dom';\nimport { css } from \"emotion\";\nimport { useTheme, IconButton, Tooltip } from 'sancho';\n\nimport routes, { IRoute } from './routes';\nimport SettingsSidebarItem from './settings';\n\nexport const SIDEBAR_WIDTH = 48;\n\ntype Props = { route: IRoute }\nconst SidebarItem: React.SFC<Props> = ({ route }) => {\n\tconst theme = useTheme();\n\tconst match = !!useRouteMatch({\n\t\tpath: route.path,\n\t\texact: route.exact\n\t});\n\n\treturn (\n\t\t<Link to={route.path} target={route.popout ? '_blank' : undefined}>\n\t\t\t<Tooltip content={route.name} placement=\"right\">\n\t\t\t\t<IconButton variant=\"ghost\" color={match ? theme.colors.text.default : theme.colors.text.muted} size=\"lg\" icon={<route.sidebarIcon />} label={route.name} />\n\t\t\t</Tooltip>\n\t\t</Link>\n\t)\n}\n\nconst Sidebar: React.SFC = () => {\n\tconst theme = useTheme();\n\tconst location = useLocation();\n\n\tconst hideSidebar = Object.keys(routes)\n\t\t.map((routeName) => routes[routeName])\n\t\t.some((route) => route.exact && route.popout && route.path === location.pathname) || location.pathname === routes.home.path;\n\n\tif (hideSidebar) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\twidth: ${SIDEBAR_WIDTH}px;\n\t\t\t\theight: 100vh;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tbackground-color: ${theme.colors.background.tint2};\n\t\t\t`}\n\t\t>\n\t\t\t{Object.keys(routes).map(routeName => {\n\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\treturn <SidebarItem key={routeName} route={route} />\n\t\t\t})}\n\t\t\t<div className={css`flex-grow: 1;`}/>\n\t\t\t<SettingsSidebarItem />\n\t\t</div>\n\t)\n}\nexport default Sidebar;","import React from \"react\";\nimport ScenePage from \"./scene/page\";\nimport TablePage from \"./table/page\";\nimport { IconFilm, IconMap } from \"sancho\";\nimport { SIDEBAR_WIDTH } from \"./sidebar\";\n\nexport interface IRoute {\n\tname: string;\n\tpath: string;\n\tsidebarIcon: React.ComponentType<any>,\n\tmain: React.ComponentType<any>;\n\tpopout?: boolean;\n\texact?: boolean;\n}\n\nconst routes = {\n\thome: {\n\t\tname: 'Home',\n\t\tpath: '/',\n\t\tsidebarIcon: () => <img width={SIDEBAR_WIDTH / 1.5} height={SIDEBAR_WIDTH / 1.5} src=\"/favicon.png\" alt=\"home icon\" />,\n\t\tmain: () => <></>,\n\t\texact: true,\n\t},\n\tscenes: {\n\t\tname: 'Scenes',\n\t\tpath: '/scenes',\n\t\tsidebarIcon: IconFilm,\n\t\tmain: () => <ScenePage />,\n\t},\n\ttable: {\n\t\tname: 'Table View',\n\t\tpath: '/table',\n\t\tsidebarIcon: IconMap,\n\t\tmain: () => <TablePage />,\n\t\tpopout: true,\n\t\texact: true,\n\t}\n} as { [key: string]: IRoute }\n\nexport default routes;","import React from 'react';\nimport {\n\tBrowserRouter as Router,\n\tSwitch,\n\tRoute,\n\tRedirect\n} from 'react-router-dom';\nimport { DarkMode } from 'sancho';\nimport { css } from 'emotion';\n\nimport routes from './routes';\nimport Sidebar from './sidebar';\n\nconst App: React.SFC = () => {\n\treturn (\n\t\t<DarkMode>\n\t\t\t<Router>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<Sidebar />\n\t\t\t\t\t<Switch>\n\t\t\t\t\t\t{Object.keys(routes).map((routeName) => {\n\t\t\t\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\t\t\tkey={routeName}\n\t\t\t\t\t\t\t\t\tpath={route.path}\n\t\t\t\t\t\t\t\t\texact={route.exact}\n\t\t\t\t\t\t\t\t\tcomponent={route.main}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t<Redirect to={routes.scenes.path} />\n\t\t\t\t\t</Switch>\n\t\t\t\t</div>\n\t\t\t</Router>\n\t\t</DarkMode>\n\t);\n}\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(<App/>, document.getElementById('root'));"],"sourceRoot":""}