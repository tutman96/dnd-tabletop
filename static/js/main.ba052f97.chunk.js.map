{"version":3,"sources":["storage.ts","scene/asset/assetSize.tsx","scene/asset/index.tsx","scene/asset/storage.ts","utils.tsx","scene/canvas/transformableAsset.tsx","scene/layer/assetLayer/asset.tsx","scene/layer/toolbarItem.tsx","scene/layer/toolbar.tsx","scene/layer/toolbarPortal.tsx","scene/layer/assetLayer/advancedAssetSizer.tsx","scene/canvas/draggableStage.tsx","theme.tsx","settings/index.tsx","scene/layer/assetLayer/visualAssetSizer.tsx","scene/layer/assetLayer/assetSizer.tsx","scene/layer/assetLayer/index.tsx","scene/layer/index.tsx","scene/index.tsx","scene/canvas/layerList.tsx","scene/layer/tableView.tsx","scene/canvas/index.tsx","scene/editor.tsx","scene/list.tsx","scene/page.tsx","table/page.tsx","routes.tsx","sidebar.tsx","App.tsx","index.tsx"],"names":["RTStorage","require","useGlobalStorage","name","storage","useAllValues","useState","data","setState","useEffect","handleStorageChange","keys","then","a","items","Map","Promise","all","map","k","getItem","item","set","subscription","subscribe","unsubscribe","useOneValue","key","undefined","lastData","d","newData","setItem","createItem","object","getImageSize","file","res","img","Image","src","URL","createObjectURL","onload","width","height","getVideoSize","video","document","createElement","addEventListener","videoWidth","videoHeight","AssetType","fileStorage","getNewAssets","fileDialogInput","type","multiple","accept","click","onchange","e","files","target","assets","Array","i","length","createAsset","push","asset","id","v4","IMAGE","transform","x","y","rotation","indexOf","VIDEO","Error","size","deleteAsset","removeItem","assetCache","LRU","max","entry","maxAge","getImageElement","fr","FileReader","result","readAsDataURL","getVideoElement","muted","autoplay","play","useKeyPress","targetKey","keyPressed","setKeyPressed","downHandler","upHandler","window","removeEventListener","TransformableAsset","rectTransform","onTransform","isSelected","onSelected","children","rotateEnabled","scaleEnabled","skewEnabled","strokeEnabled","theme","useTheme","groupRef","useRef","trRef","current","setNode","getLayer","batchDraw","isShiftPressed","Fragment","onClick","evt","button","cancelBubble","ref","draggable","onDragStart","buttons","setDraggable","onMouseUp","onDragEnd","node","scaleX","scaleY","Math","onTransformEnd","resizeEnabled","enabledAnchors","borderStrokeWidth","anchorFill","colors","background","overlay","anchorStroke","palette","blue","light","rotationSnaps","rotateAnchorOffset","Asset","onUpdate","selected","el","get","setEntry","element","useAssetElement","newRect","image","ToolbarItem","label","keyboardShortcuts","otherProps","onKeyPress","includes","activeElement","tagName","Tooltip","content","placement","IconButton","variant","Toolbar","className","css","tint1","shadows","md","useToolbarPortal","singletonHook","ToolbarPortal","portal","ReactDOM","render","unmountComponentAtNode","ToolbarPortalProvider","setPortal","AdvancedAssetSizer","calibration","formItemMargin","spaces","sm","updateCalibrationValue","value","Number","isNaN","newCal","ppiX","ppiY","ppiLocked","setPPILocked","min","placeholder","onChange","icon","IconLock","IconUnlock","disabled","xOffset","yOffset","Konva","dragButtons","DraggableStage","initialZoom","containerRef","containerSize","useComponentSize","stageRef","zoom","setZoom","tint2","scale","onWheel","preventDefault","oldScale","stage","pointer","getPointerPosition","mousePointTo","deltaY","zoomSpeed","abs","newZoom","newPos","position","onContextMenu","useSceneSidebarOpen","useExtendedTheme","sceneSidebarOpen","headerHeight","sceneListWidth","sidebarWidth","visualAssetSizerSize","Settings","useSettingsDatabase","useOneSettingValue","useTableResolution","TABLE_RESOLUTION","tableResolution","setTableResolution","useTableSize","TABLE_SIZE","tableSize","setTableSize","useTablePPI","theta","atan","widthInch","cos","ScreenSizeSettings","Text","SettingsSidebarItem","dialogOpen","setDialogOpen","color","text","IconSettings","Dialog","isOpen","onRequestClose","title","lg","VisualAssetSizer","tablePPI","console","log","innerRectangles","round","strokeWidth","stroke","base","strokeScaleEnabled","rect","AssetSizer","showModal","setShowModal","setCalibration","IconSliders","Button","intent","LayerType","AssetLayer","layer","layerActive","active","selectedAssetId","setSelectedAssetId","layerRef","deleteSelectedAsset","useCallback","has","delete","from","values","some","anim","Animation","start","stop","toolbar","useMemo","selectedAsset","find","IconFilePlus","IconRotateCcw","screenPPI","IconTrash2","updatedAsset","LayerTypeToComponent","ASSETS","createNewLayer","visible","deleteLayer","scene","layers","splice","useSceneDatabase","LayerList","activeLayer","setActiveLayer","updateLayer","addLayer","moveActiveLayer","deleteActiveLayer","layerIndex","findIndex","l","isActiveLayerTop","isActiveLayerBottom","Layer","List","primary","contentBefore","IconTv","contentAfter","reverse","IconEye","IconEyeOff","danger","IconArrowUp","IconArrowDown","Popover","Menu","IconFile","onPress","IconCloudDrizzle","FOG","IconPlus","TableViewLayer","TABLE_VIEW","TableViewOverlay","showBorder","showGrid","options","ppi","IconCrosshair","offset","checked","displayGrid","lines","floor","end","clipFunc","ctx","beginPath","rotate","closePath","listening","line","points","gray","dash","dark","dashOffset","Canvas","onLayerUpdate","updatedLayer","newScene","Component","table","index","editActiveLayerName","direction","swapIndex","currentLayer","layerToSwap","SceneNameHeader","updateName","inEdit","setInEdit","localName","setLocalName","IconEdit2","IconCheck","success","trim","TableDisplayButton","DISPLAYED_SCENE","displayedScene","updateDisplayedScene","TABLE_FREEZE","tableFreeze","updateTableFreeze","IconPlay","green","IconPause","yellow","IconUpload","heading","SceneEditor","match","useRouteMatch","params","updateScene","Spinner","center","LoadingScenes","Skeleton","animated","NoScenes","props","IconFilm","iconBefore","onAdd","SceneStatusIcon","SceneList","onSceneSelect","selectedSceneId","allScenes","searchText","setSearchText","addNewScene","defaultLayer","createNewScene","sceneList","filter","toLowerCase","IconPlusCircle","ScenePage","history","useHistory","routeMatch","currentSelectedScene","matchedSceneRoute","path","useCurrentSelectedScene","Helmet","styles","html","default","fontFamily","fonts","body","padding","margin","outline","overflow","exact","TablePage","tableScene","setTableScene","innerWidth","innerHeight","windowSize","setWindowSize","onResize","offsetX","offsetY","routes","home","sidebarIcon","SIDEBAR_WIDTH","alt","main","to","scenes","useOnClick","sidebarOpen","setSidebarOpen","IconMap","popout","SidebarItem","route","inner","Sidebar","location","useLocation","Object","routeName","pathname","App","component","getElementById"],"mappings":"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","file":"static/js/main.ba052f97.chunk.js","sourcesContent":["import { useState, useEffect, Dispatch, SetStateAction } from 'react';\nconst RTStorage = require('rt-storage');\n\ninterface IRTStorage<T> {\n\tgetItem<V extends T>(key: string): Promise<V>;\n\tsetItem<V extends T>(key: string, value: V): Promise<V>;\n\tremoveItem(key: string): Promise<void>;\n\tkeys(): Promise<Array<string>>;\n\tsubscribe<V extends T>(handler: (value: V) => void): { unsubscribe: () => void };\n\tsubscribe<V extends T>(key: string, handler: (value: V) => void): { unsubscribe: () => void };\n}\n\nexport default function useGlobalStorage<T>(name: string) {\n\tconst storage = new RTStorage({ name }) as IRTStorage<T>;\n\tconst useOneValue = <V extends T = T>(key: string) => {\n\t\tconst [data, setState] = useState<V | null | undefined>(undefined);\n\n\t\tuseEffect(() => {\n\t\t\tstorage.getItem<V>(key).then((lastData) => {\n\t\t\t\tif (lastData) {\n\t\t\t\t\tsetState(lastData);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetState(null);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst subscription = storage.subscribe(key, (d: V) => setState(d));\n\t\t\treturn () => {\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t};\n\t\t}, [key]);\n\n\t\tconst setData = async (newData: V) => {\n\t\t\tsetState(newData);\n\t\t\tawait storage.setItem(key, newData);\n\t\t}\n\n\t\treturn [data, setData] as [V | null | undefined, Dispatch<SetStateAction<V>>];\n\t}\n\n\treturn {\n\t\tuseAllValues: () => {\n\t\t\tconst [data, setState] = useState<Map<string, T>>();\n\n\t\t\tuseEffect(() => {\n\t\t\t\tfunction handleStorageChange() {\n\t\t\t\t\tstorage.keys()\n\t\t\t\t\t\t.then(async (keys: string[]) => {\n\t\t\t\t\t\t\tconst items = new Map<string, T>();\n\t\t\t\t\t\t\tawait Promise.all(keys.map(async (k) => {\n\t\t\t\t\t\t\t\tconst item = await storage.getItem(k)\n\t\t\t\t\t\t\t\titems.set(k, item);\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\tsetState(items);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\thandleStorageChange();\n\t\t\t\tconst subscription = storage.subscribe(handleStorageChange);\n\t\t\t\treturn () => {\n\t\t\t\t\tsubscription.unsubscribe();\n\t\t\t\t};\n\t\t\t}, []);\n\n\t\t\treturn data;\n\t\t},\n\t\tuseOneValue,\n\t\tcreateItem: (key: string, object: T) => {\n\t\t\tstorage.setItem(key, object);\n\t\t},\n\t\tstorage\n\t};\n};","export function getImageSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst img = new Image();\n\t\timg.src = URL.createObjectURL(file);\n\t\timg.onload = () => {\n\t\t\tres({\n\t\t\t\twidth: img.width,\n\t\t\t\theight: img.height\n\t\t\t})\n\t\t}\n\t})\n}\n\nexport function getVideoSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst video = document.createElement('video');\n\t\tvideo.src = URL.createObjectURL(file);\n\t\tvideo.addEventListener('loadedmetadata', () => {\n\t\t\tres({\n\t\t\t\twidth: video.videoWidth,\n\t\t\t\theight: video.videoHeight\n\t\t\t})\n\t\t});\n\t})\n}","import LRU from 'lru-cache';\nimport { useState, useEffect } from 'react';\n\nimport { getImageSize, getVideoSize } from \"./assetSize\";\nimport { AssetTransform } from \"../canvas/transformableAsset\";\nimport { useAssetFileDatabase } from './storage';\nimport { v4 } from 'uuid';\n\nconst { storage: fileStorage } = useAssetFileDatabase();\n\nexport enum AssetType {\n\tIMAGE,\n\tVIDEO\n}\n\nexport interface IAssetCalibration {\n\txOffset: number;\n\tyOffset: number;\n\tppiX: number;\n\tppiY: number;\n}\n\nexport interface IAsset {\n\tid: string;\n\tsize: { width: number, height: number };\n\ttransform: AssetTransform;\n\toverrideCalibration?: boolean;\n\tcalibration?: IAssetCalibration\n\ttype: AssetType;\n}\n\nexport function getNewAssets() {\n\tconst fileDialogInput = document.createElement('input');\n\tfileDialogInput.type = \"file\";\n\tfileDialogInput.multiple = true;\n\tfileDialogInput.accept = 'image/*,video/*';\n\n\tfileDialogInput.click();\n\treturn new Promise<Array<IAsset>>((res) => {\n\t\tfileDialogInput.onchange = async (e) => {\n\t\t\tconst files = (e!.target as HTMLInputElement).files;\n\t\t\tif (!files) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst assets = new Array<IAsset>();\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst file = files.item(i);\n\t\t\t\tif (!file) continue;\n\n\t\t\t\tassets.push(await createAsset(file));\n\t\t\t}\n\t\t\tres(assets);\n\t\t}\n\t});\n}\n\nexport async function createAsset(file: File) {\n\tconst asset = {\n\t\tid: v4(),\n\t\ttype: AssetType.IMAGE,\n\t\ttransform: {\n\t\t\tx: 0, y: 0,\n\t\t\twidth: 0, height: 0,\n\t\t\trotation: 0\n\t\t}\n\t} as IAsset;\n\n\tlet res: { width: number, height: number };\n\tif (file.type.indexOf('image') === 0) {\n\t\tres = await getImageSize(file);\n\t\tasset.type = AssetType.IMAGE;\n\t}\n\telse if (file.type.indexOf('video') === 0) {\n\t\tres = await getVideoSize(file)\n\t\tasset.type = AssetType.VIDEO;\n\t}\n\telse {\n\t\tthrow new Error('Unknown file type');\n\t}\n\n\tasset.size = {\n\t\twidth: res.width,\n\t\theight: res.height\n\t}\n\tasset.transform.width = res.width;\n\tasset.transform.height = res.height;\n\n\tawait fileStorage.setItem(asset.id, file);\n\treturn asset;\n}\n\nexport async function deleteAsset(asset: IAsset) {\n\tawait fileStorage.removeItem(asset.id);\n}\n\n\ntype CacheEntry = { file: File, element?: HTMLImageElement | HTMLVideoElement };\nconst assetCache = new LRU<string, CacheEntry | null>({\n\tmax: 1024 * 1024 * 500, // 500 MB\n\tlength: (entry) => (entry ? entry.file.size : 0),\n\tmaxAge: 60 * 60 * 1000 // 1 hour\n})\n\nasync function getImageElement(file: File) {\n\treturn new Promise<HTMLImageElement>((res) => {\n\t\tvar fr = new FileReader();\n\t\tconst img = document.createElement('img') as HTMLImageElement;\n\t\tfr.onload = function () {\n\t\t\tif (fr.result) {\n\t\t\t\timg.src = fr.result as string;\n\t\t\t\tres(img);\n\t\t\t}\n\t\t}\n\t\tfr.readAsDataURL(file);\n\t})\n}\n\nasync function getVideoElement(file: File) {\n\tconst video = document.createElement('video');\n\tvideo.src = URL.createObjectURL(file);\n\tvideo.muted = true;\n\tvideo.autoplay = true;\n\tvideo.play();\n\treturn video;\n}\n\nexport function useAssetElement(asset: IAsset) {\n\tconst [entry, setEntry] = useState<CacheEntry | null | undefined>(assetCache.get(asset.id));\n\n\tuseEffect(() => {\n\t\tif (entry === undefined) {\n\t\t\tfileStorage.getItem(asset.id)\n\t\t\t\t.then(async (file) => {\n\t\t\t\t\tconst element = await (asset.type === AssetType.IMAGE ? getImageElement(file) : getVideoElement(file));\n\t\t\t\t\tconst entry = { file, element };\n\t\t\t\t\tassetCache.set(asset.id, entry)\n\t\t\t\t\tsetEntry(entry);\n\t\t\t\t})\n\t\t}\n\t}, [entry, asset.type, asset.id])\n\n\treturn entry === null ? null : entry?.element;\n}","import useGlobalStorage from \"../../storage\";\n\nconst fileStorage = useGlobalStorage<File>('asset_file');\nexport function useAssetFileDatabase() {\n\treturn fileStorage;\n}","import { useState, useEffect } from \"react\";\n\nexport function useKeyPress(targetKey: string) {\n  // State for keeping track of whether key is pressed\n  const [keyPressed, setKeyPressed] = useState(false);\n\n  // Add event listeners\n  useEffect(() => {\n    // If pressed key is our target key then set to true\n    function downHandler({ key }: KeyboardEvent) {\n      if (key === targetKey) {\n        setKeyPressed(true);\n      }\n    }\n\n    // If released key is our target key then set to false\n    const upHandler = ({ key }: KeyboardEvent) => {\n      if (key === targetKey) {\n        setKeyPressed(false);\n      }\n    };\n\n    window.addEventListener('keydown', downHandler);\n    window.addEventListener('keyup', upHandler);\n    // Remove event listeners on cleanup\n    return () => {\n      window.removeEventListener('keydown', downHandler);\n      window.removeEventListener('keyup', upHandler);\n    };\n  }, [setKeyPressed, targetKey]); // Empty array ensures that effect is only run on mount and unmount\n\n  return keyPressed;\n}","import React, { useRef, useEffect } from 'react';\nimport { Group, Transformer } from 'react-konva';\nimport Konva from 'konva';\nimport { IRect } from 'konva/types/types';\nimport { useTheme } from 'sancho';\nimport { useKeyPress } from '../../utils';\n\nexport type AssetTransform = IRect & { rotation: number };\n\ntype Props = {\n\trectTransform: AssetTransform,\n\tonTransform: (newRect: AssetTransform) => void,\n\tisSelected: boolean,\n\tonSelected: () => void,\n\tscaleEnabled?: boolean;\n\tskewEnabled?: boolean;\n\trotateEnabled?: boolean;\n\tstrokeEnabled?: boolean;\n};\nconst TransformableAsset: React.SFC<Props> = ({ rectTransform, onTransform, isSelected, onSelected, children, rotateEnabled, scaleEnabled, skewEnabled, strokeEnabled }) => {\n\tconst theme = useTheme();\n\n\tconst groupRef = useRef<Konva.Group>();\n\tconst trRef = useRef<Konva.Transformer>();\n\n\tuseEffect(() => {\n\t\tif (isSelected) {\n\t\t\t// we need to attach transformer manually\n\t\t\ttrRef.current?.setNode(groupRef.current);\n\t\t\ttrRef.current?.getLayer()?.batchDraw();\n\t\t}\n\t}, [isSelected]);\n\n\tconst isShiftPressed = useKeyPress('Shift');\n\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<Group\n\t\t\t\tonClick={(e) => {\n\t\t\t\t\tif (e.evt.button === 0) {\n\t\t\t\t\t\tonSelected();\n\t\t\t\t\t\te.cancelBubble = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\te.cancelBubble = false\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tref={groupRef as any}\n\t\t\t\tdraggable={isSelected}\n\t\t\t\tx={rectTransform.x}\n\t\t\t\ty={rectTransform.y}\n\t\t\t\theight={rectTransform.height}\n\t\t\t\twidth={rectTransform.width}\n\t\t\t\trotation={rectTransform.rotation}\n\t\t\t\tonDragStart={e => {\n\t\t\t\t\tif (!(e.evt.buttons === 1 && !isShiftPressed)) { // only allow left click, when shift isn't pressed\n\t\t\t\t\t\tgroupRef.current?.setDraggable(false)\n\t\t\t\t\t\te.cancelBubble = false;\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonMouseUp={() => {\n\t\t\t\t\tgroupRef.current?.setDraggable(isSelected) // reset the draggable\n\t\t\t\t}}\n\t\t\t\tonDragEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = node.rotation();\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx: e.target.x(),\n\t\t\t\t\t\ty: e.target.y(),\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: Math.max(5, node.width() * scaleX),\n\t\t\t\t\t\theight: Math.max(node.height() * scaleY)\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t\tonTransformEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = node.rotation();\n\n\t\t\t\t\tnode.scaleX(1);\n\t\t\t\t\tnode.scaleY(1);\n\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx: node.x(),\n\t\t\t\t\t\ty: node.y(),\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: node.width() * scaleX,\n\t\t\t\t\t\theight: node.height() * scaleY\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Group>\n\t\t\t{isSelected && (\n\t\t\t\t<Transformer\n\t\t\t\t\trotateEnabled={rotateEnabled}\n\t\t\t\t\tresizeEnabled={scaleEnabled}\n\t\t\t\t\tenabledAnchors={skewEnabled === false ? ['top-left', 'top-right', 'bottom-left', 'bottom-right'] : undefined}\n\t\t\t\t\tref={trRef as any}\n\t\t\t\t\tborderStrokeWidth={strokeEnabled === false ? 0 : undefined}\n\t\t\t\t\tanchorFill={theme.colors.background.overlay}\n\t\t\t\t\tanchorStroke={theme.colors.palette.blue.light}\n\t\t\t\t\trotationSnaps={[0, 45, 90, 135, 180, 225, 270, 315]}\n\t\t\t\t\trotateAnchorOffset={20}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</React.Fragment>\n\t);\n}\nexport default TransformableAsset;","import React from 'react';\nimport { Image } from 'react-konva';\n\nimport { IAsset, useAssetElement } from '../../asset';\nimport TransformableAsset from '../../canvas/transformableAsset';\nimport { IAssetComponentProps } from '.';\n\ninterface Props extends IAssetComponentProps<IAsset> { };\nconst Asset: React.SFC<Props> = ({ asset, onUpdate, selected, onSelected }) => {\n\tconst el = useAssetElement(asset);\n\n\treturn (\n\t\t<TransformableAsset\n\t\t\tisSelected={selected}\n\t\t\tonSelected={onSelected}\n\t\t\trectTransform={asset.transform}\n\t\t\tonTransform={(newRect) => {\n\t\t\t\tonUpdate({\n\t\t\t\t\t...asset,\n\t\t\t\t\ttransform: newRect\n\t\t\t\t})\n\t\t\t}}>\n\t\t\t{el && <Image\n\t\t\t\timage={el}\n\t\t\t\twidth={asset.transform.width}\n\t\t\t\theight={asset.transform.height}\n\t\t\t/>}\n\t\t</TransformableAsset>\n\t);\n}\n\nexport default Asset;","import { IconButtonProps, IconButton, Tooltip } from \"sancho\";\nimport React, { useEffect, MouseEvent } from \"react\";\n\ntype Props = IconButtonProps & { keyboardShortcuts?: string[], onClick?: (e: MouseEvent<HTMLButtonElement> | KeyboardEvent) => void };\nconst ToolbarItem: React.SFC<Props> = ({ label, keyboardShortcuts, ...otherProps }) => {\n\n\tuseEffect(() => {\n\t\tif (keyboardShortcuts && otherProps.onClick) {\n\t\t\tconst onKeyPress = (e: KeyboardEvent) => {\n\t\t\t\tif (keyboardShortcuts!.includes(e.key) &&\n\t\t\t\t\twindow.document.activeElement?.tagName !== 'INPUT') {\n\t\t\t\t\totherProps.onClick!(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.addEventListener('keyup', onKeyPress);\n\t\t\treturn () => window.removeEventListener('keyup', onKeyPress);\n\t\t}\n\t}, [keyboardShortcuts, otherProps.onClick])\n\n\treturn (\n\t\t<Tooltip content={label} placement=\"bottom\">\n\t\t\t<IconButton\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel={label}\n\t\t\t\t{...otherProps}\n\t\t\t/>\n\t\t</Tooltip>\n\t)\n}\nexport default ToolbarItem;","import React from \"react\";\nimport { css } from \"emotion\";\nimport { useTheme } from \"sancho\";\n\nconst Toolbar: React.SFC = ({ children }) => {\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 0; left: 0; right: 0;\n\t\t\t\tmin-height: 40px;\n\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\tbox-shadow: ${theme.shadows.md};\n\t\t\t\tz-index: 100;\n\t\t\t\t> span {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t}\n\t\t\t`}\n\t\t>\n\t\t\t{children}\n\t\t</div>\n\t);\n}\nexport default Toolbar;","import React, { useEffect, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { singletonHook } from 'react-singleton-hook';\nimport { DarkMode } from 'sancho';\nimport Toolbar from './toolbar';\n\nconst useToolbarPortal = singletonHook([undefined, () => { }], () => useState<HTMLElement | undefined>(undefined));\n\nconst ToolbarPortal: React.SFC = ({ children }) => {\n\tconst [portal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tif (portal) {\n\t\t\tReactDOM.render(<DarkMode>{children}</DarkMode>, portal);\n\t\t\treturn () => ReactDOM.unmountComponentAtNode(portal);\n\t\t}\n\t\treturn () => { }\n\t}, [children, portal])\n\n\treturn null;\n}\nexport default ToolbarPortal;\n\nexport const ToolbarPortalProvider: React.SFC = ({ children }) => {\n\tconst node = useRef<HTMLSpanElement>();\n\tconst [, setPortal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tsetPortal(node.current);\n\t}, [node, setPortal]);\n\n\treturn (\n\t\t<>\n\t\t\t<Toolbar>\n\t\t\t\t<span ref={node as any} />\n\t\t\t</Toolbar>\n\t\t\t{children}\n\t\t</>\n\t)\n}","import React, { useState, useEffect } from 'react';\nimport { IAssetCalibration } from '../../asset';\nimport { InputGroup, Input, useTheme, IconButton, IconLock, IconUnlock } from 'sancho';\nimport { css } from \"emotion\";\n\nconst AdvancedAssetSizer: React.SFC<{ calibration: IAssetCalibration; onUpdate: (calibration: IAssetCalibration) => void; }> = ({ calibration, onUpdate }) => {\n  const theme = useTheme();\n  const formItemMargin = css`margin: 0 ${theme.spaces.sm};`;\n\n  function updateCalibrationValue(keys: Array<keyof IAssetCalibration>, e: React.ChangeEvent<HTMLInputElement>) {\n    const value = Number(e.target.value);\n    if (!isNaN(value)) {\n      const newCal = { ...calibration! };\n      for (const key of keys) {\n        newCal[key] = value;\n      }\n      onUpdate(newCal)\n    }\n  }\n\n  const [ppiLocked, setPPILocked] = useState(calibration.ppiX === calibration.ppiY);\n  useEffect(() => {\n    if (ppiLocked && calibration.ppiX !== calibration.ppiY) {\n      setPPILocked(false);\n    }\n  }, [calibration, onUpdate, ppiLocked])\n\n  return (\n    <>\n      <InputGroup label=\"Pixels per Inch\">\n        <div\n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"Horizontal PPI\"\n            value={calibration.ppiX}\n            onChange={(e) => updateCalibrationValue((ppiLocked ? ['ppiX', 'ppiY'] : ['ppiX']), e)}\n          />\n          <div className={formItemMargin}>\n            <IconButton\n              variant=\"ghost\"\n              label={ppiLocked ? 'Unlock PPI' : 'Lock PPI'}\n              icon={ppiLocked ? <IconLock /> : <IconUnlock />}\n              onClick={() => {\n                if (calibration.ppiX !== calibration.ppiY) {\n                  onUpdate({\n                    ...calibration,\n                    ppiY: calibration.ppiX\n                  })\n                }\n                setPPILocked(!ppiLocked)\n              }}\n            />\n          </div>\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"Vertical PPI\"\n            value={ppiLocked ? calibration.ppiX : calibration.ppiY}\n            disabled={ppiLocked}\n            onChange={(e) => updateCalibrationValue(['ppiY'], e)}\n          />\n        </div>\n      </InputGroup>\n      <InputGroup label=\"Offset\">\n        <div\n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            placeholder=\"Horizontal Offset\"\n            value={calibration.xOffset}\n            onChange={(e) => updateCalibrationValue(['xOffset'], e)}\n          />\n          <div className={formItemMargin}>x</div>\n          <Input\n            type=\"number\"\n            placeholder=\"Vertical Offset\"\n            value={calibration.yOffset}\n            onChange={(e) => updateCalibrationValue(['yOffset'], e)}\n          />\n        </div>\n      </InputGroup>\n    </>\n  );\n};\n\nexport default AdvancedAssetSizer;","import React, { useRef, useState } from 'react';\nimport useComponentSize from '@rehooks/component-size';\nimport { css } from 'emotion';\nimport Konva from 'konva';\nimport { Stage } from 'react-konva';\nimport { useTheme } from 'sancho';\n\nimport { useKeyPress } from '../../utils';\n\nconst ZOOM_SPEED = 1 / 250;\n\nKonva.dragButtons = [0, 1, 2];\n\ntype Props = { draggable?: boolean, initialZoom?: number, className?: string };\nconst DraggableStage: React.SFC<Props> = ({ draggable, initialZoom = 1, className, children }) => {\n\tconst theme = useTheme();\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst containerSize = useComponentSize(containerRef);\n\tconst stageRef = useRef<Konva.Stage>();\n\n\tconst [zoom, setZoom] = useState(initialZoom);\n\tconst isShiftPressed = useKeyPress('Shift');\n\n\treturn (\n\t\t<div\n\t\t\tref={containerRef}\n\t\t\tclassName={css`\t\t\t\t\n\t\t\t\tbackground-color: ${theme.colors.background.tint2};\n\t\t\t\tbackground-image: linear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1}),\n\t\t\t\tlinear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1});\n\t\t\t\tbackground-size: 20px 20px;\n\t\t\t\tbackground-position: 0 0, 10px 10px;\n\t\t\t` + (className ? ` ${className}` : '')}\n\t\t>\n\t\t\t<Stage\n\t\t\t\tref={stageRef as any}\n\t\t\t\twidth={containerSize.width}\n\t\t\t\theight={containerSize.height}\n\t\t\t\tdraggable={draggable === undefined ? true : draggable}\n\t\t\t\tonDragStart={(e) => {\n\t\t\t\t\tif (e.evt.buttons === 1 && !isShiftPressed) { // allow left only when shift is pressed\n\t\t\t\t\t\tstageRef.current?.setDraggable(false)\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonMouseUp={() => {\n\t\t\t\t\tstageRef.current?.setDraggable(draggable === undefined ? true : draggable) // reset the draggable\n\t\t\t\t}}\n\t\t\t\tscale={{ x: zoom, y: zoom }}\n\t\t\t\tonWheel={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\t\t\t\t\tconst oldScale = zoom;\n\n\t\t\t\t\tconst stage = stageRef.current!;\n\t\t\t\t\tconst pointer = stage.getPointerPosition();\n\n\t\t\t\t\tif (!pointer) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar mousePointTo = {\n\t\t\t\t\t\tx: (pointer.x - stage.x()) / oldScale,\n\t\t\t\t\t\ty: (pointer.y - stage.y()) / oldScale,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst deltaY = e.evt.deltaY;\n\t\t\t\t\tif (deltaY === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst zoomSpeed = 1 + (Math.abs(deltaY) * ZOOM_SPEED);\n\n\t\t\t\t\tvar newZoom =\n\t\t\t\t\t\te.evt.deltaY > 0 ? oldScale / zoomSpeed : oldScale * zoomSpeed;\n\n\t\t\t\t\tsetZoom(newZoom);\n\n\t\t\t\t\tvar newPos = {\n\t\t\t\t\t\tx: pointer.x - mousePointTo.x * newZoom,\n\t\t\t\t\t\ty: pointer.y - mousePointTo.y * newZoom,\n\t\t\t\t\t};\n\t\t\t\t\tstage.position(newPos);\n\t\t\t\t\tstage.batchDraw();\n\t\t\t\t}}\n\t\t\t\tonContextMenu={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Stage>\n\t\t</div>\n\t);\n}\nexport default DraggableStage;","import { singletonHook } from 'react-singleton-hook';\nimport { useTheme } from 'sancho';\nimport { useState } from 'react';\n\nexport const SIDEBAR_WIDTH = 48;\nexport const SCENE_LIST_WIDTH = 240;\nexport const HEADER_HEIGHT = 56;\nexport const VISUAL_ASSET_SIZER_SIZE = 650;\n\nexport const useSceneSidebarOpen = singletonHook([true, () => { }], () => useState<boolean>(true));\nexport function useExtendedTheme() {\n  const theme = useTheme();\n  const [sceneSidebarOpen] = useSceneSidebarOpen();\n\n  return {\n    ...theme,\n    headerHeight: HEADER_HEIGHT,\n    sceneListWidth: sceneSidebarOpen ? SCENE_LIST_WIDTH : 0,\n    sidebarWidth: SIDEBAR_WIDTH,\n    visualAssetSizerSize: VISUAL_ASSET_SIZER_SIZE\n  }\n}","import useGlobalStorage from \"../storage\";\nimport React, { useState, SetStateAction, Dispatch } from \"react\";\nimport { IconButton, useTheme, IconSettings, Dialog, Tooltip, Text, InputGroup, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nexport enum Settings {\n  DISPLAYED_SCENE = 'displayed_scene',\n  TABLE_FREEZE = 'table_freeze',\n  TABLE_RESOLUTION = 'table_resolution',\n  TABLE_SIZE = 'table_size'\n}\n\nconst storage = useGlobalStorage<unknown>('settings');\nexport function useSettingsDatabase() {\n  return storage;\n}\n\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype TableResolution = { width: number, height: number };\nexport function useTableResolution(): [TableResolution | undefined, Dispatch<SetStateAction<TableResolution>>] {\n  const [tableResolution, setTableResolution] = useOneSettingValue<TableResolution>(Settings.TABLE_RESOLUTION);\n\n  if (tableResolution === null) {\n    return [\n      { width: 1920, height: 1080 },\n      setTableResolution\n    ]\n  }\n\n  return [tableResolution, setTableResolution];\n}\n\nexport function useTableSize(): [number | undefined, Dispatch<SetStateAction<number>>] {\n  const [tableSize, setTableSize] = useOneSettingValue<number>(Settings.TABLE_SIZE);\n\n  if (tableSize === null) {\n    return [\n      45,\n      setTableSize\n    ]\n  }\n\n  return [tableSize, setTableSize];\n}\n\nexport function useTablePPI(): number | null {\n  const [tableResolution] = useTableResolution();\n\tconst [tableSize] = useTableSize();\n\tif (!tableResolution || !tableSize) {\n\t\treturn null;\n  }\n  \n  const theta = Math.atan(tableResolution.height / tableResolution.width);\n\tconst widthInch = tableSize * Math.cos(theta);\n\t// const heightInch = tableSize * Math.sin(theta);\n\n  const ppi = tableResolution.width / widthInch;\n  return ppi;\n}\n\nconst ScreenSizeSettings: React.SFC = () => {\n  const theme = useTheme();\n  \n  const [tableResolution, setTableResolution] = useTableResolution();\n  const [tableSize, setTableSize] = useTableSize();\n\n  const formItemMargin = css`margin: 0 ${theme.spaces.sm};`;\n  \n  if (tableResolution === undefined || tableSize === undefined) {\n    return null;\n  }\n\n  return (\n    <>\n      <Text variant=\"h6\">Table Display Settings</Text>\n      <InputGroup label=\"Resolution\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"width\"\n            value={tableResolution.width}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, width: value })\n              }\n            }}\n          />\n          <div className={formItemMargin}>x</div>\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"height\"\n            value={tableResolution.height}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, height: value })\n              }\n            }}\n          />\n        </div>\n      </InputGroup>\n      <InputGroup label=\"Screen Size\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            value={tableSize}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableSize(value)\n              }\n            }}\n          />\n          <div className={formItemMargin}>inches</div>\n        </div>\n      </InputGroup>\n    </>\n  );\n}\n\nconst SettingsSidebarItem: React.SFC = () => {\n  const theme = useTheme();\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  return (\n    <>\n      <Tooltip content=\"Settings\" placement=\"right\">\n        <IconButton\n          variant=\"ghost\"\n          color={theme.colors.text.muted}\n          size=\"lg\"\n          icon={<IconSettings />}\n          label=\"Settings\"\n          onClick={() => setDialogOpen(true)}\n        />\n      </Tooltip>\n      <Dialog\n        isOpen={dialogOpen}\n        onRequestClose={() => setDialogOpen(false)}\n        title=\"Settings\"\n      >\n        <div className={css`padding: ${theme.spaces.lg};`}>\n          <ScreenSizeSettings />\n        </div>\n      </Dialog>\n    </>\n  );\n}\nexport default SettingsSidebarItem;","import React from 'react';\nimport { Layer, Rect } from 'react-konva';\nimport { css } from 'emotion';\n\nimport { IAssetCalibration, IAsset } from '../../asset';\nimport DraggableStage from '../../canvas/draggableStage';\nimport Asset from './asset';\nimport { useExtendedTheme } from '../../../theme';\nimport { useTablePPI } from '../../../settings';\nimport TransformableAsset from '../../canvas/transformableAsset';\nimport { IRect } from 'konva/types/types';\n\nconst RESIZE_SQUARES = 3;\n\nconst VisualAssetSizer: React.SFC<{ asset: IAsset; onUpdate: (calibration: IAssetCalibration) => void; }> = ({ asset, onUpdate }) => {\n  const theme = useExtendedTheme();\n  const tablePPI = useTablePPI();\n  console.log({ tablePPI })\n\n  if (!tablePPI || !asset.calibration) {\n    return null;\n  }\n\n  const innerRectangles = Array<IRect>();\n  for (let i = 1; i < RESIZE_SQUARES; i += 2) {\n    innerRectangles.push({\n      width: asset.calibration.ppiX * RESIZE_SQUARES,\n      height: asset.calibration.ppiY * 1,\n      x: 0,\n      y: asset.calibration.ppiY * i\n    })\n    innerRectangles.push({\n      width: asset.calibration.ppiX * 1,\n      height: asset.calibration.ppiY * RESIZE_SQUARES,\n      x: asset.calibration.ppiX * i,\n      y: 0\n    })\n  }\n\n  return (\n    <DraggableStage\n      className={css`\n        width: ${theme.visualAssetSizerSize}px;\n\t\t\t\theight: ${theme.visualAssetSizerSize}px;\n        margin-left: -${theme.spaces.lg};\n      `}\n      initialZoom={(theme.visualAssetSizerSize / asset.size.width)}\n    >\n      <Layer>\n        <Asset\n          asset={{\n            ...asset,\n            transform: {\n              ...asset.size,\n              rotation: 0,\n              x: 0,\n              y: 0\n            }\n          }}\n          onSelected={() => { }}\n          selected={false}\n          onUpdate={() => { }}\n        />\n      </Layer>\n      <Layer>\n        <TransformableAsset\n          rectTransform={{\n            width: asset.calibration.ppiX * RESIZE_SQUARES,\n            height: asset.calibration.ppiY * RESIZE_SQUARES,\n            x: asset.calibration.xOffset,\n            y: asset.calibration.yOffset,\n            rotation: 0\n          }}\n          rotateEnabled={false}\n          strokeEnabled={false}\n          isSelected={true}\n          onSelected={() => { }}\n          onTransform={(transform) => {\n            onUpdate({\n              ppiX: Math.round(transform.width / RESIZE_SQUARES * 100) / 100,\n              ppiY: Math.round(transform.height / RESIZE_SQUARES * 100) / 100,\n              xOffset: Math.round(transform.x * 100) / 100,\n              yOffset: Math.round(transform.y * 100) / 100\n            })\n          }}\n        >\n          {/* Outside rect */}\n          <Rect\n            x={0}\n            y={0}\n            width={asset.calibration.ppiX * RESIZE_SQUARES}\n            height={asset.calibration.ppiY * RESIZE_SQUARES}\n            strokeWidth={1}\n            stroke={theme.colors.palette.blue.base}\n            strokeScaleEnabled={false}\n          />\n          {innerRectangles.map((rect, i) => (\n            <Rect\n              key={i}\n              {...rect}\n              strokeWidth={1}\n              stroke={theme.colors.palette.blue.base}\n              strokeScaleEnabled={false}\n            />\n          ))}\n        </TransformableAsset>\n      </Layer>\n    </DraggableStage>\n  );\n};\n\nexport default VisualAssetSizer;","import React, { useState, useEffect } from 'react';\nimport { IAsset, IAssetCalibration } from '../../asset';\nimport { IconSliders, Dialog, useTheme, Button } from 'sancho';\nimport { css } from \"emotion\";\n\nimport ToolbarItem from '../toolbarItem';\nimport AdvancedAssetSizer from './advancedAssetSizer';\nimport { AssetTransform } from '../../canvas/transformableAsset';\nimport VisualAssetSizer from './visualAssetSizer';\n\nexport function calculateCalibratedTransform(asset: IAsset, screenPPI: number): AssetTransform {\n  if (!asset.calibration) {\n    return asset.transform;\n  }\n\n  console.log(asset);\n  return {\n    ...asset.transform,\n    width: (asset.size.width / asset.calibration.ppiX) * screenPPI,\n    height: (asset.size.height / asset.calibration.ppiY) * screenPPI\n  }\n}\n\ntype Props = {\n  asset?: IAsset,\n  onUpdate: (asset: IAsset) => void\n};\n\nconst AssetSizer: React.SFC<Props> = ({ asset, onUpdate }) => {\n  const theme = useTheme();\n  const [showModal, setShowModal] = useState(false);\n  const [calibration, setCalibration] = useState<IAssetCalibration>();\n\n  useEffect(() => {\n    if (asset) {\n      setCalibration(asset.calibration || {\n        ppiX: 150,\n        ppiY: 150,\n        xOffset: 0,\n        yOffset: 0\n      });\n    }\n  }, [asset])\n\n  return (\n    <>\n      <ToolbarItem\n        label=\"Calibrate Size\"\n        icon={<IconSliders />}\n        onClick={() => setShowModal(true)}\n        disabled={!asset}\n      />\n      {calibration && asset &&\n        <Dialog\n          isOpen={showModal}\n          onRequestClose={() => setShowModal(false)}\n          title=\"Asset Calibration\"\n        >\n          <div className={css`padding: ${theme.spaces.lg};`}>\n            <VisualAssetSizer asset={{ ...asset, calibration }} onUpdate={setCalibration} />\n            <AdvancedAssetSizer calibration={calibration} onUpdate={setCalibration} />\n\n            <div\n              className={css`\n                display: flex;\n                margin-top: ${theme.spaces.lg};\n                justify-content: flex-end;\n              `}\n            >\n              <Button variant=\"ghost\" intent=\"primary\" onClick={() => onUpdate({ ...asset, calibration })}>Save</Button>\n            </div>\n          </div>\n        </Dialog>\n      }\n    </>\n  )\n}\nexport default AssetSizer;","import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { Layer } from \"react-konva\";\nimport AssetComponent from './asset';\nimport { IAsset, AssetType, deleteAsset, getNewAssets } from '../../asset';\nimport { ILayer, ILayerComponentProps } from '..';\nimport Konva from 'konva';\nimport { IconFilePlus, IconTrash2, IconRotateCcw } from 'sancho';\nimport ToolbarItem from '../toolbarItem';\nimport ToolbarPortal from '../toolbarPortal';\nimport AssetSizer, { calculateCalibratedTransform } from './assetSizer';\nimport { css } from 'emotion';\nimport { useTablePPI } from '../../../settings';\n\nexport interface IAssetComponentProps<T extends IAsset> {\n\tasset: T;\n\tonUpdate: (asset: T) => void;\n\tselected: boolean;\n\tonSelected: () => void;\n}\n\nexport interface IAssetLayer extends ILayer {\n\tassets: Map<string, IAsset>\n}\n\ninterface Props extends ILayerComponentProps<IAssetLayer> { }\nconst AssetLayer: React.SFC<Props> = ({ layer, onUpdate, active: layerActive }) => {\n\tconst [selectedAssetId, setSelectedAssetId] = useState<string | null>(null);\n\tconst layerRef = useRef<Konva.Layer>();\n\tconst tablePPI = useTablePPI();\n\n\tconst deleteSelectedAsset = useCallback(async () => {\n\t\tif (selectedAssetId && layer.assets.has(selectedAssetId)) {\n\t\t\tconst asset = layer.assets.get(selectedAssetId)!;\n\t\t\tlayer.assets.delete(selectedAssetId);\n\t\t\tawait deleteAsset(asset);\n\t\t\tonUpdate({ ...layer });\n\t\t\tsetSelectedAssetId(null);\n\t\t}\n\t}, [selectedAssetId, layer, onUpdate, setSelectedAssetId])\n\n\t// Animate the layer if there are any video assets\n\tuseEffect(() => {\n\t\tif (!layerRef.current) return;\n\t\tif (!Array.from(layer.assets.values()).some((asset) => asset.type === AssetType.VIDEO)) return;\n\n\t\tconst anim = new Konva.Animation(() => { }, layerRef.current);\n\t\tanim.start();\n\t\treturn () => { anim.stop() }\n\t}, [layerRef, layer])\n\n\t// Reset selected asset when active layer changes\n\tuseEffect(() => {\n\t\tif (!layerActive && selectedAssetId !== null) {\n\t\t\tsetSelectedAssetId(null);\n\t\t}\n\t}, [layerActive, selectedAssetId])\n\n\tconst toolbar = useMemo(() => {\n\t\tconst selectedAsset = Array.from(layer.assets.values()).find((a) => a.id === selectedAssetId);\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconFilePlus />}\n\t\t\t\t\tlabel=\"Add Asset\"\n\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\tconst assets = await getNewAssets();\n\t\t\t\t\t\tfor (const asset of assets) {\n\t\t\t\t\t\t\tlayer.assets.set(asset.id, asset);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonUpdate({ ...layer })\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<AssetSizer\n\t\t\t\t\tasset={selectedAsset}\n\t\t\t\t\tonUpdate={(asset) => {\n\t\t\t\t\t\tlayer.assets.set(asset.id, asset);\n\t\t\t\t\t\tonUpdate({ ...layer });\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconRotateCcw />}\n\t\t\t\t\tlabel=\"Reset Asset Size\"\n\t\t\t\t\tdisabled={!selectedAsset || !selectedAsset.calibration || !tablePPI}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tselectedAsset!.transform = calculateCalibratedTransform(selectedAsset!, tablePPI!);\n\t\t\t\t\t\tconsole.log(selectedAsset!.transform);\n\t\t\t\t\t\tlayer.assets.set(selectedAsset!.id, selectedAsset!);\n\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t...layer\n\t\t\t\t\t\t})\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<div className={css`flex-grow: 2;`} />\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\tlabel=\"Delete Asset\"\n\t\t\t\t\tdisabled={selectedAssetId === null}\n\t\t\t\t\tonClick={deleteSelectedAsset}\n\t\t\t\t\tkeyboardShortcuts={['Delete', 'Backspace']}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}, [layer, tablePPI, selectedAssetId, onUpdate, deleteSelectedAsset]);\n\n\treturn (\n\t\t<>\n\t\t\t{layerActive && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n\t\t\t<Layer ref={layerRef as any}>\n\t\t\t\t{\n\t\t\t\t\tArray.from(layer.assets.values())\n\t\t\t\t\t\t.map((asset) => {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<AssetComponent\n\t\t\t\t\t\t\t\t\tkey={asset.id}\n\t\t\t\t\t\t\t\t\tasset={asset}\n\t\t\t\t\t\t\t\t\tselected={layerActive && selectedAssetId === asset.id}\n\t\t\t\t\t\t\t\t\tonSelected={() => layerActive && setSelectedAssetId(asset.id)}\n\t\t\t\t\t\t\t\t\tonUpdate={(updatedAsset) => {\n\t\t\t\t\t\t\t\t\t\tlayer.assets.set(updatedAsset.id, updatedAsset);\n\t\t\t\t\t\t\t\t\t\tonUpdate({ ...layer });\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</Layer>\n\t\t</>\n\t);\n}\nexport default AssetLayer;","import AssetLayer, { IAssetLayer } from \"./assetLayer\";\nimport { v4 } from \"uuid\";\nimport { IScene } from \"..\";\nimport { deleteAsset } from \"../asset\";\n\nexport enum LayerType {\n\tASSETS,\n\tFOG,\n\tTABLE_VIEW,\n}\n\nexport interface ILayer {\n\tid: string\n\ttype: LayerType\n\tname: string\n\tvisible: boolean\n}\n\nexport interface ILayerComponentProps<T extends ILayer = ILayer> {\n\tlayer: T;\n\tonUpdate: (layer: T) => void;\n\tactive: boolean;\n}\n\nexport const LayerTypeToComponent = {\n\t[LayerType.ASSETS]: AssetLayer,\n} as { [type: string]: React.SFC<ILayerComponentProps<any>> }\n\nexport function createNewLayer(type: LayerType) {\n\tconst layer: ILayer = {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\ttype: type,\n\t\tvisible: true\n\t};\n\tif (type === LayerType.ASSETS) {\n\t\t(layer as IAssetLayer).assets = new Map();\n\t}\n\treturn layer;\n}\n\nexport async function deleteLayer(scene: IScene, layer: ILayer) {\n\tconst i = scene.layers.indexOf(layer);\n\tif (i === -1) return scene;\n\tif (layer.type === LayerType.ASSETS) {\n\t\tfor (const asset of Array.from((layer as IAssetLayer).assets.values())) {\n\t\t\tawait deleteAsset(asset);\n\t\t}\n\t}\n\tscene.layers.splice(i, 1);\n\treturn scene;\n}\n// delete layer w/ assets","import { v4 } from \"uuid\";\n\nimport useGlobalStorage from \"../storage\";\nimport { ILayer, LayerType, createNewLayer } from \"./layer\";\nimport { Vector2d } from \"konva/types/types\";\n\nexport interface TableOptions {\n\tdisplayGrid: boolean,\n\toffset: Vector2d,\n\trotation: number,\n\tscale: number,\n}\n\nexport interface IScene {\n\tid: string;\n\tname: string;\n\ttable: TableOptions,\n\tlayers: Array<ILayer>;\n}\n\nconst storage = useGlobalStorage<IScene>('scene');\nexport function useSceneDatabase() {\n\treturn storage;\n}\n\nexport function createNewScene(): IScene {\n\tconst defaultLayer = createNewLayer(LayerType.ASSETS);\n\tdefaultLayer.name = 'Layer 1';\n\n\treturn {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\ttable: {\n\t\t\toffset: { x: 0, y: 0 },\n\t\t\trotation: 0,\n\t\t\tscale: 1,\n\t\t\tdisplayGrid: true\n\t\t},\n\t\tlayers: [\n\t\t\tdefaultLayer\n\t\t]\n\t};\n}","import { IScene } from \"..\";\nimport { LayerType, ILayer } from \"../layer\";\nimport { useTheme, Layer, List, ListItem, IconButton, IconTrash2, Popover, MenuList, MenuItem, IconFile, IconCloudDrizzle, IconPlus, Text, IconArrowUp, IconArrowDown, IconEye, IconEyeOff, IconTv } from \"sancho\";\nimport React from \"react\";\nimport { css } from \"emotion\";\n\ntype Props = {\n\tscene: IScene,\n\tactiveLayer: string | null,\n\tsetActiveLayer: (layer: string) => void,\n\tupdateLayer: (layer: ILayer) => void,\n\taddLayer: (type: LayerType) => void,\n\teditActiveLayerName: (name: string) => void, // TODO\n\tmoveActiveLayer: (direction: \"up\" | \"down\") => void;\n\tdeleteActiveLayer: () => void\n};\nconst LayerList: React.SFC<Props> = ({ scene, activeLayer, setActiveLayer, updateLayer, addLayer, moveActiveLayer, deleteActiveLayer }) => {\n\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayer);\n\tconst isActiveLayerTop = layerIndex === scene.layers.length - 1;\n\tconst isActiveLayerBottom = layerIndex === 0;\n\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: absolute;\n\t\t\t\tright: ${theme.spaces.md};\n\t\t\t\tbottom: ${theme.spaces.md};\n\t\t\t`}\n\t\t>\n\t\t\t<Layer\n\t\t\t\tclassName={css`\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twidth: 300px;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<List\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tmax-height: 350px;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<ListItem\n\t\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\t\tbackground-color: ${activeLayer === 'TABLE_VIEW' ? theme.colors.intent.primary.base : 'initial'} !important;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\tcontentBefore={\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tlabel={'Table View'}\n\t\t\t\t\t\t\t\ticon={<IconTv />}\n\t\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprimary={'Table View'}\n\t\t\t\t\t\tcontentAfter={' '}\n\t\t\t\t\t\tonClick={() => setActiveLayer('TABLE_VIEW')}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{Array.from(scene.layers).reverse().map((layer) => (\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\t\tbackground-color: ${activeLayer === layer.id ? theme.colors.intent.primary.base : 'initial'} !important;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\tcontentBefore={\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tlabel={layer.visible ? 'Hide Layer' : 'Show Layer'}\n\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\tupdateLayer({ ...layer, visible: !layer.visible })\n\t\t\t\t\t\t\t\t\t\te.preventDefault(); // prevent passing through to the list item\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ticon={layer.visible ? <IconEye /> : <IconEyeOff />}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprimary={layer.name}\n\t\t\t\t\t\t\tcontentAfter={<Text variant=\"subtitle\">{LayerType[layer.type]}</Text>}\n\t\t\t\t\t\t\tonClick={() => setActiveLayer(layer.id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{/* Delete Layer */}\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tdisabled={activeLayer === null}\n\t\t\t\t\t\tcolor={theme.colors.intent.danger.base}\n\t\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\t\tlabel=\"Delete Layer\"\n\t\t\t\t\t\tonClick={deleteActiveLayer}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* Move Layer */}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayer === null || isActiveLayerTop}\n\t\t\t\t\t\t\ticon={<IconArrowUp />}\n\t\t\t\t\t\t\tlabel=\"Layer Up\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('up')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayer === null || isActiveLayerBottom}\n\t\t\t\t\t\t\ticon={<IconArrowDown />}\n\t\t\t\t\t\t\tlabel=\"Layer Down\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('down')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Add Layer Button */}\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tplacement=\"top-end\"\n\t\t\t\t\t\tcontent={\n\t\t\t\t\t\t\t<MenuList>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconFile />} onPress={() => addLayer(LayerType.ASSETS)}>Asset Layer</MenuItem>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconCloudDrizzle />} onPress={() => addLayer(LayerType.FOG)} disabled={true}>Fog Layer</MenuItem>\n\t\t\t\t\t\t\t</MenuList>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<IconButton variant=\"ghost\" icon={<IconPlus />} label=\"Add Layer\" />\n\t\t\t\t\t</Popover>\n\t\t\t\t</div>\n\t\t\t</Layer>\n\t\t</div>\n\t);\n}\nexport default LayerList;","import React, { useMemo } from 'react';\nimport { Layer, Rect, Line, Group } from 'react-konva';\nimport { useTheme, IconCrosshair, Check } from 'sancho';\nimport { useTableResolution, useTablePPI } from '../../settings';\nimport { Vector2d } from 'konva/types/types';\nimport { TableOptions } from '..';\nimport { ILayerComponentProps, ILayer, LayerType } from '.';\nimport TransformableAsset from '../canvas/transformableAsset';\nimport ToolbarItem from './toolbarItem';\nimport ToolbarPortal from './toolbarPortal';\n\nexport const TableViewLayer = {\n  id: 'TABLE_VIEW',\n  name: 'Table View',\n  type: LayerType.TABLE_VIEW,\n  visible: true\n} as ILayer;\n\nexport interface ITableViewLayer extends ILayer {\n  options: TableOptions\n}\n\ninterface Props extends ILayerComponentProps<ITableViewLayer> {\n  showBorder: boolean;\n  showGrid: boolean;\n}\n\nconst TableViewOverlay: React.SFC<Props> = ({ layer, active, showBorder, showGrid, onUpdate }) => {\n  const options = layer.options;\n  const theme = useTheme();\n  const [tableResolution] = useTableResolution();\n  const ppi = useTablePPI();\n\n  const toolbar = useMemo(() => {\n    return (\n      <>\n        <ToolbarItem\n          icon={<IconCrosshair />}\n          label=\"Reset View\"\n          onClick={() => {\n            onUpdate({\n              ...layer,\n              options: {\n                ...options,\n                offset: { x: 0, y: 0 },\n                rotation: 0,\n                scale: 1\n              }\n            })\n          }}\n        />\n        <Check label=\"Display Grid\" checked={options.displayGrid} onChange={(e) => {\n          onUpdate({\n            ...layer,\n            options: {\n              ...options,\n              displayGrid: e.target.checked\n            }\n          })\n        }} />\n      </>\n    );\n  }, [layer, options, onUpdate]);\n\n  if (!tableResolution || ppi === null) {\n    return null;\n  }\n\n  const width = tableResolution.width;\n  const height = tableResolution.height;\n\n  const lines = new Array<{ start: Vector2d; end: Vector2d; }>();\n\n  // Only generate the grid within the table display to save on the number of lines needed.\n  if (showGrid) {\n    const startX = Math.floor(options.offset.x / ppi) * ppi;\n    for (let xOffset = startX; xOffset <= options.offset.x + tableResolution.width; xOffset += ppi) {\n      lines.push({\n        start: { x: xOffset, y: options.offset.y },\n        end: { x: xOffset, y: options.offset.y + tableResolution.height }\n      });\n    }\n\n    const startY = Math.floor(options.offset.y / ppi) * ppi;\n    for (let yOffset = startY; yOffset <= options.offset.y + tableResolution.height; yOffset += ppi) {\n      lines.push({\n        start: { x: options.offset.x, y: yOffset },\n        end: { x: options.offset.x + tableResolution.width, y: yOffset }\n      });\n    }\n  }\n\n  return (\n    <Layer>\n      {active && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n      <Group\n        clipFunc={(ctx: CanvasRenderingContext2D) => {\n          ctx.beginPath();\n          ctx.rect(options.offset.x, options.offset.y, width, height);\n          ctx.rotate(options.rotation);\n          ctx.closePath();\n        }}\n        listening={active}\n      >\n        {lines.map((line, i) => (\n          <>\n            <Line\n              key={`l${i}`}\n              points={[line.start.x, line.start.y, line.end.x, line.end.y]}\n              stroke={theme.colors.palette.gray.light}\n              dash={[1, 1]}\n              strokeWidth={1}\n              strokeScaleEnabled={false}\n            />\n            <Line\n              key={`d${i}`}\n              points={[line.start.x, line.start.y, line.end.x, line.end.y]}\n              stroke={theme.colors.palette.gray.dark}\n              dash={[1, 1]}\n              dashOffset={1}\n              strokeWidth={1}\n              strokeScaleEnabled={false}\n            />\n          </>\n        ))}\n      </Group>\n\n      {(showBorder || active) ?\n        <TransformableAsset\n          rectTransform={{ ...options.offset, rotation: options.rotation, width, height }}\n          isSelected={active}\n          onSelected={() => { }}\n          onTransform={(rect) => {\n            onUpdate({\n              ...layer,\n              options: {\n                ...options,\n                offset: { x: rect.x, y: rect.y },\n                rotation: rect.rotation,\n                scale: 1 // TODO\n              }\n            })\n          }}\n          rotateEnabled={false}\n          skewEnabled={false}\n          scaleEnabled={false}\n        >\n          <Rect\n            width={width}\n            height={height}\n            stroke={theme.colors.palette.gray.light}\n            dash={[10, 10]}\n            strokeWidth={5}\n            listening={active}\n          />\n        </TransformableAsset>\n        : null\n      }\n    </Layer>\n  );\n};\n\nexport default TableViewOverlay;","import React, { useState, useEffect, useCallback } from 'react';\nimport { css } from 'emotion';\n\nimport { IScene } from '..';\nimport DraggableStage from './draggableStage';\nimport { LayerTypeToComponent, LayerType, ILayer, createNewLayer } from '../layer';\nimport { deleteLayer } from '../layer';\nimport LayerList from './layerList';\nimport { ToolbarPortalProvider } from '../layer/toolbarPortal';\nimport TableViewOverlay, { TableViewLayer } from '../layer/tableView';\nimport { useExtendedTheme } from '../../theme';\n\ntype Props = { scene: IScene, onUpdate: (scene: IScene) => void };\nconst Canvas: React.SFC<Props> = ({ scene, onUpdate }) => {\n\tconst theme = useExtendedTheme();\n\tconst [activeLayer, setActiveLayer] = useState<string | null>(null);\n\n\t// Default selected layer to the first layer\n\tuseEffect(() => {\n\t\tif (activeLayer === TableViewLayer.id) return;\n\n\t\tif (\n\t\t\t(activeLayer === null || !scene.layers.some((l) => l.id === activeLayer)) &&\n\t\t\tscene.layers.length\n\t\t) {\n\t\t\tsetActiveLayer(scene.layers[0].id);\n\t\t}\n\t}, [activeLayer, scene])\n\n\tconst onLayerUpdate = useCallback((updatedLayer: ILayer) => {\n\t\tconst i = scene.layers.findIndex((l) => l.id === updatedLayer.id);\n\t\tscene.layers[i] = updatedLayer;\n\t\tonUpdate({ ...scene })\n\t}, [scene, onUpdate]);\n\n\tfunction addLayer(type: LayerType) {\n\t\tconst layer = createNewLayer(type);\n\t\tlayer.name = 'Layer ' + (scene.layers.length + 1);\n\t\tscene.layers.push(layer);\n\t\tonUpdate({ ...scene });\n\t}\n\n\tfunction updateLayer(layer: ILayer) {\n\t\tconst index = scene.layers.findIndex((l) => l.id === layer.id);\n\t\tscene.layers[index] = layer;\n\t\tonUpdate({\n\t\t\t...scene,\n\t\t\tlayers: [...scene.layers]\n\t\t});\n\t}\n\n\tfunction editActiveLayerName(name: string) {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayer);\n\t\tif (!layer) return;\n\n\t\tlayer.name = name;\n\t\tonUpdate({\n\t\t\t...scene,\n\t\t\tlayers: [...scene.layers]\n\t\t});\n\t}\n\n\tfunction moveActiveLayer(direction: 'up' | 'down') {\n\t\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayer);\n\t\tif (layerIndex !== -1) {\n\t\t\tconst swapIndex = direction === 'up' ? layerIndex + 1 : layerIndex - 1;\n\t\t\tif (swapIndex > scene.layers.length - 1 || swapIndex < 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentLayer = scene.layers[layerIndex];\n\t\t\tconst layerToSwap = scene.layers[swapIndex];\n\n\t\t\tscene.layers[swapIndex] = currentLayer;\n\t\t\tscene.layers[layerIndex] = layerToSwap;\n\n\t\t\tonUpdate({\n\t\t\t\t...scene,\n\t\t\t\tlayers: [...scene.layers]\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function deleteActiveLayer() {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayer);\n\t\tif (layer) {\n\t\t\tconst newScene = await deleteLayer(scene, layer);\n\t\t\tonUpdate({\n\t\t\t\t...newScene,\n\t\t\t\tlayers: [...newScene.layers]\n\t\t\t});\n\t\t\tsetActiveLayer(null);\n\t\t}\n\t}\n\n\treturn (\n\t\t<ToolbarPortalProvider>\n\t\t\t{/* Canvas */}\n\t\t\t<DraggableStage\n\t\t\t\tclassName={css`\n\t\t\t\t\tflex-grow: 2;\n\t\t\t\t\twidth: calc(100vw - ${theme.sceneListWidth + theme.sidebarWidth}px);\n\t\t\t\t\theight: calc(100vh - ${theme.headerHeight}px);\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t{\n\t\t\t\t\tscene.layers.map((layer) => {\n\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\tif (!Component || layer.visible === false) return null;\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\tonUpdate={onLayerUpdate}\n\t\t\t\t\t\t\t\tactive={activeLayer === layer.id}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t<TableViewOverlay\n\t\t\t\t\tlayer={{\n\t\t\t\t\t\t...TableViewLayer,\n\t\t\t\t\t\toptions: scene.table\n\t\t\t\t\t}}\n\t\t\t\t\tactive={activeLayer === TableViewLayer.id}\n\t\t\t\t\tonUpdate={(layer) => {\n\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t...scene,\n\t\t\t\t\t\t\ttable: layer.options\n\t\t\t\t\t\t})\n\t\t\t\t\t}}\n\t\t\t\t\tshowBorder={true}\n\t\t\t\t\tshowGrid={true}\n\t\t\t\t/>\n\t\t\t</DraggableStage>\n\n\t\t\t<LayerList\n\t\t\t\tscene={scene}\n\t\t\t\tactiveLayer={activeLayer}\n\t\t\t\tsetActiveLayer={setActiveLayer}\n\t\t\t\tupdateLayer={updateLayer}\n\t\t\t\taddLayer={addLayer}\n\t\t\t\teditActiveLayerName={editActiveLayerName}\n\t\t\t\tmoveActiveLayer={moveActiveLayer}\n\t\t\t\tdeleteActiveLayer={deleteActiveLayer}\n\t\t\t/>\n\t\t</ToolbarPortalProvider>\n\t);\n}\nexport default Canvas;","import React, { useState, useEffect } from \"react\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport { Spinner, Text, useTheme, IconButton, IconPlay, IconPause, IconUpload, IconEdit2, IconCheck, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { useSceneDatabase, IScene } from \".\";\nimport Canvas from \"./canvas\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\nimport { useExtendedTheme } from \"../theme\";\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nfunction SceneNameHeader({ name, onUpdate: updateName }: { name: string, onUpdate: (name: string) => void }) {\n\tconst theme = useTheme();\n\tconst [inEdit, setInEdit] = useState(false);\n\tconst [localName, setLocalName] = useState(name);\n\n\tuseEffect(() => {\n\t\tsetLocalName(name);\n\t}, [name]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 200;\n\t\t\t`}\n\t\t>\n\t\t\t{!inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Text variant=\"lead\">{name}</Text>\n\t\t\t\t\t<IconButton icon={<IconEdit2 />} size=\"sm\" variant=\"ghost\" label=\"Edit Name\" onClick={() => setInEdit(true)} />\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Input value={localName} onChange={(e) => setLocalName(e.target.value)} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon={<IconCheck />}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tcolor={theme.colors.intent.success.base}\n\t\t\t\t\t\tlabel=\"Save Name\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tupdateName(localName);\n\t\t\t\t\t\t\tsetInEdit(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!localName.trim()}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t}\n\t\t</div >\n\t);\n}\n\nfunction TableDisplayButton({ scene }: { scene: IScene }) {\n\tconst theme = useTheme();\n\tconst [displayedScene, updateDisplayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze, updateTableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n\tif (displayedScene === scene.id) {\n\t\tif (tableFreeze) {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPlay />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Unfreeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.green.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(false)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t\telse {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPause />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Freeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.yellow.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(true)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t}\n\telse {\n\t\treturn (\n\t\t\t<IconButton\n\t\t\t\ticon={<IconUpload />}\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel=\"Display on Table\"\n\t\t\t\tcolor={theme.colors.text.heading} onPress={() => {\n\t\t\t\t\tupdateDisplayedScene(scene.id);\n\t\t\t\t\tupdateTableFreeze(false)\n\t\t\t\t}}\n\t\t\t/>\n\t\t)\n\t}\n}\n\ntype Props = {};\nconst SceneEditor: React.SFC<Props> = () => {\n\tconst theme = useExtendedTheme();\n\n\tconst match = useRouteMatch<{ id: string }>();\n\tconst [scene, updateScene] = useOneValue(match.params.id);\n\n\tif (!match.params.id) {\n\t\treturn null;\n\t}\n\n\tif (scene === undefined) {\n\t\treturn <Spinner label=\"Loading scene...\" center />\n\t}\n\t\n\tif (scene === null) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-grow: 1;\n\t\t\t`}\n\t\t>\n\t\t\t{/* Header */}\n\t\t\t<div\n\t\t\t\tclassName={css`\n\t\t\t\t\tbackground-color: ${theme.colors.background.layer};\n\t\t\t\t\tpadding: ${theme.spaces.sm} ${theme.spaces.md};\n\t\t\t\t\tbox-shadow: ${theme.shadows.sm};\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\theight: ${theme.headerHeight}px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<SceneNameHeader name={scene.name} onUpdate={(name) => updateScene({ ...scene, name })} />\n\t\t\t\t<div>\n\t\t\t\t\t{/* TODO */}\n\t\t\t\t\t{/* <IconButton icon={<IconRotateCcw />} variant=\"ghost\" label=\"Undo\" />\n\t\t\t\t\t<IconButton icon={<IconRotateCw />} variant=\"ghost\" label=\"Redo\" /> */}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<TableDisplayButton scene={scene} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Canvas */}\n\t\t\t<Canvas scene={scene} onUpdate={updateScene} />\n\t\t</div>\n\t);\n}\nexport default SceneEditor;","import React, { useState } from \"react\";\nimport { List, ListItem, Skeleton, Input, useTheme, IconButton, IconPlusCircle, Button, IconPlus, IconFilm, IconPlay, IconPause } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { IScene, useSceneDatabase, createNewScene } from \".\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\nimport { useExtendedTheme } from \"../theme\";\n\nconst { useAllValues, createItem } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nfunction LoadingScenes() {\n  return <List><ListItem primary={<Skeleton animated />} /></List>\n}\n\nfunction NoScenes(props: { onAdd: () => void }) {\n  const theme = useTheme();\n\n  return (\n    <div\n      className={css`\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      `}\n    >\n      <div\n        className={css`\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      `}\n      >\n        <IconFilm size=\"xl\" color=\"#BDBEBF\" />\n        <Button iconBefore={<IconPlus />} variant=\"ghost\" color={theme.colors.text.muted} onClick={props.onAdd}>Add a scene</Button>\n      </div>\n    </div>\n  )\n}\n\nfunction SceneStatusIcon({ scene }: { scene: IScene }) {\n  const theme = useTheme();\n  const [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n  const [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n  if (displayedScene === scene.id) {\n    if (!tableFreeze) {\n      return <IconPlay color={theme.colors.palette.green.base} />;\n    }\n    else {\n      return <IconPause color={theme.colors.palette.yellow.base} />;\n    }\n  }\n  else {\n    return null;\n  }\n}\n\ntype Props = { onSceneSelect: (scene: IScene) => any, selectedSceneId: string };\nconst SceneList: React.SFC<Props> = ({ onSceneSelect, selectedSceneId }) => {\n  const theme = useExtendedTheme();\n\n  const allScenes = useAllValues();\n  const [searchText, setSearchText] = useState(\"\");\n\n  function addNewScene() {\n    const scene = createNewScene();\n    createItem(scene.id, scene);\n    onSceneSelect(scene);\n  }\n\n  if (!allScenes) {\n    return <LoadingScenes />\n  }\n\n  if (allScenes.size === 0) {\n    return <NoScenes onAdd={addNewScene} />\n  }\n\n  let sceneList = Array.from(allScenes.values());\n  if (searchText) {\n    sceneList = sceneList.filter((scene) => scene.name.toLowerCase().includes(searchText.toLowerCase()));\n  }\n\n  return (\n    <List\n      className={css`\n        display: ${theme.sceneListWidth > 0 ? 'flex' : 'none'};\n        width: ${theme.sceneListWidth}px;\n        flex-shrink: 0;\n        flex-direction: column;\n        z-index: 300;\n      `}\n    >\n      <div\n        className={css`\n          display: flex;\n          padding: ${theme.spaces.sm};\n        `}\n      >\n        <Input type=\"search\" placeholder=\"Find a scene...\" onChange={(e) => setSearchText(e.target.value)} value={searchText} />\n        <IconButton icon={<IconPlusCircle />} label=\"Add Scene\" variant=\"ghost\" onClick={addNewScene} />\n      </div>\n      <div\n        className={css`\n          overflow: auto;\n        `}\n      >\n        {sceneList.map((scene) => (\n          <ListItem\n            primary={scene.name}\n            key={scene.id}\n            contentAfter={<SceneStatusIcon scene={scene} />}\n            onPress={() => onSceneSelect(scene)}\n            className={css`\n              background: ${selectedSceneId === scene.id ? theme.colors.intent.primary.dark : undefined} !important;\n            `}\n          />\n        ))}\n      </div>\n    </List>\n  );\n};\nexport default SceneList;","import React from \"react\";\nimport { css } from 'emotion'\nimport { Global } from '@emotion/core'\nimport { useTheme } from 'sancho';\nimport { Helmet } from 'react-helmet';\nimport { Switch, Route, useRouteMatch, useHistory } from \"react-router-dom\";\n\nimport SceneEditor from \"../scene/editor\";\nimport SceneList from \"../scene/list\";\nimport { IScene } from \".\";\n\nfunction useCurrentSelectedScene() {\n  const routeMatch = useRouteMatch();\n  const matchedSceneRoute = useRouteMatch<{ id: string }>({ path: routeMatch.path + '/:id' });\n  return matchedSceneRoute?.params.id;\n}\n\ntype Props = {};\nconst ScenePage: React.SFC<Props> = () => {\n  const theme = useTheme();\n  const history = useHistory();\n  const routeMatch = useRouteMatch();\n\n  const currentSelectedScene = useCurrentSelectedScene();\n\n  function onSceneSelect(scene: IScene) {\n    history.push(`${routeMatch.path}/${scene.id}`)\n  }\n\n  return (\n    <>\n      <Helmet\n        title='D&amp;D Tabletop'\n      />\n      <Global\n        styles={{\n          html: {\n            background: theme.colors.background.default,\n            color: theme.colors.text.default,\n            fontFamily: theme.fonts.base,\n          },\n          body: {\n            padding: 0,\n            margin: 0,\n            width: '100vw',\n            height: '100vh',\n            \"*:focus\": {\n              outline: 'none'\n            },\n            overflow: 'hidden'\n          }\n        }}\n      />\n      <Switch>\n        <Route path={[`${routeMatch.path}`, `${routeMatch.path}/:id`]} exact>\n          <div\n            className={css`\n              display: flex;\n              flex-direction: row;\n              width: 100%;\n              height: 100vh;\n            `}\n          >\n            <SceneList onSceneSelect={onSceneSelect} selectedSceneId={currentSelectedScene!} />\n            <SceneEditor />\n          </div>\n        </Route>\n      </Switch>\n    </>\n  );\n};\nexport default ScenePage;","import React, { useState, useEffect } from 'react';\nimport { useSettingsDatabase, Settings, useTableResolution } from '../settings';\nimport { useSceneDatabase, IScene } from '../scene';\nimport { Stage } from 'react-konva';\nimport { Global } from '@emotion/core';\nimport { Helmet } from 'react-helmet';\nimport { LayerTypeToComponent } from '../scene/layer';\nimport TableViewOverlay, { TableViewLayer } from '../scene/layer/tableView';\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype Props = {};\nconst TablePage: React.SFC<Props> = () => {\n\tconst [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\tconst [tableResolution] = useTableResolution();\n\n\tconst [scene] = useOneValue(displayedScene as string);\n\tconst [tableScene, setTableScene] = useState<IScene | null>();\n\n\tconst [windowSize, setWindowSize] = useState({ width: window.innerWidth, height: window.innerHeight })\n\n\tuseEffect(() => {\n\t\tif (!tableFreeze && scene) {\n\t\t\tsetTableScene(scene);\n\t\t}\n\t}, [scene, tableFreeze])\n\n\tuseEffect(() => {\n\t\tfunction onResize() {\n\t\t\tsetWindowSize({ width: window.innerWidth, height: window.innerHeight });\n\t\t}\n\t\twindow.addEventListener('resize', onResize);\n\t\treturn () => window.removeEventListener('resize', onResize)\n\t}, [])\n\n\tif (!tableResolution) {\n    return null;\n  }\n\n\treturn (\n\t\t<>\n\t\t\t<Global\n\t\t\t\tstyles={{\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tbackground: 'black',\n\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<Helmet title=\"D&amp;D Table View\" />\n\t\t\t{tableScene &&\n\t\t\t\t<Stage\n\t\t\t\t\t{...windowSize}\n\t\t\t\t\toffsetX={tableScene.table.offset.x}\n\t\t\t\t\toffsetY={tableScene.table.offset.y}\n\t\t\t\t\t// clipFunc={(ctx: CanvasRenderingContext2D) => {\n          //   ctx.beginPath();\n          //   ctx.rect(tableScene.table.offset.x, tableScene.table.offset.y, tableResolution.width, tableResolution.height);\n          //   ctx.rotate(tableScene.table.rotation);\n          //   ctx.closePath();\n          // }}\n\t\t\t\t>\n\t\t\t\t\t{\n\t\t\t\t\t\ttableScene.layers.map((layer) => {\n\t\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\t\tif (!Component || layer.visible === false) return null;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\t\tonUpdate={() => { }}\n\t\t\t\t\t\t\t\t\tactive={false}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\t<TableViewOverlay\n\t\t\t\t\t\tlayer={{\n\t\t\t\t\t\t\t...TableViewLayer,\n\t\t\t\t\t\t\toptions: tableScene.table\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tactive={false}\n\t\t\t\t\t\tonUpdate={() => { }}\n\t\t\t\t\t\tshowBorder={false}\n\t\t\t\t\t\tshowGrid={tableScene.table.displayGrid}\n\t\t\t\t\t/>\n\t\t\t\t</Stage>\n\t\t\t}\n\t\t</>\n\t)\n}\nexport default TablePage;","import React from \"react\";\nimport ScenePage from \"./scene/page\";\nimport TablePage from \"./table/page\";\nimport { IconFilm, IconMap } from \"sancho\";\nimport { Redirect } from \"react-router-dom\";\nimport { SIDEBAR_WIDTH, useSceneSidebarOpen } from \"./theme\";\n\nexport interface IRoute {\n\tname: string;\n\tpath: string;\n\tsidebarIcon: React.ComponentType<any>,\n\tmain: React.ComponentType<any>;\n\tpopout?: boolean;\n\texact?: boolean;\n\tuseOnClick?: () => () => void;\n}\n\nconst routes = {\n\thome: {\n\t\tname: 'Home',\n\t\tpath: '/',\n\t\tsidebarIcon: () => <img width={SIDEBAR_WIDTH / 1.5} height={SIDEBAR_WIDTH / 1.5} src=\"favicon.png\" alt=\"home icon\" />,\n\t\tmain: () => <Redirect to={routes.scenes.path} />,\n\t\texact: true,\n\t},\n\tscenes: {\n\t\tname: 'Scenes',\n\t\tpath: '/scenes',\n\t\tsidebarIcon: IconFilm,\n\t\tmain: () => <ScenePage />,\n\t\tuseOnClick: () => {\n\t\t\tconst [sidebarOpen, setSidebarOpen] = useSceneSidebarOpen()\n\t\t\treturn () => {\n\t\t\t\tsetSidebarOpen(!sidebarOpen)\n\t\t\t}\n\t\t}\n\t},\n\ttable: {\n\t\tname: 'Table View',\n\t\tpath: '/table',\n\t\tsidebarIcon: IconMap,\n\t\tmain: () => <TablePage />,\n\t\tpopout: true,\n\t\texact: true,\n\t}\n} as { [key: string]: IRoute }\n\nexport default routes;","import React from 'react';\nimport { useRouteMatch, Link, useLocation } from 'react-router-dom';\nimport { css } from \"emotion\";\nimport { useTheme, IconButton, Tooltip } from 'sancho';\n\nimport routes, { IRoute } from './routes';\nimport SettingsSidebarItem from './settings';\nimport { useExtendedTheme } from './theme';\n\ntype Props = { route: IRoute }\nconst SidebarItem: React.SFC<Props> = ({ route }) => {\n\tconst theme = useTheme();\n\tconst match = !!useRouteMatch({\n\t\tpath: route.path,\n\t\texact: route.exact\n\t});\n\tconst onClick = route.useOnClick ? route.useOnClick() : undefined;\n\n\tconst inner = (\n\t\t<Tooltip content={route.name} placement=\"right\">\n\t\t\t<IconButton variant=\"ghost\" color={match ? theme.colors.text.default : theme.colors.text.muted} size=\"lg\" icon={<route.sidebarIcon />} label={route.name} />\n\t\t</Tooltip>\n\t);\n\n\tif (match) {\n\t\treturn (\n\t\t\t<div onClick={onClick}>\n\t\t\t\t{inner}\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Link to={route.path} target={route.popout ? '_blank' : undefined}>\n\t\t\t{inner}\n\t\t</Link>\n\t)\n}\n\nconst Sidebar: React.SFC = () => {\n\tconst theme = useExtendedTheme();\n\tconst location = useLocation();\n\n\tconst hideSidebar = Object.keys(routes)\n\t\t.map((routeName) => routes[routeName])\n\t\t.some((route) => route.exact && route.popout && route.path === location.pathname) || location.pathname === routes.home.path;\n\n\tif (hideSidebar) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\twidth: ${theme.sidebarWidth}px;\n\t\t\t\theight: 100vh;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tbackground-color: ${theme.colors.background.default};\n\t\t\t\tz-index: 300;\n\t\t\t`}\n\t\t>\n\t\t\t{Object.keys(routes).map(routeName => {\n\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\treturn <SidebarItem key={routeName} route={route} />\n\t\t\t})}\n\t\t\t<div className={css`flex-grow: 1;`} />\n\t\t\t<SettingsSidebarItem />\n\t\t</div>\n\t)\n}\nexport default Sidebar;","import React from 'react';\nimport {\n\tHashRouter as Router,\n\tSwitch,\n\tRoute\n} from 'react-router-dom';\nimport { DarkMode } from 'sancho';\nimport { css } from 'emotion';\n\nimport routes from './routes';\nimport Sidebar from './sidebar';\n\nconst App: React.SFC = () => {\n\treturn (\n\t\t<DarkMode>\n\t\t\t<Router>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<Sidebar />\n\t\t\t\t\t<Switch>\n\t\t\t\t\t\t{Object.keys(routes).map((routeName) => {\n\t\t\t\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\t\t\tkey={routeName}\n\t\t\t\t\t\t\t\t\tpath={route.path}\n\t\t\t\t\t\t\t\t\texact={route.exact}\n\t\t\t\t\t\t\t\t\tcomponent={route.main}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</Switch>\n\t\t\t\t</div>\n\t\t\t</Router>\n\t\t</DarkMode>\n\t);\n}\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(<App/>, document.getElementById('root'));"],"sourceRoot":""}