{"version":3,"sources":["storage.ts","scene/asset/assetSize.tsx","scene/asset/index.tsx","scene/asset/storage.ts","settings/index.tsx","scene/canvas/transformableAsset.tsx","scene/layer/assetLayer/asset.tsx","scene/layer/toolbarItem.tsx","scene/layer/toolbar.tsx","scene/layer/toolbarPortal.tsx","scene/layer/assetLayer/advancedAssetSizer.tsx","scene/canvas/draggableStage.tsx","theme.tsx","scene/layer/assetLayer/visualAssetSizer.tsx","scene/layer/assetLayer/assetSizer.tsx","scene/layer/assetLayer/index.tsx","scene/layer/fogLayer/editablePolygon.tsx","utils.tsx","scene/layer/fogLayer/index.tsx","scene/layer/index.tsx","scene/index.tsx","scene/layer/tableView/zoomToolbarItem.tsx","scene/layer/tableView/index.tsx","scene/canvas/editLayerButton.tsx","scene/canvas/layerList.tsx","scene/canvas/index.tsx","scene/editor.tsx","scene/list.tsx","scene/page.tsx","table/page.tsx","routes.tsx","sidebar.tsx","App.tsx","index.tsx"],"names":["RTStorage","require","useGlobalStorage","name","storage","useAllValues","useState","data","setState","useEffect","handleStorageChange","keys","then","a","items","Map","Promise","all","map","k","getItem","item","set","subscription","subscribe","unsubscribe","useOneValue","key","undefined","lastData","d","newData","setItem","createItem","object","getImageSize","file","res","img","Image","src","URL","createObjectURL","onload","width","height","getVideoSize","video","document","createElement","addEventListener","videoWidth","videoHeight","AssetType","fileStorage","getNewAssets","fileDialogInput","type","multiple","accept","click","onchange","e","files","target","assets","Array","i","length","createAsset","push","asset","id","v4","IMAGE","transform","x","y","rotation","indexOf","VIDEO","Error","size","deleteAsset","removeItem","assetCache","LRU","max","entry","maxAge","getImageElement","fr","FileReader","result","readAsDataURL","getVideoElement","muted","autoplay","play","Settings","useSettingsDatabase","useOneSettingValue","useTableResolution","TABLE_RESOLUTION","tableResolution","setTableResolution","useTableSize","TABLE_SIZE","tableSize","setTableSize","useTablePPI","theta","Math","atan","widthInch","cos","ScreenSizeSettings","theme","useTheme","formItemMargin","css","spaces","sm","Text","variant","label","className","min","placeholder","value","onChange","Number","isNaN","SettingsSidebarItem","dialogOpen","setDialogOpen","Tooltip","content","placement","IconButton","color","colors","text","icon","IconSettings","onClick","Dialog","isOpen","onRequestClose","title","lg","TransformableAsset","rectTransform","onTransform","isSelected","onSelected","snapOffset","children","rotateEnabled","scaleEnabled","skewEnabled","strokeEnabled","groupRef","useRef","trRef","ppi","current","setNodes","getLayer","batchDraw","Fragment","ref","draggable","onMouseUp","evt","button","cancelBubble","onDragEnd","node","scaleX","scaleY","round","xOffset","yOffset","onTransformEnd","resizeEnabled","enabledAnchors","borderStrokeWidth","anchorFill","background","overlay","anchorStroke","palette","blue","light","rotationSnaps","rotateAnchorOffset","Asset","onUpdate","selected","el","get","setEntry","element","useAssetElement","calibration","snapToGrid","newRect","image","ToolbarItem","keyboardShortcuts","otherProps","onKeyPress","includes","window","activeElement","tagName","removeEventListener","Toolbar","tint1","shadows","md","useToolbarPortal","singletonHook","ToolbarPortal","portal","ReactDOM","render","unmountComponentAtNode","ToolbarPortalProvider","setPortal","AdvancedAssetSizer","updateCalibrationValue","newCal","ppiX","ppiY","ppiLocked","setPPILocked","IconLock","IconUnlock","disabled","Konva","dragButtons","DraggableStage","initialZoom","containerRef","containerSize","useComponentSize","stageRef","zoom","setZoom","tint2","scale","onWheel","preventDefault","deltaX","deltaY","deltaZ","ctrlKey","oldZoom","stage","pointerPosition","getPointerPosition","mousePointTo","zoomSpeed","abs","newZoom","newPos","position","onContextMenu","useSceneSidebarOpen","useExtendedTheme","sceneSidebarOpen","headerHeight","sceneListWidth","sidebarWidth","visualAssetSizerSize","VisualAssetSizer","innerRectangles","strokeWidth","stroke","base","strokeScaleEnabled","rect","AssetSizer","showModal","setShowModal","setCalibration","IconSliders","Button","intent","PolygonType","AssetLayer","layer","layerActive","active","isTable","selectedAssetId","setSelectedAssetId","layerRef","tablePPI","deleteSelectedAsset","useCallback","has","delete","from","values","some","previousUpdate","Date","now","anim","Animation","start","stop","parent","on","onParentClick","off","toolbar","useMemo","selectedAsset","find","IconFilePlus","IconRotateCcw","screenPPI","checked","IconTrash2","listening","updatedAsset","Anchor","firstAnchor","onMove","onMoveEnd","sceneFunc","context","shape","radius","getAbsoluteScale","beginPath","ellipse","PI","closePath","fillStrokeShape","onDragMove","fill","EditablePolygon","polygon","adding","selectable","lineProps","verticies","localVerticies","setLocalVerticies","groupX","reduce","v","MAX_VALUE","groupY","relativeKonvaCoordinates","flat","container","style","cursor","handleClick","getAbsoluteTransform","copy","invert","pos","getStage","relPos","point","newX","newY","offsetX","offsetY","closed","points","dash","v2","groupX2","groupY2","newRelative","useKeyPress","targetKey","keyPressed","setKeyPressed","downHandler","upHandler","LayerType","FogLayer","addingPolygon","setAddingPolygon","selectedPolygon","setSelectedPolygon","console","log","IconCloud","poly","FOG","visibleOnTable","fogPolygons","IconCloudOff","FOG_CLEAR","fogClearPolygons","IconEye","IconEyeOff","fogPolygonIndex","splice","fogClearPolygonIndex","canvas","_canvas","onPolygonAdded","collection","isEscapePressed","shouldEndAdd","onPolygonUpdated","fogPoly","opacity","gray","dark","lightest","globalCompositeOperation","LayerTypeToComponent","ASSETS","createNewLayer","visible","obstructionPolygons","lightSources","deleteLayer","scene","layers","useSceneDatabase","ZoomToolbarItem","zoomDisplay","toFixed","IconZoomOut","IconZoomIn","TableViewLayer","TABLE_VIEW","TableViewOverlay","showBorder","showGrid","options","localOptions","setLocalOptions","IconCrosshair","offset","displayGrid","isShiftPressed","lines","l","floor","end","clipFunc","ctx","rotate","line","dashOffset","onMouseDown","buttons","setDraggable","EditLayerButton","setName","IconEdit2","LayerList","activeLayerId","setActiveLayer","updateLayer","addLayer","moveActiveLayer","deleteActiveLayer","layerIndex","findIndex","isActiveLayerTop","isActiveLayerBottom","activeLayer","Layer","List","primary","contentBefore","IconTv","contentAfter","reverse","danger","IconArrowUp","IconArrowDown","Popover","Menu","IconFile","onPress","IconCloudDrizzle","IconPlus","Canvas","setActiveLayerId","onLayerUpdate","updatedLayer","newScene","Component","table","index","editActiveLayerName","direction","swapIndex","currentLayer","layerToSwap","SceneNameHeader","updateName","inEdit","setInEdit","localName","setLocalName","IconCheck","success","trim","TableDisplayButton","DISPLAYED_SCENE","displayedScene","updateDisplayedScene","TABLE_FREEZE","tableFreeze","updateTableFreeze","IconPlay","green","IconPause","yellow","IconUpload","heading","SceneEditor","match","useRouteMatch","params","updateScene","Spinner","center","LoadingScenes","Skeleton","animated","NoScenes","props","IconFilm","iconBefore","onAdd","SceneStatusIcon","SceneList","onSceneSelect","selectedSceneId","allScenes","searchText","setSearchText","addNewScene","defaultLayer","createNewScene","sceneList","filter","toLowerCase","IconPlusCircle","ScenePage","history","useHistory","routeMatch","currentSelectedScene","matchedSceneRoute","path","useCurrentSelectedScene","Helmet","styles","html","default","fontFamily","fonts","body","padding","margin","outline","overflow","exact","TablePage","tableScene","setTableScene","innerWidth","innerHeight","windowSize","setWindowSize","onResize","routes","home","sidebarIcon","SIDEBAR_WIDTH","alt","main","to","scenes","useOnClick","sidebarOpen","setSidebarOpen","IconMap","popout","SidebarItem","route","inner","Sidebar","location","useLocation","Object","routeName","pathname","App","component","getElementById"],"mappings":"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","file":"static/js/main.243a5385.chunk.js","sourcesContent":["import { useState, useEffect, Dispatch, SetStateAction } from 'react';\nconst RTStorage = require('rt-storage');\n\ninterface IRTStorage<T> {\n\tgetItem<V extends T>(key: string): Promise<V>;\n\tsetItem<V extends T>(key: string, value: V): Promise<V>;\n\tremoveItem(key: string): Promise<void>;\n\tkeys(): Promise<Array<string>>;\n\tsubscribe<V extends T>(handler: (value: V) => void): { unsubscribe: () => void };\n\tsubscribe<V extends T>(key: string, handler: (value: V) => void): { unsubscribe: () => void };\n}\n\nexport default function useGlobalStorage<T>(name: string) {\n\tconst storage = new RTStorage({ name }) as IRTStorage<T>;\n\tconst useOneValue = <V extends T = T>(key: string) => {\n\t\tconst [data, setState] = useState<V | null | undefined>(undefined);\n\n\t\tuseEffect(() => {\n\t\t\tstorage.getItem<V>(key).then((lastData) => {\n\t\t\t\tif (lastData) {\n\t\t\t\t\tsetState(lastData);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetState(null);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst subscription = storage.subscribe(key, (d: V) => setState(d));\n\t\t\treturn () => {\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t};\n\t\t}, [key]);\n\n\t\tconst setData = async (newData: V) => {\n\t\t\tsetState(newData);\n\t\t\tawait storage.setItem(key, newData);\n\t\t}\n\n\t\treturn [data, setData] as [V | null | undefined, Dispatch<SetStateAction<V>>];\n\t}\n\n\treturn {\n\t\tuseAllValues: () => {\n\t\t\tconst [data, setState] = useState<Map<string, T>>();\n\n\t\t\tuseEffect(() => {\n\t\t\t\tfunction handleStorageChange() {\n\t\t\t\t\tstorage.keys()\n\t\t\t\t\t\t.then(async (keys: string[]) => {\n\t\t\t\t\t\t\tconst items = new Map<string, T>();\n\t\t\t\t\t\t\tawait Promise.all(keys.map(async (k) => {\n\t\t\t\t\t\t\t\tconst item = await storage.getItem(k)\n\t\t\t\t\t\t\t\titems.set(k, item);\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\tsetState(items);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\thandleStorageChange();\n\t\t\t\tconst subscription = storage.subscribe(handleStorageChange);\n\t\t\t\treturn () => {\n\t\t\t\t\tsubscription.unsubscribe();\n\t\t\t\t};\n\t\t\t}, []);\n\n\t\t\treturn data;\n\t\t},\n\t\tuseOneValue,\n\t\tcreateItem: (key: string, object: T) => {\n\t\t\tstorage.setItem(key, object);\n\t\t},\n\t\tstorage\n\t};\n};","export function getImageSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst img = new Image();\n\t\timg.src = URL.createObjectURL(file);\n\t\timg.onload = () => {\n\t\t\tres({\n\t\t\t\twidth: img.width,\n\t\t\t\theight: img.height\n\t\t\t})\n\t\t}\n\t})\n}\n\nexport function getVideoSize(file: File) {\n\treturn new Promise<{ width: number, height: number }>((res) => {\n\t\tconst video = document.createElement('video');\n\t\tvideo.src = URL.createObjectURL(file);\n\t\tvideo.addEventListener('loadedmetadata', () => {\n\t\t\tres({\n\t\t\t\twidth: video.videoWidth,\n\t\t\t\theight: video.videoHeight\n\t\t\t})\n\t\t});\n\t})\n}","import LRU from 'lru-cache';\nimport { useState, useEffect } from 'react';\n\nimport { getImageSize, getVideoSize } from \"./assetSize\";\nimport { AssetTransform } from \"../canvas/transformableAsset\";\nimport { useAssetFileDatabase } from './storage';\nimport { v4 } from 'uuid';\n\nconst { storage: fileStorage } = useAssetFileDatabase();\n\nexport enum AssetType {\n\tIMAGE,\n\tVIDEO\n}\n\nexport interface IAssetCalibration {\n\txOffset: number;\n\tyOffset: number;\n\tppiX: number;\n\tppiY: number;\n}\n\nexport interface IAsset {\n\tid: string;\n\tsize: { width: number, height: number };\n\ttransform: AssetTransform;\n\toverrideCalibration?: boolean;\n\tcalibration?: IAssetCalibration\n\ttype: AssetType;\n\tsnapToGrid?: boolean\n}\n\nexport function getNewAssets() {\n\tconst fileDialogInput = document.createElement('input');\n\tfileDialogInput.type = \"file\";\n\tfileDialogInput.multiple = true;\n\tfileDialogInput.accept = 'image/*,video/*';\n\n\tfileDialogInput.click();\n\treturn new Promise<Array<IAsset>>((res) => {\n\t\tfileDialogInput.onchange = async (e) => {\n\t\t\tconst files = (e!.target as HTMLInputElement).files;\n\t\t\tif (!files) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst assets = new Array<IAsset>();\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst file = files.item(i);\n\t\t\t\tif (!file) continue;\n\n\t\t\t\tassets.push(await createAsset(file));\n\t\t\t}\n\t\t\tres(assets);\n\t\t}\n\t});\n}\n\nexport async function createAsset(file: File) {\n\tconst asset = {\n\t\tid: v4(),\n\t\ttype: AssetType.IMAGE,\n\t\ttransform: {\n\t\t\tx: 0, y: 0,\n\t\t\twidth: 0, height: 0,\n\t\t\trotation: 0\n\t\t}\n\t} as IAsset;\n\n\tlet res: { width: number, height: number };\n\tif (file.type.indexOf('image') === 0) {\n\t\tres = await getImageSize(file);\n\t\tasset.type = AssetType.IMAGE;\n\t}\n\telse if (file.type.indexOf('video') === 0) {\n\t\tres = await getVideoSize(file)\n\t\tasset.type = AssetType.VIDEO;\n\t}\n\telse {\n\t\tthrow new Error('Unknown file type');\n\t}\n\n\tasset.size = {\n\t\twidth: res.width,\n\t\theight: res.height\n\t}\n\tasset.transform.width = res.width;\n\tasset.transform.height = res.height;\n\n\tawait fileStorage.setItem(asset.id, file);\n\treturn asset;\n}\n\nexport async function deleteAsset(asset: IAsset) {\n\tawait fileStorage.removeItem(asset.id);\n}\n\n\ntype CacheEntry = { file: File, element?: HTMLImageElement | HTMLVideoElement };\nconst assetCache = new LRU<string, CacheEntry | null>({\n\tmax: 1024 * 1024 * 500, // 500 MB\n\tlength: (entry) => (entry ? entry.file.size : 0),\n\tmaxAge: 60 * 60 * 1000 // 1 hour\n})\n\nasync function getImageElement(file: File) {\n\treturn new Promise<HTMLImageElement>((res) => {\n\t\tvar fr = new FileReader();\n\t\tconst img = document.createElement('img') as HTMLImageElement;\n\t\tfr.onload = function () {\n\t\t\tif (fr.result) {\n\t\t\t\timg.src = fr.result as string;\n\t\t\t\tres(img);\n\t\t\t}\n\t\t}\n\t\tfr.readAsDataURL(file);\n\t})\n}\n\nasync function getVideoElement(file: File) {\n\tconst video = document.createElement('video');\n\tvideo.src = URL.createObjectURL(file);\n\tvideo.muted = true;\n\tvideo.autoplay = true;\n\tvideo.play();\n\treturn video;\n}\n\nexport function useAssetElement(asset: IAsset) {\n\tconst [entry, setEntry] = useState<CacheEntry | null | undefined>(assetCache.get(asset.id));\n\n\tuseEffect(() => {\n\t\tif (entry === undefined) {\n\t\t\tfileStorage.getItem(asset.id)\n\t\t\t\t.then(async (file) => {\n\t\t\t\t\tconst element = await (asset.type === AssetType.IMAGE ? getImageElement(file) : getVideoElement(file));\n\t\t\t\t\tconst entry = { file, element };\n\t\t\t\t\tassetCache.set(asset.id, entry)\n\t\t\t\t\tsetEntry(entry);\n\t\t\t\t})\n\t\t}\n\t}, [entry, asset.type, asset.id])\n\n\treturn entry === null ? null : entry?.element;\n}","import useGlobalStorage from \"../../storage\";\n\nconst fileStorage = useGlobalStorage<File>('asset_file');\nexport function useAssetFileDatabase() {\n\treturn fileStorage;\n}","import useGlobalStorage from \"../storage\";\nimport React, { useState, SetStateAction, Dispatch } from \"react\";\nimport { IconButton, useTheme, IconSettings, Dialog, Tooltip, Text, InputGroup, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nexport enum Settings {\n  DISPLAYED_SCENE = 'displayed_scene',\n  TABLE_FREEZE = 'table_freeze',\n  TABLE_RESOLUTION = 'table_resolution',\n  TABLE_SIZE = 'table_size'\n}\n\nconst storage = useGlobalStorage<unknown>('settings');\nexport function useSettingsDatabase() {\n  return storage;\n}\n\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype TableResolution = { width: number, height: number };\nexport function useTableResolution(): [TableResolution | undefined, Dispatch<SetStateAction<TableResolution>>] {\n  const [tableResolution, setTableResolution] = useOneSettingValue<TableResolution>(Settings.TABLE_RESOLUTION);\n\n  if (tableResolution === null) {\n    return [\n      { width: 1920, height: 1080 },\n      setTableResolution\n    ]\n  }\n\n  return [tableResolution, setTableResolution];\n}\n\nexport function useTableSize(): [number | undefined, Dispatch<SetStateAction<number>>] {\n  const [tableSize, setTableSize] = useOneSettingValue<number>(Settings.TABLE_SIZE);\n\n  if (tableSize === null) {\n    return [\n      45,\n      setTableSize\n    ]\n  }\n\n  return [tableSize, setTableSize];\n}\n\nexport function useTablePPI(): number | null {\n  const [tableResolution] = useTableResolution();\n\tconst [tableSize] = useTableSize();\n\tif (!tableResolution || !tableSize) {\n\t\treturn null;\n  }\n  \n  const theta = Math.atan(tableResolution.height / tableResolution.width);\n\tconst widthInch = tableSize * Math.cos(theta);\n\t// const heightInch = tableSize * Math.sin(theta);\n\n  const ppi = tableResolution.width / widthInch;\n  return ppi;\n}\n\nconst ScreenSizeSettings: React.SFC = () => {\n  const theme = useTheme();\n  \n  const [tableResolution, setTableResolution] = useTableResolution();\n  const [tableSize, setTableSize] = useTableSize();\n\n  const formItemMargin = css`margin: 0 ${theme.spaces.sm};`;\n  \n  if (tableResolution === undefined || tableSize === undefined) {\n    return null;\n  }\n\n  return (\n    <>\n      <Text variant=\"h6\">Table Display Settings</Text>\n      <InputGroup label=\"Resolution\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"width\"\n            value={tableResolution.width}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, width: value })\n              }\n            }}\n          />\n          <div className={formItemMargin}>x</div>\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"height\"\n            value={tableResolution.height}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value)) {\n                setTableResolution({ ...tableResolution, height: value })\n              }\n            }}\n          />\n        </div>\n      </InputGroup>\n      <InputGroup label=\"Screen Size\">\n        <div \n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            max={200}\n            value={tableSize}\n            onChange={(e) => {\n              const value = Number(e.target.value);\n              if (!isNaN(value) && value <= 200 && value > 1) {\n                setTableSize(value)\n              }\n            }}\n          />\n          <div className={formItemMargin}>inches</div>\n        </div>\n      </InputGroup>\n    </>\n  );\n}\n\nconst SettingsSidebarItem: React.SFC = () => {\n  const theme = useTheme();\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  return (\n    <>\n      <Tooltip content=\"Settings\" placement=\"right\">\n        <IconButton\n          variant=\"ghost\"\n          color={theme.colors.text.muted}\n          size=\"lg\"\n          icon={<IconSettings />}\n          label=\"Settings\"\n          onClick={() => setDialogOpen(true)}\n        />\n      </Tooltip>\n      <Dialog\n        isOpen={dialogOpen}\n        onRequestClose={() => setDialogOpen(false)}\n        title=\"Settings\"\n      >\n        <div className={css`padding: ${theme.spaces.lg};`}>\n          <ScreenSizeSettings />\n        </div>\n      </Dialog>\n    </>\n  );\n}\nexport default SettingsSidebarItem;","import React, { useRef, useEffect } from 'react';\nimport { Group, Transformer } from 'react-konva';\nimport Konva from 'konva';\nimport { IRect } from 'konva/types/types';\nimport { useTheme } from 'sancho';\nimport { useTablePPI } from '../../settings';\n\nexport type AssetTransform = IRect & { rotation: number };\n\ntype Props = {\n\trectTransform: AssetTransform,\n\tonTransform: (newRect: AssetTransform) => void,\n\tisSelected: boolean,\n\tonSelected: () => void,\n\tsnapOffset?: { x: number, y: number },\n\tscaleEnabled?: boolean;\n\tskewEnabled?: boolean;\n\trotateEnabled?: boolean;\n\tstrokeEnabled?: boolean;\n};\nconst TransformableAsset: React.SFC<Props> = ({\n\trectTransform, onTransform,\n\tisSelected, onSelected,\n\tsnapOffset,\n\tchildren,\n\trotateEnabled, scaleEnabled, skewEnabled, strokeEnabled\n}) => {\n\tconst theme = useTheme();\n\n\tconst groupRef = useRef<Konva.Group>();\n\tconst trRef = useRef<Konva.Transformer>();\n\tconst ppi = useTablePPI();\n\n\tuseEffect(() => {\n\t\tif (isSelected) {\n\t\t\t// we need to attach transformer manually\n\t\t\ttrRef.current?.setNodes([groupRef.current!]);\n\t\t\ttrRef.current?.getLayer()?.batchDraw();\n\t\t}\n\t}, [isSelected]);\n\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<Group\n\t\t\t\tref={groupRef as any}\n\t\t\t\tdraggable={isSelected}\n\t\t\t\tx={rectTransform.x}\n\t\t\t\ty={rectTransform.y}\n\t\t\t\theight={rectTransform.height}\n\t\t\t\twidth={rectTransform.width}\n\t\t\t\trotation={rectTransform.rotation}\n\t\t\t\tonMouseUp={e => {\n\t\t\t\t\tif (e.evt.button === 0) {\n\t\t\t\t\t\te.cancelBubble = true;\n\t\t\t\t\t\tonSelected();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonClick={e => {\n\t\t\t\t\tif (e.evt.button === 0) {\n\t\t\t\t\t\te.cancelBubble = true;\n\t\t\t\t\t\tonSelected();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonDragEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = Math.round(node.rotation() * 100) / 100;\n\n\t\t\t\t\tlet x = e.target.x();\n\t\t\t\t\tlet y = e.target.y();\n\n\t\t\t\t\tif (snapOffset && ppi && rotation % 90 === 0) {\n\t\t\t\t\t\tconst xOffset = snapOffset.x % ppi;\n\t\t\t\t\t\tconst yOffset = snapOffset.y % ppi;\n\t\t\t\t\t\tx = Math.round((x + xOffset) / ppi) * ppi - xOffset;\n\t\t\t\t\t\ty = Math.round((y + yOffset) / ppi) * ppi - yOffset;\n\n\t\t\t\t\t\te.target.x(x);\n\t\t\t\t\t\te.target.y(y);\n\t\t\t\t\t}\n\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: node.width() * scaleX,\n\t\t\t\t\t\theight: node.height() * scaleY\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t\tonTransformEnd={e => {\n\t\t\t\t\tconst node = groupRef.current!;\n\t\t\t\t\tconst scaleX = node.scaleX();\n\t\t\t\t\tconst scaleY = node.scaleY();\n\t\t\t\t\tconst rotation = node.rotation();\n\n\t\t\t\t\tnode.scaleX(1);\n\t\t\t\t\tnode.scaleY(1);\n\n\t\t\t\t\tonTransform({\n\t\t\t\t\t\tx: node.x(),\n\t\t\t\t\t\ty: node.y(),\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\twidth: node.width() * scaleX,\n\t\t\t\t\t\theight: node.height() * scaleY\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Group>\n\t\t\t{isSelected && (\n\t\t\t\t<Transformer\n\t\t\t\t\trotateEnabled={rotateEnabled}\n\t\t\t\t\tresizeEnabled={scaleEnabled}\n\t\t\t\t\tenabledAnchors={skewEnabled === false ? ['top-left', 'top-right', 'bottom-left', 'bottom-right'] : undefined}\n\t\t\t\t\tref={trRef as any}\n\t\t\t\t\tborderStrokeWidth={strokeEnabled === false ? 0 : undefined}\n\t\t\t\t\tanchorFill={theme.colors.background.overlay}\n\t\t\t\t\tanchorStroke={theme.colors.palette.blue.light}\n\t\t\t\t\trotationSnaps={[0, 45, 90, 135, 180, 225, 270, 315]}\n\t\t\t\t\trotateAnchorOffset={20}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</React.Fragment>\n\t);\n}\nexport default TransformableAsset;","import React from 'react';\nimport { Image } from 'react-konva';\n\nimport { IAsset, useAssetElement } from '../../asset';\nimport TransformableAsset from '../../canvas/transformableAsset';\n\ntype Props = {\n\tasset: IAsset;\n\tonUpdate: (asset: IAsset) => void;\n\tselected: boolean;\n\tonSelected: () => void;\n};\nconst Asset: React.SFC<Props> = ({ asset, onUpdate, selected, onSelected }) => {\n\tconst el = useAssetElement(asset);\n\n\tconst xOffset = asset.calibration ? (asset.calibration.xOffset * (asset.transform.width / asset.size.width)) : 0;\n\tconst yOffset = asset.calibration ? (asset.calibration.yOffset * (asset.transform.height / asset.size.height)) : 0;\n\n\treturn (\n\t\t<TransformableAsset\n\t\t\tisSelected={selected}\n\t\t\tonSelected={onSelected}\n\t\t\trectTransform={asset.transform}\n\t\t\tsnapOffset={asset.snapToGrid ? { x: xOffset, y: yOffset } : undefined}\n\t\t\tonTransform={(newRect) => {\n\t\t\t\tonUpdate({\n\t\t\t\t\t...asset,\n\t\t\t\t\ttransform: newRect\n\t\t\t\t})\n\t\t\t}}>\n\t\t\t{el && <Image\n\t\t\t\timage={el}\n\t\t\t\twidth={asset.transform.width}\n\t\t\t\theight={asset.transform.height}\n\t\t\t/>}\n\t\t</TransformableAsset>\n\t);\n}\n\nexport default Asset;","import { IconButtonProps, IconButton, Tooltip } from \"sancho\";\nimport React, { useEffect, MouseEvent } from \"react\";\n\ntype Props = IconButtonProps & { keyboardShortcuts?: string[], onClick?: (e: MouseEvent<HTMLButtonElement> | KeyboardEvent) => void };\nconst ToolbarItem: React.SFC<Props> = ({ label, keyboardShortcuts, ...otherProps }) => {\n\n\tuseEffect(() => {\n\t\tif (keyboardShortcuts && otherProps.onClick) {\n\t\t\tconst onKeyPress = (e: KeyboardEvent) => {\n\t\t\t\tif (keyboardShortcuts!.includes(e.key) &&\n\t\t\t\t\twindow.document.activeElement?.tagName !== 'INPUT') {\n\t\t\t\t\totherProps.onClick!(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.addEventListener('keyup', onKeyPress);\n\t\t\treturn () => window.removeEventListener('keyup', onKeyPress);\n\t\t}\n\t}, [keyboardShortcuts, otherProps.onClick])\n\n\treturn (\n\t\t<Tooltip content={label + (keyboardShortcuts && keyboardShortcuts.length ? ` (${keyboardShortcuts[0]})` : '')} placement=\"bottom\">\n\t\t\t<IconButton\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel={label}\n\t\t\t\t{...otherProps}\n\t\t\t/>\n\t\t</Tooltip>\n\t)\n}\nexport default ToolbarItem;","import React from \"react\";\nimport { css } from \"emotion\";\nimport { useTheme } from \"sancho\";\n\nconst Toolbar: React.SFC = ({ children }) => {\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 0; left: 0; right: 0;\n\t\t\t\tmin-height: 40px;\n\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\tbox-shadow: ${theme.shadows.md};\n\t\t\t\tz-index: 100;\n\t\t\t\t> span {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t}\n\t\t\t`}\n\t\t>\n\t\t\t{children}\n\t\t</div>\n\t);\n}\nexport default Toolbar;","import React, { useEffect, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { singletonHook } from 'react-singleton-hook';\nimport { DarkMode } from 'sancho';\nimport Toolbar from './toolbar';\n\nconst useToolbarPortal = singletonHook([undefined, () => { }], () => useState<HTMLElement | undefined>(undefined));\n\nconst ToolbarPortal: React.SFC = ({ children }) => {\n\tconst [portal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tif (portal) {\n\t\t\tReactDOM.render(<DarkMode>{children}</DarkMode>, portal);\n\t\t}\n\t}, [children, portal])\n\n\tuseEffect(() => {\n\t\tif (portal) {\n\t\t\treturn () => { ReactDOM.unmountComponentAtNode(portal) };\n\t\t}\n\t}, [portal])\n\n\treturn null;\n}\nexport default ToolbarPortal;\n\nexport const ToolbarPortalProvider: React.SFC = ({ children }) => {\n\tconst node = useRef<HTMLSpanElement>();\n\tconst [, setPortal] = useToolbarPortal()!;\n\n\tuseEffect(() => {\n\t\tsetPortal(node.current);\n\t}, [node, setPortal]);\n\n\treturn (\n\t\t<>\n\t\t\t<Toolbar>\n\t\t\t\t<span ref={node as any} />\n\t\t\t</Toolbar>\n\t\t\t{children}\n\t\t</>\n\t)\n}","import React, { useState, useEffect } from 'react';\nimport { IAssetCalibration } from '../../asset';\nimport { InputGroup, Input, useTheme, IconButton, IconLock, IconUnlock } from 'sancho';\nimport { css } from \"emotion\";\n\nconst AdvancedAssetSizer: React.SFC<{ calibration: IAssetCalibration; onUpdate: (calibration: IAssetCalibration) => void; }> = ({ calibration, onUpdate }) => {\n  const theme = useTheme();\n  const formItemMargin = css`margin: 0 ${theme.spaces.sm};`;\n\n  function updateCalibrationValue(keys: Array<keyof IAssetCalibration>, e: React.ChangeEvent<HTMLInputElement>) {\n    const value = Number(e.target.value);\n    if (!isNaN(value)) {\n      const newCal = { ...calibration! };\n      for (const key of keys) {\n        newCal[key] = value;\n      }\n      onUpdate(newCal)\n    }\n  }\n\n  const [ppiLocked, setPPILocked] = useState(calibration.ppiX === calibration.ppiY);\n  useEffect(() => {\n    if (ppiLocked && calibration.ppiX !== calibration.ppiY) {\n      setPPILocked(false);\n    }\n  }, [calibration, onUpdate, ppiLocked])\n\n  return (\n    <>\n      <InputGroup label=\"Pixels per Inch\">\n        <div\n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"Horizontal PPI\"\n            value={calibration.ppiX}\n            onChange={(e) => updateCalibrationValue((ppiLocked ? ['ppiX', 'ppiY'] : ['ppiX']), e)}\n          />\n          <div className={formItemMargin}>\n            <IconButton\n              variant=\"ghost\"\n              label={ppiLocked ? 'Unlock PPI' : 'Lock PPI'}\n              icon={ppiLocked ? <IconLock /> : <IconUnlock />}\n              onClick={() => {\n                if (calibration.ppiX !== calibration.ppiY) {\n                  onUpdate({\n                    ...calibration,\n                    ppiY: calibration.ppiX\n                  })\n                }\n                setPPILocked(!ppiLocked)\n              }}\n            />\n          </div>\n          <Input\n            type=\"number\"\n            min={1}\n            placeholder=\"Vertical PPI\"\n            value={ppiLocked ? calibration.ppiX : calibration.ppiY}\n            disabled={ppiLocked}\n            onChange={(e) => updateCalibrationValue(['ppiY'], e)}\n          />\n        </div>\n      </InputGroup>\n      <InputGroup label=\"Offset\">\n        <div\n          className={css`\n            display: flex; \n            align-items: center;\n          `}\n        >\n          <Input\n            type=\"number\"\n            placeholder=\"Horizontal Offset\"\n            value={calibration.xOffset}\n            onChange={(e) => updateCalibrationValue(['xOffset'], e)}\n          />\n          <div className={formItemMargin}>x</div>\n          <Input\n            type=\"number\"\n            placeholder=\"Vertical Offset\"\n            value={calibration.yOffset}\n            onChange={(e) => updateCalibrationValue(['yOffset'], e)}\n          />\n        </div>\n      </InputGroup>\n    </>\n  );\n};\n\nexport default AdvancedAssetSizer;","import React, { useRef, useState } from 'react';\nimport useComponentSize from '@rehooks/component-size';\nimport { css } from 'emotion';\nimport Konva from 'konva';\nimport { Stage } from 'react-konva';\nimport { useTheme } from 'sancho';\n\nconst ZOOM_SPEED = 1 / 250;\nconst PAN_SPEED = 1 / 1;\n\nKonva.dragButtons = [0];\n\ntype Props = { initialZoom?: number, className?: string };\nconst DraggableStage: React.SFC<Props> = ({ initialZoom = 1, className, children }) => {\n\tconst theme = useTheme();\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst containerSize = useComponentSize(containerRef);\n\tconst stageRef = useRef<Konva.Stage>();\n\n\tconst [zoom, setZoom] = useState(initialZoom);\n\n\treturn (\n\t\t<div\n\t\t\tref={containerRef}\n\t\t\tclassName={css`\t\t\t\t\n\t\t\t\tbackground-color: ${theme.colors.background.tint2};\n\t\t\t\tbackground-image: linear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1}),\n\t\t\t\tlinear-gradient(45deg, ${theme.colors.background.tint1} 25%, transparent 25%, transparent 75%, ${theme.colors.background.tint1} 75%, ${theme.colors.background.tint1});\n\t\t\t\tbackground-size: 20px 20px;\n\t\t\t\tbackground-position: 0 0, 10px 10px;\n\t\t\t` + (className ? ` ${className}` : '')}\n\t\t>\n\t\t\t<Stage\n\t\t\t\tref={stageRef as any}\n\t\t\t\twidth={containerSize.width}\n\t\t\t\theight={containerSize.height}\n\t\t\t\tscale={{ x: zoom, y: zoom }}\n\t\t\t\tonWheel={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\n\t\t\t\t\tlet deltaX = -e.evt.deltaX;\n\t\t\t\t\tlet deltaY = -e.evt.deltaY;\n\t\t\t\t\tlet deltaZ = 0;\n\n\t\t\t\t\tif (e.evt.ctrlKey) {\n\t\t\t\t\t\tdeltaZ = deltaY;\n\t\t\t\t\t\tdeltaY = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst oldZoom = zoom;\n\n\t\t\t\t\tconst stage = stageRef.current!;\n\t\t\t\t\tconst pointerPosition = stage.getPointerPosition();\n\n\t\t\t\t\tif (!pointerPosition) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst mousePointTo = {\n\t\t\t\t\t\tx: (pointerPosition.x - stage.x()) / oldZoom,\n\t\t\t\t\t\ty: (pointerPosition.y - stage.y()) / oldZoom,\n\t\t\t\t\t};\n\n\t\t\t\t\tif (deltaX === 0 && deltaY === 0 && deltaZ === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst zoomSpeed = 1 + (Math.abs(deltaZ) * ZOOM_SPEED);\n\t\t\t\t\tconst newZoom = deltaZ < 0 ? oldZoom / zoomSpeed : oldZoom * zoomSpeed;\n\t\t\t\t\tsetZoom(newZoom);\n\n\t\t\t\t\tvar newPos = {\n\t\t\t\t\t\t// x: (pointerPosition.x - mousePointTo.x + (deltaX * PAN_SPEED)) * newZoom,\n\t\t\t\t\t\t// y: (pointerPosition.y - mousePointTo.y + (deltaY * PAN_SPEED)) * newZoom,\n\t\t\t\t\t\tx: pointerPosition.x - mousePointTo.x * newZoom + deltaX * PAN_SPEED,\n\t\t\t\t\t\ty: pointerPosition.y - mousePointTo.y * newZoom + deltaY * PAN_SPEED,\n\t\t\t\t\t};\n\t\t\t\t\tstage.position(newPos);\n\t\t\t\t\tstage.batchDraw();\n\t\t\t\t}}\n\t\t\t\tonContextMenu={(e) => {\n\t\t\t\t\te.evt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</Stage>\n\t\t</div>\n\t);\n}\nexport default DraggableStage;","import { singletonHook } from 'react-singleton-hook';\nimport { useTheme } from 'sancho';\nimport { useState } from 'react';\n\nexport const SIDEBAR_WIDTH = 48;\nexport const SCENE_LIST_WIDTH = 240;\nexport const HEADER_HEIGHT = 56;\nexport const VISUAL_ASSET_SIZER_SIZE = 650;\n\nexport const useSceneSidebarOpen = singletonHook([true, () => { }], () => useState<boolean>(true));\nexport function useExtendedTheme() {\n  const theme = useTheme();\n  const [sceneSidebarOpen] = useSceneSidebarOpen();\n\n  return {\n    ...theme,\n    headerHeight: HEADER_HEIGHT,\n    sceneListWidth: sceneSidebarOpen ? SCENE_LIST_WIDTH : 0,\n    sidebarWidth: SIDEBAR_WIDTH,\n    visualAssetSizerSize: VISUAL_ASSET_SIZER_SIZE\n  }\n}","import React from 'react';\nimport { Layer, Rect } from 'react-konva';\nimport { css } from 'emotion';\n\nimport { IAssetCalibration, IAsset } from '../../asset';\nimport DraggableStage from '../../canvas/draggableStage';\nimport Asset from './asset';\nimport { useExtendedTheme } from '../../../theme';\nimport { useTablePPI } from '../../../settings';\nimport TransformableAsset from '../../canvas/transformableAsset';\nimport { IRect } from 'konva/types/types';\n\nconst RESIZE_SQUARES = 3;\n\nconst VisualAssetSizer: React.SFC<{ asset: IAsset; onUpdate: (calibration: IAssetCalibration) => void; }> = ({ asset, onUpdate }) => {\n  const theme = useExtendedTheme();\n  const tablePPI = useTablePPI();\n\n  if (!tablePPI || !asset.calibration) {\n    return null;\n  }\n\n  const innerRectangles = Array<IRect>();\n  for (let i = 1; i < RESIZE_SQUARES; i += 2) {\n    innerRectangles.push({\n      width: asset.calibration.ppiX * RESIZE_SQUARES,\n      height: asset.calibration.ppiY * 1,\n      x: 0,\n      y: asset.calibration.ppiY * i\n    })\n    innerRectangles.push({\n      width: asset.calibration.ppiX * 1,\n      height: asset.calibration.ppiY * RESIZE_SQUARES,\n      x: asset.calibration.ppiX * i,\n      y: 0\n    })\n  }\n\n  return (\n    <DraggableStage\n      className={css`\n        width: ${theme.visualAssetSizerSize}px;\n\t\t\t\theight: ${theme.visualAssetSizerSize}px;\n        margin-left: -${theme.spaces.lg};\n      `}\n      initialZoom={(theme.visualAssetSizerSize / asset.size.width)}\n    >\n      <Layer>\n        <Asset\n          asset={{\n            ...asset,\n            transform: {\n              ...asset.size,\n              rotation: 0,\n              x: 0,\n              y: 0\n            }\n          }}\n          onSelected={() => { }}\n          selected={false}\n          onUpdate={() => { }}\n        />\n      </Layer>\n      <Layer>\n        <TransformableAsset\n          rectTransform={{\n            width: asset.calibration.ppiX * RESIZE_SQUARES,\n            height: asset.calibration.ppiY * RESIZE_SQUARES,\n            x: asset.calibration.xOffset,\n            y: asset.calibration.yOffset,\n            rotation: 0\n          }}\n          rotateEnabled={false}\n          strokeEnabled={false}\n          isSelected={true}\n          onSelected={() => { }}\n          onTransform={(transform) => {\n            onUpdate({\n              ppiX: Math.round(transform.width / RESIZE_SQUARES * 100) / 100,\n              ppiY: Math.round(transform.height / RESIZE_SQUARES * 100) / 100,\n              xOffset: Math.round(transform.x * 100) / 100,\n              yOffset: Math.round(transform.y * 100) / 100\n            })\n          }}\n        >\n          {/* Outside rect */}\n          <Rect\n            x={0}\n            y={0}\n            width={asset.calibration.ppiX * RESIZE_SQUARES}\n            height={asset.calibration.ppiY * RESIZE_SQUARES}\n            strokeWidth={1}\n            stroke={theme.colors.palette.blue.base}\n            strokeScaleEnabled={false}\n          />\n          {innerRectangles.map((rect, i) => (\n            <Rect\n              key={i}\n              {...rect}\n              strokeWidth={1}\n              stroke={theme.colors.palette.blue.base}\n              strokeScaleEnabled={false}\n            />\n          ))}\n        </TransformableAsset>\n      </Layer>\n    </DraggableStage>\n  );\n};\n\nexport default VisualAssetSizer;","import React, { useState, useEffect } from 'react';\nimport { IAsset, IAssetCalibration } from '../../asset';\nimport { IconSliders, Dialog, useTheme, Button } from 'sancho';\nimport { css } from \"emotion\";\n\nimport ToolbarItem from '../toolbarItem';\nimport AdvancedAssetSizer from './advancedAssetSizer';\nimport { AssetTransform } from '../../canvas/transformableAsset';\nimport VisualAssetSizer from './visualAssetSizer';\n\nexport function calculateCalibratedTransform(asset: IAsset, screenPPI: number): AssetTransform {\n  if (!asset.calibration) {\n    return asset.transform;\n  }\n\n  return {\n    ...asset.transform,\n    width: (asset.size.width / asset.calibration.ppiX) * screenPPI,\n    height: (asset.size.height / asset.calibration.ppiY) * screenPPI\n  }\n}\n\ntype Props = {\n  asset?: IAsset,\n  onUpdate: (asset: IAsset) => void\n};\n\nconst AssetSizer: React.SFC<Props> = ({ asset, onUpdate }) => {\n  const theme = useTheme();\n  const [showModal, setShowModal] = useState(false);\n  const [calibration, setCalibration] = useState<IAssetCalibration>();\n\n  useEffect(() => {\n    if (asset) {\n      setCalibration(asset.calibration || {\n        ppiX: 150,\n        ppiY: 150,\n        xOffset: 0,\n        yOffset: 0\n      });\n    }\n  }, [asset])\n\n  return (\n    <>\n      <ToolbarItem\n        label=\"Calibrate Size\"\n        icon={<IconSliders />}\n        onClick={() => setShowModal(true)}\n        disabled={!asset}\n      />\n      {calibration && asset &&\n        <Dialog\n          isOpen={showModal}\n          onRequestClose={() => setShowModal(false)}\n          title=\"Asset Calibration\"\n        >\n          <div className={css`padding: ${theme.spaces.lg};`}>\n            <VisualAssetSizer asset={{ ...asset, calibration }} onUpdate={setCalibration} />\n            <AdvancedAssetSizer calibration={calibration} onUpdate={setCalibration} />\n\n            <div\n              className={css`\n                display: flex;\n                margin-top: ${theme.spaces.lg};\n                justify-content: flex-end;\n              `}\n            >\n              <Button variant=\"ghost\" intent=\"primary\" onClick={() => {\n                onUpdate({ ...asset, calibration })\n                setShowModal(false);\n              }}>Save</Button>\n            </div>\n          </div>\n        </Dialog>\n      }\n    </>\n  )\n}\nexport default AssetSizer;","import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { Layer } from \"react-konva\";\nimport AssetComponent from './asset';\nimport { IAsset, AssetType, deleteAsset, getNewAssets } from '../../asset';\nimport { ILayer, ILayerComponentProps } from '..';\nimport Konva from 'konva';\nimport { IconFilePlus, IconTrash2, IconRotateCcw, Check } from 'sancho';\nimport ToolbarItem from '../toolbarItem';\nimport ToolbarPortal from '../toolbarPortal';\nimport AssetSizer, { calculateCalibratedTransform } from './assetSizer';\nimport { css } from 'emotion';\nimport { useTablePPI } from '../../../settings';\n\nexport interface IAssetLayer extends ILayer {\n\tassets: Map<string, IAsset>\n}\n\ninterface Props extends ILayerComponentProps<IAssetLayer> { }\nconst AssetLayer: React.SFC<Props> = ({ layer, onUpdate, active: layerActive, isTable }) => {\n\tconst [selectedAssetId, setSelectedAssetId] = useState<string | null>(null);\n\tconst layerRef = useRef<Konva.Layer>();\n\tconst tablePPI = useTablePPI();\n\n\tconst deleteSelectedAsset = useCallback(async () => {\n\t\tif (selectedAssetId && layer.assets.has(selectedAssetId)) {\n\t\t\tconst asset = layer.assets.get(selectedAssetId)!;\n\t\t\tlayer.assets.delete(selectedAssetId);\n\t\t\tawait deleteAsset(asset);\n\t\t\tonUpdate({ ...layer });\n\t\t\tsetSelectedAssetId(null);\n\t\t}\n\t}, [selectedAssetId, layer, onUpdate, setSelectedAssetId])\n\n\t// Animate the layer if there are any video assets\n\tuseEffect(() => {\n\t\tif (!layerRef.current) return;\n\t\tif (!Array.from(layer.assets.values()).some((asset) => asset.type === AssetType.VIDEO)) return;\n\n\t\tlet previousUpdate = Date.now();\n\t\tconst anim = new Konva.Animation(() => {\n\t\t\tconst now = Date.now();\n\t\t\t// 10 FPS cap on DM display\n\t\t\tif (!isTable && now - previousUpdate < 100) return false;\n\t\t\telse previousUpdate = now;\n\t\t}, layerRef.current);\n\t\tanim.start();\n\t\treturn () => { anim.stop() }\n\t}, [layerRef, layer, isTable])\n\n\tuseEffect(() => {\n\t\tif (!layerRef.current?.parent) return;\n\t\tconst parent = layerRef.current.parent;\n\n\t\tfunction onParentClick() {\n\t\t\tsetSelectedAssetId(null);\n\t\t}\n\t\tparent.on('click.konva', onParentClick);\n\t\treturn () => { parent.off('click.konva', onParentClick) }\n\t}, [layerRef, setSelectedAssetId])\n\n\t// Reset selected asset when active layer changes\n\tuseEffect(() => {\n\t\tif (!layerActive && selectedAssetId !== null) {\n\t\t\tsetSelectedAssetId(null);\n\t\t}\n\t}, [layerActive, selectedAssetId])\n\n\tconst toolbar = useMemo(() => {\n\t\tconst selectedAsset = Array.from(layer.assets.values()).find((a) => a.id === selectedAssetId);\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconFilePlus />}\n\t\t\t\t\tlabel=\"Add Asset\"\n\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\tconst assets = await getNewAssets();\n\t\t\t\t\t\tfor (const asset of assets) {\n\t\t\t\t\t\t\tlayer.assets.set(asset.id, asset);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonUpdate({ ...layer })\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<AssetSizer\n\t\t\t\t\tasset={selectedAsset}\n\t\t\t\t\tonUpdate={(asset) => {\n\t\t\t\t\t\tlayer.assets.set(asset.id, asset);\n\t\t\t\t\t\tonUpdate({ ...layer });\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconRotateCcw />}\n\t\t\t\t\tlabel=\"Reset Asset Size\"\n\t\t\t\t\tdisabled={!selectedAsset || !selectedAsset.calibration || !tablePPI}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tselectedAsset!.transform = calculateCalibratedTransform(selectedAsset!, tablePPI!);\n\t\t\t\t\t\tlayer.assets.set(selectedAsset!.id, selectedAsset!);\n\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t...layer\n\t\t\t\t\t\t})\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<Check label=\"Snap to Grid\" disabled={!selectedAsset} checked={!!selectedAsset?.snapToGrid} onChange={(e) => {\n\t\t\t\t\tselectedAsset!.snapToGrid = e.target.checked;\n\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t...layer\n\t\t\t\t\t})\n\t\t\t\t}} />\n\t\t\t\t<div className={css`flex-grow: 2;`} />\n\t\t\t\t<ToolbarItem\n\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\tlabel=\"Delete Asset\"\n\t\t\t\t\tdisabled={selectedAssetId === null}\n\t\t\t\t\tonClick={deleteSelectedAsset}\n\t\t\t\t\tkeyboardShortcuts={['Delete', 'Backspace']}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}, [layer, tablePPI, selectedAssetId, onUpdate, deleteSelectedAsset]);\n\n\treturn (\n\t\t<>\n\t\t\t{layerActive && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n\t\t\t<Layer\n\t\t\t\tref={layerRef as any}\n\t\t\t\tlistening={layerActive}\n\t\t\t>\n\t\t\t\t{\n\t\t\t\t\tArray.from(layer.assets.values())\n\t\t\t\t\t\t.map((asset) => {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<AssetComponent\n\t\t\t\t\t\t\t\t\tkey={asset.id}\n\t\t\t\t\t\t\t\t\tasset={asset}\n\t\t\t\t\t\t\t\t\tselected={layerActive && selectedAssetId === asset.id}\n\t\t\t\t\t\t\t\t\tonSelected={() => layerActive && setSelectedAssetId(asset.id)}\n\t\t\t\t\t\t\t\t\tonUpdate={(updatedAsset) => {\n\t\t\t\t\t\t\t\t\t\tlayer.assets.set(updatedAsset.id, updatedAsset);\n\t\t\t\t\t\t\t\t\t\tonUpdate({ ...layer });\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</Layer>\n\t\t</>\n\t);\n}\nexport default AssetLayer;","import React, { useRef, useEffect, useState } from 'react';\nimport { KonvaNodeEvents, Line, Group, Shape } from 'react-konva';\nimport { useTheme } from 'sancho';\nimport Konva from 'konva';\n\nimport { Vector2d } from 'konva/types/types';\nimport { KonvaEventObject } from 'konva/types/Node';\n\nconst Anchor: React.SFC<{\n  firstAnchor: boolean,\n  position: Vector2d,\n  onMove: (position: Vector2d, e: KonvaEventObject<DragEvent>) => void,\n  onMoveEnd: () => void\n}> = ({ firstAnchor, position, onMove, onMoveEnd }) => {\n  const theme = useTheme();\n  return (\n    <Shape\n      x={position.x}\n      y={position.y}\n      draggable={true}\n      sceneFunc={(context, shape) => {\n        // custom scene function for rendering an \"absolute\" radius circle\n        const absoluteScale = shape.getAbsoluteScale();\n        const radius = 7 / absoluteScale.x;\n        context.beginPath();\n        context.ellipse(0, 0, radius, radius, 0, 0, Math.PI * 2, false);\n        context.closePath();\n        context.fillStrokeShape(shape);\n      }}\n      onDragMove={e => {\n        onMove({ x: e.target.x(), y: e.target.y() }, e);\n        e.cancelBubble = true;\n      }}\n      onDragEnd={e => onMoveEnd()}\n      stroke={theme.colors.palette.blue.base}\n      strokeWidth={3}\n      strokeScaleEnabled={false}\n      fill={firstAnchor ? theme.colors.palette.blue.base : undefined}\n    />\n  )\n}\n\nexport enum PolygonType {\n  FOG,\n  FOG_CLEAR\n}\n\nexport interface IPolygon {\n  type: PolygonType,\n  verticies: Array<Vector2d>\n  visibleOnTable: boolean;\n}\n\ninterface Props {\n  polygon: IPolygon\n  onUpdate: (polygon: IPolygon) => void\n\n  adding: boolean\n\n  selectable: boolean\n  selected: boolean\n  onSelected?: () => void\n}\nconst EditablePolygon: React.SFC<Props & Omit<Konva.LineConfig, 'points'> & KonvaNodeEvents> = ({ polygon, onUpdate, adding, selectable, selected, onSelected, ...lineProps }) => {\n  const theme = useTheme();\n  const groupRef = useRef<Konva.Group>();\n\n  const [localVerticies, setLocalVerticies] = useState<Array<Vector2d>>(polygon.verticies);\n\n  useEffect(() => {\n    setLocalVerticies(polygon.verticies);\n  }, [polygon.verticies])\n\n  const groupX = localVerticies.reduce((min, v) => Math.min(min, v.x), Number.MAX_VALUE);\n  const groupY = localVerticies.reduce((min, v) => Math.min(min, v.y), Number.MAX_VALUE);\n\n  const relativeKonvaCoordinates = localVerticies\n    .map((v) => [v.x - groupX, v.y - groupY])\n    .flat();\n\n  useEffect(() => {\n    if (groupRef.current && adding) {\n      const layer = groupRef.current.parent!;\n      const stage = layer.parent! as unknown as Konva.Stage;\n\n      stage.container().style.cursor = 'crosshair'\n      const handleClick = (e: KonvaEventObject<MouseEvent>) => {\n        if (e.evt.button !== 0 || !groupRef.current) return;\n\n        // From https://konvajs.org/docs/sandbox/Relative_Pointer_Position.html\n        var transform = stage.getAbsoluteTransform().copy();\n        transform.invert();\n        var pos = groupRef.current.getStage()!.getPointerPosition()!;\n        var relPos = transform.point(pos);\n\n        polygon.verticies = [...localVerticies, relPos];\n        onUpdate(polygon);\n      }\n\n      stage.on('mouseup.konva', handleClick);\n      return () => {\n        stage.off('mouseup.konva', handleClick);\n        stage.container().style.cursor = 'default';\n      };\n    }\n  }, [groupRef, adding, localVerticies, onUpdate, polygon])\n\n  return (\n    <Group\n      ref={groupRef as any}\n      draggable={selected && !adding}\n      x={groupX}\n      y={groupY}\n      listening={selectable}\n      onMouseUp={e => {\n        if (e.evt.button === 0 && onSelected && selectable) {\n          e.cancelBubble = true;\n          onSelected();\n        }\n      }}\n      onClick={e => {\n        if (e.evt.button === 0 && onSelected && selectable) {\n          e.cancelBubble = true;\n          onSelected();\n        }\n      }}\n      onDragMove={e => {\n        let newX = e.target.x();\n        let newY = e.target.y();\n\n        const offsetX = newX - groupX;\n        const offsetY = newY - groupY;\n\n        setLocalVerticies(localVerticies.map((v) => ({ x: v.x + offsetX, y: v.y + offsetY })));\n      }}\n      onDragEnd={() => {\n        polygon.verticies = localVerticies;\n        onUpdate(polygon);\n      }}\n    >\n      <Line\n        closed={true}\n        {...lineProps}\n        points={relativeKonvaCoordinates}\n      />\n      {selected && (\n        <>\n          <Line\n            closed={true}\n            stroke={theme.colors.palette.blue.base}\n            strokeWidth={3}\n            dash={[4, 4]}\n            strokeScaleEnabled={false}\n            points={relativeKonvaCoordinates}\n          />\n          {localVerticies.map((v, i) => (\n            <Anchor\n              key={i}\n              position={{ x: v.x - groupX, y: v.y - groupY }}\n              onMove={(newPos, e) => {\n                const v2 = { x: newPos.x + groupX, y: newPos.y + groupY };\n                localVerticies[i] = v2;\n\n                const groupX2 = localVerticies.reduce((min, v) => Math.min(min, v.x), Number.MAX_VALUE);\n                const groupY2 = localVerticies.reduce((min, v) => Math.min(min, v.y), Number.MAX_VALUE);\n\n                const newRelative = { x: v2.x - groupX2, y: v2.y - groupY2 };\n                e.target.x(newRelative.x)\n                e.target.y(newRelative.y)\n\n                setLocalVerticies([...localVerticies])\n              }}\n              onMoveEnd={() => {\n                polygon.verticies = localVerticies;\n                onUpdate(polygon);\n              }}\n              firstAnchor={adding && i === 0}\n            />\n          ))}\n        </>\n      )}\n    </Group>\n  );\n};\nexport default EditablePolygon;","import { useState, useEffect } from \"react\";\n\nexport function useKeyPress(targetKey: string) {\n  // State for keeping track of whether key is pressed\n  const [keyPressed, setKeyPressed] = useState(false);\n\n  // Add event listeners\n  useEffect(() => {\n    // If pressed key is our target key then set to true\n    function downHandler({ key }: KeyboardEvent) {\n      if (key === targetKey) {\n        setKeyPressed(true);\n      }\n    }\n\n    // If released key is our target key then set to false\n    const upHandler = ({ key }: KeyboardEvent) => {\n      if (key === targetKey) {\n        setKeyPressed(false);\n      }\n    };\n\n    window.addEventListener('keydown', downHandler);\n    window.addEventListener('keyup', upHandler);\n    // Remove event listeners on cleanup\n    return () => {\n      window.removeEventListener('keydown', downHandler);\n      window.removeEventListener('keyup', upHandler);\n    };\n  }, [setKeyPressed, targetKey]); // Empty array ensures that effect is only run on mount and unmount\n\n  return keyPressed;\n}","import React, { useMemo, useState, useEffect, useRef, useCallback } from 'react';\nimport { Layer } from 'react-konva';\nimport { Vector2d } from 'konva/types/types';\nimport Konva from 'konva';\nimport { IconCloud, IconCloudOff, useTheme, IconTrash2, IconEye, IconEyeOff } from 'sancho';\n\nimport { ILayerComponentProps, ILayer } from '..';\nimport ToolbarPortal from '../toolbarPortal';\nimport ToolbarItem from '../toolbarItem';\nimport EditablePolygon, { IPolygon, PolygonType } from './editablePolygon';\nimport { useTablePPI } from '../../../settings';\nimport { css } from 'emotion';\nimport { useKeyPress } from '../../../utils';\nimport { KonvaEventObject } from 'konva/types/Node';\n\nexport interface ILightSource {\n  position: Vector2d\n}\n\nexport interface IFogLayer extends ILayer {\n  obstructionPolygons: Array<IPolygon>;\n  lightSources: Array<ILightSource>;\n  fogPolygons: Array<IPolygon>;\n  fogClearPolygons: Array<IPolygon>;\n}\n\ninterface Props extends ILayerComponentProps<IFogLayer> { };\nconst FogLayer: React.SFC<Props> = ({ layer, isTable, onUpdate, active }) => {\n  const theme = useTheme();\n  const layerRef = useRef<Konva.Layer>();\n  const tablePPI = useTablePPI();\n\n  const [addingPolygon, setAddingPolygon] = useState<IPolygon | null>(null)\n  const [selectedPolygon, setSelectedPolygon] = useState<IPolygon | null>(null)\n\n  useEffect(() => {\n    if (!active) {\n      console.log('not active');\n      setSelectedPolygon(null);\n      setAddingPolygon(null);\n    }\n  }, [active, setSelectedPolygon, setAddingPolygon])\n\n  useEffect(() => {\n    if (!layerRef.current?.parent || addingPolygon) return;\n    const stage = layerRef.current.parent;\n\n    function onParentClick(e: KonvaEventObject<MouseEvent>) {\n      console.log(e.evt.button)\n      if (e.evt.button === 0) {\n        setSelectedPolygon(null);\n      }\n    }\n    stage.on('click', onParentClick);\n    return () => { stage.off('click', onParentClick) }\n  }, [layerRef, addingPolygon, setSelectedPolygon])\n\n  const toolbar = useMemo(() => {\n    return (\n      <>\n        <ToolbarItem\n          label=\"Add Fog\"\n          icon={<IconCloud />}\n          keyboardShortcuts={['a']}\n          onClick={() => {\n            const poly = {\n              verticies: [],\n              type: PolygonType.FOG,\n              visibleOnTable: true\n            } as IPolygon;\n            layer.fogPolygons.push(poly)\n            setSelectedPolygon(poly);\n            setAddingPolygon(poly);\n            onUpdate(layer);\n          }}\n        />\n        <ToolbarItem\n          label=\"Add Fog Clear\"\n          icon={<IconCloudOff />}\n          keyboardShortcuts={['s']}\n          onClick={() => {\n            const poly = {\n              verticies: [],\n              type: PolygonType.FOG_CLEAR,\n              visibleOnTable: true\n            } as IPolygon;\n            layer.fogClearPolygons.push(poly)\n            setSelectedPolygon(poly);\n            setAddingPolygon(poly);\n            onUpdate(layer);\n          }}\n        />\n        <ToolbarItem\n          label={selectedPolygon && selectedPolygon.visibleOnTable ? 'Hide on Table' : 'Show on Table'}\n          disabled={!selectedPolygon}\n          icon={selectedPolygon && selectedPolygon.visibleOnTable ? <IconEye /> : <IconEyeOff />}\n          keyboardShortcuts={['d']}\n          onClick={() => {\n            if (!selectedPolygon) return;\n            selectedPolygon.visibleOnTable = !selectedPolygon.visibleOnTable;\n            onUpdate({ ...layer })\n          }}\n        />\n        <div className={css`flex-grow: 2;`} />\n        <ToolbarItem\n          icon={<IconTrash2 />}\n          label=\"Delete Asset\"\n          disabled={selectedPolygon === null}\n          onClick={() => {\n            if (!selectedPolygon) return;\n\n            const fogPolygonIndex = layer.fogPolygons.indexOf(selectedPolygon);\n            if (fogPolygonIndex !== -1) {\n              layer.fogPolygons.splice(fogPolygonIndex, 1);\n              layer.fogPolygons = [...layer.fogPolygons];\n            }\n\n            const fogClearPolygonIndex = layer.fogClearPolygons.indexOf(selectedPolygon);\n            if (fogClearPolygonIndex !== -1) {\n              layer.fogClearPolygons.splice(fogClearPolygonIndex, 1);\n              layer.fogClearPolygons = [...layer.fogClearPolygons];\n            }\n\n            onUpdate({ ...layer })\n            setSelectedPolygon(null);\n          }}\n          keyboardShortcuts={['Delete', 'Backspace']}\n        />\n      </>\n    );\n  }, [selectedPolygon, layer, onUpdate]);\n\n  useEffect(() => {\n    if (isTable && layerRef.current && tablePPI) {\n      layerRef.current.canvas._canvas.className = css`\n        filter: blur(${tablePPI / 10}px);\n      `;\n    }\n  }, [layerRef, isTable, tablePPI]);\n\n  const onPolygonAdded = useCallback(() => {\n    console.log('editablePolygon onAdded');\n    if (addingPolygon?.verticies && addingPolygon.verticies.length < 3) {\n      console.log('removing polygon because < 3 verticies');\n      const collection = addingPolygon.type === PolygonType.FOG ? layer.fogPolygons : layer.fogClearPolygons;\n      const i = collection.indexOf(addingPolygon);\n      collection.splice(i, 1);\n    }\n\n    setAddingPolygon(null);\n    setSelectedPolygon(null);\n    onUpdate({ ...layer });\n  }, [setAddingPolygon, layer, onUpdate, addingPolygon])\n\n  const isEscapePressed = useKeyPress('Escape');\n  const isEnterPressed = useKeyPress('Enter');\n  const shouldEndAdd = isEnterPressed || isEscapePressed;\n  useEffect(() => {\n    if (addingPolygon && shouldEndAdd) {\n      onPolygonAdded();\n    }\n  }, [addingPolygon, shouldEndAdd, onPolygonAdded])\n\n  const onPolygonUpdated = useCallback(() => {\n    onUpdate({ ...layer });\n  }, [onUpdate, layer])\n\n  return (\n    <Layer\n      ref={layerRef as any}\n      listening={active}\n      sceneFunc={console.log}\n    >\n      {active && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n\n      {layer.fogPolygons.map((fogPoly, i) => {\n        fogPoly.type = PolygonType.FOG;\n        if (isTable && !fogPoly.visibleOnTable) return null;\n\n        const selected = selectedPolygon === fogPoly;\n        const adding = addingPolygon === fogPoly;\n        return (\n          <EditablePolygon\n            key={`f${i}`}\n            polygon={fogPoly}\n\n            opacity={isTable ? 1 : 0.6}\n            fill={isTable ? 'black' : theme.colors.palette.gray.dark}\n\n            selectable={!addingPolygon}\n            selected={selected}\n            onSelected={() => setSelectedPolygon(fogPoly)}\n\n            adding={adding}\n\n            onUpdate={onPolygonUpdated}\n          />\n        )\n      })}\n\n      {layer.fogClearPolygons?.map((fogPoly, i) => {\n        fogPoly.type = PolygonType.FOG_CLEAR;\n        if (isTable && !fogPoly.visibleOnTable) return null;\n\n        const selected = selectedPolygon === fogPoly;\n        const adding = addingPolygon === fogPoly;\n\n        return (\n          <EditablePolygon\n            key={`cf${i}`}\n            polygon={fogPoly}\n\n            opacity={isTable ? 1 : (fogPoly.visibleOnTable ? 0.3 : 0.6)}\n            fill={isTable ? 'black' : theme.colors.palette.gray.lightest}\n            globalCompositeOperation={isTable ? \"destination-out\" : 'source-over'}\n\n            selectable={!addingPolygon}\n            selected={selected}\n            onSelected={() => setSelectedPolygon(fogPoly)}\n\n            adding={adding}\n\n            onUpdate={onPolygonUpdated}\n          />\n        )\n      })}\n    </Layer>\n  );\n}\nexport default FogLayer;","import AssetLayer, { IAssetLayer } from \"./assetLayer\";\nimport { v4 } from \"uuid\";\nimport { IScene } from \"..\";\nimport { deleteAsset } from \"../asset\";\nimport FogLayer, { IFogLayer } from \"./fogLayer\";\n\nexport enum LayerType {\n\tASSETS,\n\tFOG,\n\tTABLE_VIEW,\n}\n\nexport interface ILayer {\n\tid: string\n\ttype: LayerType\n\tname: string\n\tvisible: boolean\n}\n\nexport interface ILayerComponentProps<T extends ILayer = ILayer> {\n\tlayer: T;\n\tisTable: boolean;\n\tonUpdate: (layer: T) => void;\n\tactive: boolean;\n}\n\nexport const LayerTypeToComponent = {\n\t[LayerType.ASSETS]: AssetLayer,\n\t[LayerType.FOG]: FogLayer\n} as { [type: string]: React.SFC<ILayerComponentProps<any>> }\n\nexport function createNewLayer(type: LayerType) {\n\tconst layer: ILayer = {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\ttype: type,\n\t\tvisible: true\n\t};\n\tif (type === LayerType.ASSETS) {\n\t\t(layer as IAssetLayer).assets = new Map();\n\t}\n\telse if (type === LayerType.FOG) {\n\t\t(layer as IFogLayer).obstructionPolygons = [];\n\t\t(layer as IFogLayer).lightSources = [];\n\t\t(layer as IFogLayer).fogPolygons = [];\n\t\t(layer as IFogLayer).fogClearPolygons = [];\n\t}\n\treturn layer;\n}\n\nexport async function deleteLayer(scene: IScene, layer: ILayer) {\n\tconst i = scene.layers.indexOf(layer);\n\tif (i === -1) return scene;\n\tif (layer.type === LayerType.ASSETS) {\n\t\tfor (const asset of Array.from((layer as IAssetLayer).assets.values())) {\n\t\t\tawait deleteAsset(asset);\n\t\t}\n\t}\n\tscene.layers.splice(i, 1);\n\treturn scene;\n}\n// delete layer w/ assets","import { v4 } from \"uuid\";\n\nimport useGlobalStorage from \"../storage\";\nimport { ILayer, LayerType, createNewLayer } from \"./layer\";\nimport { Vector2d } from \"konva/types/types\";\n\nexport interface TableOptions {\n\tdisplayGrid: boolean,\n\toffset: Vector2d,\n\trotation: number,\n\tscale: number,\n}\n\nexport interface IScene {\n\tid: string;\n\tname: string;\n\ttable: TableOptions,\n\tlayers: Array<ILayer>;\n}\n\nconst storage = useGlobalStorage<IScene>('scene');\nexport function useSceneDatabase() {\n\treturn storage;\n}\n\nexport function createNewScene(): IScene {\n\tconst defaultLayer = createNewLayer(LayerType.ASSETS);\n\tdefaultLayer.name = 'Layer 1';\n\n\treturn {\n\t\tid: v4(),\n\t\tname: 'Untitled',\n\t\ttable: {\n\t\t\toffset: { x: 0, y: 0 },\n\t\t\trotation: 0,\n\t\t\tscale: 1,\n\t\t\tdisplayGrid: true\n\t\t},\n\t\tlayers: [\n\t\t\tdefaultLayer\n\t\t]\n\t};\n}","import React from 'react';\nimport { IconButton, IconZoomOut, IconZoomIn, Button } from 'sancho';\nimport { css } from 'emotion';\n\nconst ZOOM_RATE = 1.5;\n\ntype Props = { zoom: number, onUpdate: (zoom: number) => void };\nconst ZoomToolbarItem: React.SFC<Props> = ({ zoom, onUpdate }) => {\n\n  let zoomDisplay: string;\n  if (zoom < 1) {\n    zoomDisplay = `1/${+(1 / zoom).toFixed(1)}x`\n  }\n  else {\n    zoomDisplay = `${+zoom.toFixed(1)}x`\n  }\n\n  return (\n    <div\n      className={css`\n        display: flex;\n        align-items: center;\n      `}\n    >\n      <IconButton\n        variant=\"ghost\"\n        icon={<IconZoomOut />}\n        label=\"Zoom Out\"\n        onClick={() => {\n          let newZoom = Math.round(zoom / ZOOM_RATE * 100) / 100;\n          if (newZoom > 0.95 && newZoom < 1.05) newZoom = 1;\n          onUpdate(newZoom)\n        }}\n      />\n      <div\n        className={css`\n          min-width: 2rem;\n          text-align: center;\n        `}\n      >\n        {zoom === 1 ? <b>{zoomDisplay}</b> : zoomDisplay}\n      </div>\n      <IconButton\n        variant=\"ghost\"\n        icon={<IconZoomIn />}\n        label=\"Zoom In\"\n        onClick={() => {\n          let newZoom = Math.round(zoom * ZOOM_RATE * 100) / 100;\n          if (newZoom > 0.95 && newZoom < 1.05) newZoom = 1;\n          onUpdate(newZoom)\n        }}\n      />\n      {zoom !== 1 && (\n        <Button\n          variant=\"ghost\"\n          size=\"xs\"\n          onClick={() => {\n            onUpdate(1);\n          }}\n        >\n          Reset Zoom\n        </Button>\n      )}\n    </div>\n  )\n}\nexport default ZoomToolbarItem;","import React, { useMemo, useRef, useEffect, useState } from 'react';\nimport { useTheme, IconCrosshair, Check } from 'sancho';\nimport Konva from 'konva';\nimport { Layer, Rect, Line, Group, Transformer } from 'react-konva';\nimport { Vector2d } from 'konva/types/types';\n\nimport { useTableResolution, useTablePPI } from '../../../settings';\nimport { TableOptions } from '../..';\nimport { ILayerComponentProps, ILayer, LayerType } from '..';\nimport ToolbarItem from '../toolbarItem';\nimport ToolbarPortal from '../toolbarPortal';\nimport { useKeyPress } from '../../../utils';\nimport ZoomToolbarItem from './zoomToolbarItem';\n\nexport const TableViewLayer = {\n  id: 'TABLE_VIEW',\n  name: 'Table View',\n  type: LayerType.TABLE_VIEW,\n  visible: true\n} as ILayer;\n\nexport interface ITableViewLayer extends ILayer {\n  options: TableOptions\n}\n\ninterface Props extends ILayerComponentProps<ITableViewLayer> {\n  showBorder: boolean;\n  showGrid: boolean;\n}\n\nconst TableViewOverlay: React.SFC<Props> = ({ layer, active, showBorder, showGrid, onUpdate }) => {\n  const theme = useTheme();\n  const [tableResolution] = useTableResolution();\n  const ppi = useTablePPI();\n\n  const [localOptions, setLocalOptions] = useState(layer.options);\n\n  useEffect(() => {\n    setLocalOptions(layer.options);\n  }, [layer.options, setLocalOptions])\n\n  const groupRef = useRef<Konva.Group>();\n  const trRef = useRef<Konva.Transformer>();\n\n  useEffect(() => {\n    if (active) {\n      // we need to attach transformer manually\n      trRef.current?.setNodes([groupRef.current!]);\n      trRef.current?.getLayer()?.batchDraw();\n    }\n  }, [active]);\n\n  const toolbar = useMemo(() => {\n    return (\n      <>\n        <ToolbarItem\n          icon={<IconCrosshair />}\n          label=\"Reset View\"\n          onClick={() => {\n            onUpdate({\n              ...layer,\n              options: {\n                ...layer.options,\n                offset: { x: 0, y: 0 },\n                rotation: 0,\n                scale: 1\n              }\n            })\n          }}\n        />\n        <Check label=\"Display Grid\" checked={layer.options.displayGrid} onChange={(e) => {\n          onUpdate({\n            ...layer,\n            options: {\n              ...layer.options,\n              displayGrid: e.target.checked\n            }\n          })\n        }} />\n        <ZoomToolbarItem\n          zoom={layer.options.scale}\n          onUpdate={(zoom) => {\n            layer.options = {\n              ...layer.options,\n              scale: zoom\n            }\n            onUpdate(layer);\n          }}\n        />\n      </>\n    );\n  }, [layer, onUpdate]);\n\n  const isShiftPressed = useKeyPress('Shift');\n\n\n  // Only recalculate the line components when the position/size changes\n  const lines = useMemo(() => {\n    if (!tableResolution || !ppi) {\n      return null;\n    }\n\n    const width = tableResolution.width / localOptions.scale;\n    const height = tableResolution.height / localOptions.scale;\n\n    const l = new Array<{ start: Vector2d; end: Vector2d; }>();\n    if (showGrid) {\n      const startX = Math.floor(localOptions.offset.x / ppi) * ppi;\n      for (let xOffset = startX; xOffset <= localOptions.offset.x + width; xOffset += ppi) {\n        l.push({\n          start: { x: xOffset, y: localOptions.offset.y },\n          end: { x: xOffset, y: localOptions.offset.y + height }\n        });\n      }\n\n      const startY = Math.floor(localOptions.offset.y / ppi) * ppi;\n      for (let yOffset = startY; yOffset <= localOptions.offset.y + height; yOffset += ppi) {\n        l.push({\n          start: { x: localOptions.offset.x, y: yOffset },\n          end: { x: localOptions.offset.x + width, y: yOffset }\n        });\n      }\n    }\n\n    return (\n      <Group\n        clipFunc={(ctx: CanvasRenderingContext2D) => {\n          ctx.beginPath();\n          ctx.rect(localOptions.offset.x, localOptions.offset.y, width, height);\n          ctx.rotate(localOptions.rotation);\n          ctx.closePath();\n        }}\n      >\n        {l.map((line, i) => (\n          <React.Fragment key={i}>\n            <Line\n              key={`l${i}`}\n              points={[line.start.x, line.start.y, line.end.x, line.end.y]}\n              stroke={theme.colors.palette.gray.light}\n              dash={[1, 1]}\n              strokeWidth={1}\n              strokeScaleEnabled={false}\n            />\n            <Line\n              key={`d${i}`}\n              points={[line.start.x, line.start.y, line.end.x, line.end.y]}\n              stroke={theme.colors.palette.gray.dark}\n              dash={[1, 1]}\n              dashOffset={1}\n              strokeWidth={1}\n              strokeScaleEnabled={false}\n            />\n          </React.Fragment>\n        ))}\n      </Group>\n    );\n  }, [showGrid, localOptions.offset.x, localOptions.offset.y, localOptions.rotation, localOptions.scale, tableResolution, ppi, theme])\n\n  if (!tableResolution || ppi === null) {\n    return null;\n  }\n\n  const width = tableResolution.width;\n  const height = tableResolution.height;\n\n  return (\n    <Layer\n      listening={active}\n    >\n      {active && <ToolbarPortal>{toolbar}</ToolbarPortal>}\n      {lines}\n      {(showBorder || active) ?\n        <>\n          <Group\n            ref={groupRef as any}\n            draggable={active}\n            x={localOptions.offset.x}\n            y={localOptions.offset.y}\n            width={width}\n            height={height}\n            scaleX={1 / localOptions.scale}\n            scaleY={1 / localOptions.scale}\n            rotation={localOptions.rotation}\n            onMouseDown={e => {\n              if (!(e.evt.buttons === 1 && !isShiftPressed)) { // only allow left click, when shift isn't pressed\n                groupRef.current?.setDraggable(false)\n              }\n              else {\n                groupRef.current?.setDraggable(active)\n              }\n            }}\n            onMouseUp={() => {\n              groupRef.current?.setDraggable(active) // reset the draggable\n            }}\n            onDragMove={e => {\n              const node = groupRef.current!;\n              const rotation = node.rotation();\n              setLocalOptions({\n                offset: {\n                  x: e.target.x(),\n                  y: e.target.y(),\n                },\n                rotation,\n                displayGrid: localOptions.displayGrid,\n                scale: localOptions.scale\n              });\n            }}\n            onDragEnd={() => {\n              layer.options = { ...localOptions };\n              onUpdate(layer)\n            }}\n            onTransform={() => {\n              const node = groupRef.current!;\n              const scale = 1 / node.scaleX();\n              setLocalOptions({\n                ...localOptions,\n                offset: {\n                  x: node.x(),\n                  y: node.y(),\n                },\n                scale\n              });\n            }}\n            onTransformEnd={() => {\n              layer.options = { ...localOptions };\n              onUpdate(layer);\n            }}\n          >\n            <Rect\n              width={width}\n              height={height}\n              stroke={active ? theme.colors.palette.blue.base : theme.colors.palette.gray.light}\n              dash={[10, 10]}\n              strokeWidth={5}\n              listening={active}\n            />\n          </Group>\n          {active && (\n            <Transformer\n              rotateEnabled={false}\n              resizeEnabled={true}\n              enabledAnchors={['top-left', 'top-right', 'bottom-left', 'bottom-right']}\n              ref={trRef as any}\n              borderStrokeWidth={0}\n              anchorFill={theme.colors.background.overlay}\n              anchorStroke={theme.colors.palette.blue.light}\n            />\n          )}\n        </>\n        : null\n      }\n    </Layer>\n  );\n};\n\nexport default TableViewOverlay;","import { ILayer } from \"../layer\";\nimport { useTheme, IconButton, IconEdit2, Dialog, Button, InputGroup, Input } from \"sancho\";\nimport React, { useState, useEffect } from \"react\";\nimport { css } from \"emotion\";\nimport { TableViewLayer } from \"../layer/tableView\";\n\ntype Props = { layer?: ILayer; onUpdate: (layer: ILayer) => void; };\nconst EditLayerButton: React.SFC<Props> = ({ layer, onUpdate }) => {\n  const theme = useTheme();\n  const [showModal, setShowModal] = useState(false);\n  const [name, setName] = useState(layer?.name);\n\n  useEffect(() => {\n    if (layer) {\n      setName(layer.name);\n    }\n  }, [layer, showModal]);\n\n  return (\n    <>\n      <IconButton\n        variant=\"ghost\"\n        disabled={!layer || layer.id === TableViewLayer.id}\n        icon={<IconEdit2 />}\n        label=\"Edit\"\n        onClick={() => setShowModal(true)} />\n      {layer && <Dialog\n        isOpen={showModal}\n        onRequestClose={() => setShowModal(false)}\n        title=\"Edit Layer\"\n      >\n        <div className={css`padding: ${theme.spaces.lg};`}>\n          <InputGroup label=\"Name\">\n            <Input\n              placeholder=\"Name\"\n              value={name}\n              onChange={(e) => setName(e.target.value)} />\n          </InputGroup>\n          <div\n            className={css`\n                display: flex;\n                margin-top: ${theme.spaces.lg};\n                justify-content: flex-end;\n              `}\n          >\n            <Button variant=\"ghost\" intent=\"primary\" onClick={() => {\n              if (name) {\n                onUpdate({ ...layer, name });\n              }\n              setShowModal(false);\n            }}>Save</Button>\n          </div>\n        </div>\n      </Dialog>}\n    </>\n  );\n};\nexport default EditLayerButton;","import { IScene } from \"..\";\nimport { LayerType, ILayer } from \"../layer\";\nimport { useTheme, Layer, List, ListItem, IconButton, IconTrash2, Popover, MenuList, MenuItem, IconFile, IconCloudDrizzle, IconPlus, Text, IconArrowUp, IconArrowDown, IconEye, IconEyeOff, IconTv } from \"sancho\";\nimport React from \"react\";\nimport { css } from \"emotion\";\nimport { TableViewLayer } from \"../layer/tableView\";\nimport EditLayerButton from \"./editLayerButton\";\n\ntype Props = {\n\tscene: IScene,\n\tactiveLayerId: string | null,\n\tsetActiveLayer: (layer: string) => void,\n\tupdateLayer: (layer: ILayer) => void,\n\taddLayer: (type: LayerType) => void,\n\teditActiveLayerName: (name: string) => void, // TODO\n\tmoveActiveLayer: (direction: \"up\" | \"down\") => void;\n\tdeleteActiveLayer: () => void\n};\nconst LayerList: React.SFC<Props> = ({ scene, activeLayerId, setActiveLayer, updateLayer, addLayer, moveActiveLayer, deleteActiveLayer }) => {\n\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayerId);\n\tconst isActiveLayerTop = layerIndex === scene.layers.length - 1;\n\tconst isActiveLayerBottom = layerIndex === 0;\n\tconst activeLayer = scene.layers.find((l) => l.id === activeLayerId);\n\n\tconst theme = useTheme();\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tposition: absolute;\n\t\t\t\tright: ${theme.spaces.md};\n\t\t\t\tbottom: ${theme.spaces.md};\n\t\t\t`}\n\t\t>\n\t\t\t<Layer\n\t\t\t\tclassName={css`\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twidth: 300px;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<List\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tmax-height: 350px;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<ListItem\n\t\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\t\tbackground-color: ${activeLayerId === TableViewLayer.id ? theme.colors.intent.primary.base : 'initial'} !important;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\tcontentBefore={\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tlabel={'Table View'}\n\t\t\t\t\t\t\t\ticon={<IconTv />}\n\t\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprimary={'Table View'}\n\t\t\t\t\t\tcontentAfter={' '}\n\t\t\t\t\t\tonClick={() => setActiveLayer(TableViewLayer.id)}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{Array.from(scene.layers).reverse().map((layer) => (\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\t\tbackground-color: ${activeLayer === layer ? theme.colors.intent.primary.base : 'initial'} !important;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\tcontentBefore={\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tlabel={layer.visible ? 'Hide Layer' : 'Show Layer'}\n\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\tupdateLayer({ ...layer, visible: !layer.visible })\n\t\t\t\t\t\t\t\t\t\te.preventDefault(); // prevent passing through to the list item\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ticon={layer.visible ? <IconEye /> : <IconEyeOff />}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprimary={layer.name}\n\t\t\t\t\t\t\tcontentAfter={<Text variant=\"subtitle\">{LayerType[layer.type]}</Text>}\n\t\t\t\t\t\t\tonClick={() => setActiveLayer(layer.id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</List>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\t\tbackground-color: ${theme.colors.background.tint1};\n\t\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{/* Delete Layer */}\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tdisabled={!activeLayer || activeLayerId === TableViewLayer.id}\n\t\t\t\t\t\tcolor={theme.colors.intent.danger.base}\n\t\t\t\t\t\ticon={<IconTrash2 />}\n\t\t\t\t\t\tlabel=\"Delete Layer\"\n\t\t\t\t\t\tonClick={deleteActiveLayer}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div>\n\n\n\t\t\t\t\t\t{/* Move Layer Up */}\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayerId === null || activeLayerId === TableViewLayer.id || isActiveLayerTop}\n\t\t\t\t\t\t\ticon={<IconArrowUp />}\n\t\t\t\t\t\t\tlabel=\"Layer Up\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('up')}\n\t\t\t\t\t\t/>\n\n\n\t\t\t\t\t\t{/* Move Layer Down */}\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tdisabled={activeLayerId === null || activeLayerId === TableViewLayer.id || isActiveLayerBottom}\n\t\t\t\t\t\t\ticon={<IconArrowDown />}\n\t\t\t\t\t\t\tlabel=\"Layer Down\"\n\t\t\t\t\t\t\tonClick={() => moveActiveLayer('down')}\n\t\t\t\t\t\t/>\n\n\n\t\t\t\t\t\t<EditLayerButton\n\t\t\t\t\t\t\tlayer={activeLayer}\n\t\t\t\t\t\t\tonUpdate={updateLayer}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Add Layer Button */}\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tplacement=\"top-end\"\n\t\t\t\t\t\tcontent={\n\t\t\t\t\t\t\t<MenuList>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconFile />} onPress={() => addLayer(LayerType.ASSETS)}>Asset Layer</MenuItem>\n\t\t\t\t\t\t\t\t<MenuItem contentBefore={<IconCloudDrizzle />} onPress={() => addLayer(LayerType.FOG)}>Fog Layer (beta)</MenuItem>\n\t\t\t\t\t\t\t</MenuList>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<IconButton variant=\"ghost\" icon={<IconPlus />} label=\"Add Layer\" />\n\t\t\t\t\t</Popover>\n\t\t\t\t</div>\n\t\t\t</Layer>\n\t\t</div>\n\t);\n}\nexport default LayerList;","import React, { useState, useEffect, useCallback } from 'react';\nimport { css } from 'emotion';\n\nimport { IScene } from '..';\nimport DraggableStage from './draggableStage';\nimport { LayerTypeToComponent, LayerType, ILayer, createNewLayer } from '../layer';\nimport { deleteLayer } from '../layer';\nimport LayerList from './layerList';\nimport { ToolbarPortalProvider } from '../layer/toolbarPortal';\nimport TableViewOverlay, { TableViewLayer } from '../layer/tableView';\nimport { useExtendedTheme } from '../../theme';\n\ntype Props = { scene: IScene, onUpdate: (scene: IScene) => void };\nconst Canvas: React.SFC<Props> = ({ scene, onUpdate }) => {\n\tconst theme = useExtendedTheme();\n\tconst [activeLayerId, setActiveLayerId] = useState<string | null>(null);\n\n\t// Default selected layer to the first layer\n\tuseEffect(() => {\n\t\tif (activeLayerId === TableViewLayer.id) return;\n\n\t\tif (\n\t\t\t(activeLayerId === null || !scene.layers.some((l) => l.id === activeLayerId)) &&\n\t\t\tscene.layers.length\n\t\t) {\n\t\t\tsetActiveLayerId(scene.layers[0].id);\n\t\t}\n\t}, [activeLayerId, scene])\n\n\tconst onLayerUpdate = useCallback((updatedLayer: ILayer) => {\n\t\tconst i = scene.layers.findIndex((l) => l.id === updatedLayer.id);\n\t\tscene.layers[i] = updatedLayer;\n\t\tonUpdate({ ...scene })\n\t}, [scene, onUpdate]);\n\n\tfunction addLayer(type: LayerType) {\n\t\tconst layer = createNewLayer(type);\n\t\tlayer.name = 'Layer ' + (scene.layers.length + 1);\n\t\tscene.layers.push(layer);\n\t\tonUpdate({ ...scene });\n\t}\n\n\tfunction updateLayer(layer: ILayer) {\n\t\tconst index = scene.layers.findIndex((l) => l.id === layer.id);\n\t\tscene.layers[index] = layer;\n\t\tonUpdate({\n\t\t\t...scene,\n\t\t\tlayers: [...scene.layers]\n\t\t});\n\t}\n\n\tfunction editActiveLayerName(name: string) {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayerId);\n\t\tif (!layer) return;\n\n\t\tlayer.name = name;\n\t\tonUpdate({\n\t\t\t...scene,\n\t\t\tlayers: [...scene.layers]\n\t\t});\n\t}\n\n\tfunction moveActiveLayer(direction: 'up' | 'down') {\n\t\tconst layerIndex = scene.layers.findIndex((l) => l.id === activeLayerId);\n\t\tif (layerIndex !== -1) {\n\t\t\tconst swapIndex = direction === 'up' ? layerIndex + 1 : layerIndex - 1;\n\t\t\tif (swapIndex > scene.layers.length - 1 || swapIndex < 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentLayer = scene.layers[layerIndex];\n\t\t\tconst layerToSwap = scene.layers[swapIndex];\n\n\t\t\tscene.layers[swapIndex] = currentLayer;\n\t\t\tscene.layers[layerIndex] = layerToSwap;\n\n\t\t\tonUpdate({\n\t\t\t\t...scene,\n\t\t\t\tlayers: [...scene.layers]\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function deleteActiveLayer() {\n\t\tconst layer = scene.layers.find((l) => l.id === activeLayerId);\n\t\tif (layer) {\n\t\t\tconst newScene = await deleteLayer(scene, layer);\n\t\t\tonUpdate({\n\t\t\t\t...newScene,\n\t\t\t\tlayers: [...newScene.layers]\n\t\t\t});\n\t\t\tsetActiveLayerId(null);\n\t\t}\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ToolbarPortalProvider>\n\t\t\t\t{/* Canvas */}\n\t\t\t\t<DraggableStage\n\t\t\t\t\tclassName={css`\n\t\t\t\t\tflex-grow: 2;\n\t\t\t\t\twidth: calc(100vw - ${theme.sceneListWidth + theme.sidebarWidth}px);\n\t\t\t\t\theight: calc(100vh - ${theme.headerHeight}px);\n\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{\n\t\t\t\t\t\tscene.layers.map((layer) => {\n\t\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\t\tif (!Component || layer.visible === false) return null;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\t\tisTable={false}\n\t\t\t\t\t\t\t\t\tonUpdate={onLayerUpdate}\n\t\t\t\t\t\t\t\t\tactive={activeLayerId === layer.id}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\t<TableViewOverlay\n\t\t\t\t\t\tlayer={{\n\t\t\t\t\t\t\t...TableViewLayer,\n\t\t\t\t\t\t\toptions: scene.table\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tisTable={false}\n\t\t\t\t\t\tactive={activeLayerId === TableViewLayer.id}\n\t\t\t\t\t\tonUpdate={(layer) => {\n\t\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t\t...scene,\n\t\t\t\t\t\t\t\ttable: layer.options\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tshowBorder={true}\n\t\t\t\t\t\tshowGrid={true}\n\t\t\t\t\t/>\n\t\t\t\t</DraggableStage>\n\t\t\t</ToolbarPortalProvider>\n\n\t\t\t<LayerList\n\t\t\t\tscene={scene}\n\t\t\t\tactiveLayerId={activeLayerId}\n\t\t\t\tsetActiveLayer={setActiveLayerId}\n\t\t\t\tupdateLayer={updateLayer}\n\t\t\t\taddLayer={addLayer}\n\t\t\t\teditActiveLayerName={editActiveLayerName}\n\t\t\t\tmoveActiveLayer={moveActiveLayer}\n\t\t\t\tdeleteActiveLayer={deleteActiveLayer}\n\t\t\t/>\n\t\t</>\n\t);\n}\nexport default Canvas;","import React, { useState, useEffect } from \"react\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport { Spinner, Text, useTheme, IconButton, IconPlay, IconPause, IconUpload, IconEdit2, IconCheck, Input } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { useSceneDatabase, IScene } from \".\";\nimport Canvas from \"./canvas\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\nimport { useExtendedTheme } from \"../theme\";\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nfunction SceneNameHeader({ name, onUpdate: updateName }: { name: string, onUpdate: (name: string) => void }) {\n\tconst theme = useTheme();\n\tconst [inEdit, setInEdit] = useState(false);\n\tconst [localName, setLocalName] = useState(name);\n\n\tuseEffect(() => {\n\t\tsetLocalName(name);\n\t}, [name]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 200;\n\t\t\t`}\n\t\t>\n\t\t\t{!inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Text variant=\"lead\">{name}</Text>\n\t\t\t\t\t<IconButton icon={<IconEdit2 />} size=\"sm\" variant=\"ghost\" label=\"Edit Name\" onClick={() => setInEdit(true)} />\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{inEdit &&\n\t\t\t\t<>\n\t\t\t\t\t<Input value={localName} onChange={(e) => setLocalName(e.target.value)} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon={<IconCheck />}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tcolor={theme.colors.intent.success.base}\n\t\t\t\t\t\tlabel=\"Save Name\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tupdateName(localName);\n\t\t\t\t\t\t\tsetInEdit(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!localName.trim()}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t}\n\t\t</div >\n\t);\n}\n\nfunction TableDisplayButton({ scene }: { scene: IScene }) {\n\tconst theme = useTheme();\n\tconst [displayedScene, updateDisplayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze, updateTableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n\tif (displayedScene === scene.id) {\n\t\tif (tableFreeze) {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPlay />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Unfreeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.green.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(false)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t\telse {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\ticon={<IconPause />}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tlabel=\"Freeze Table\"\n\t\t\t\t\tcolor={theme.colors.palette.yellow.base}\n\t\t\t\t\tonPress={() => updateTableFreeze(true)}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\t}\n\telse {\n\t\treturn (\n\t\t\t<IconButton\n\t\t\t\ticon={<IconUpload />}\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tlabel=\"Display on Table\"\n\t\t\t\tcolor={theme.colors.text.heading} onPress={() => {\n\t\t\t\t\tupdateDisplayedScene(scene.id);\n\t\t\t\t\tupdateTableFreeze(false)\n\t\t\t\t}}\n\t\t\t/>\n\t\t)\n\t}\n}\n\ntype Props = {};\nconst SceneEditor: React.SFC<Props> = () => {\n\tconst theme = useExtendedTheme();\n\n\tconst match = useRouteMatch<{ id: string }>();\n\tconst [scene, updateScene] = useOneValue(match.params.id);\n\n\tif (!match.params.id) {\n\t\treturn null;\n\t}\n\n\tif (scene === undefined) {\n\t\treturn <Spinner label=\"Loading scene...\" center />\n\t}\n\t\n\tif (scene === null) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-grow: 1;\n\t\t\t`}\n\t\t>\n\t\t\t{/* Header */}\n\t\t\t<div\n\t\t\t\tclassName={css`\n\t\t\t\t\tbackground-color: ${theme.colors.background.layer};\n\t\t\t\t\tpadding: ${theme.spaces.sm} ${theme.spaces.md};\n\t\t\t\t\tbox-shadow: ${theme.shadows.sm};\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\theight: ${theme.headerHeight}px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<SceneNameHeader name={scene.name} onUpdate={(name) => updateScene({ ...scene, name })} />\n\t\t\t\t<div>\n\t\t\t\t\t{/* TODO */}\n\t\t\t\t\t{/* <IconButton icon={<IconRotateCcw />} variant=\"ghost\" label=\"Undo\" />\n\t\t\t\t\t<IconButton icon={<IconRotateCw />} variant=\"ghost\" label=\"Redo\" /> */}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<TableDisplayButton scene={scene} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Canvas */}\n\t\t\t<Canvas scene={scene} onUpdate={updateScene} />\n\t\t</div>\n\t);\n}\nexport default SceneEditor;","import React, { useState } from \"react\";\nimport { List, ListItem, Skeleton, Input, useTheme, IconButton, IconPlusCircle, Button, IconPlus, IconFilm, IconPlay, IconPause } from \"sancho\";\nimport { css } from \"emotion\";\n\nimport { IScene, useSceneDatabase, createNewScene } from \".\";\nimport { useSettingsDatabase, Settings } from \"../settings\";\nimport { useExtendedTheme } from \"../theme\";\n\nconst { useAllValues, createItem } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\nfunction LoadingScenes() {\n  return <List><ListItem primary={<Skeleton animated />} /></List>\n}\n\nfunction NoScenes(props: { onAdd: () => void }) {\n  const theme = useTheme();\n\n  return (\n    <div\n      className={css`\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      `}\n    >\n      <div\n        className={css`\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      `}\n      >\n        <IconFilm size=\"xl\" color=\"#BDBEBF\" />\n        <Button iconBefore={<IconPlus />} variant=\"ghost\" color={theme.colors.text.muted} onClick={props.onAdd}>Add a scene</Button>\n      </div>\n    </div>\n  )\n}\n\nfunction SceneStatusIcon({ scene }: { scene: IScene }) {\n  const theme = useTheme();\n  const [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n  const [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\n  if (displayedScene === scene.id) {\n    if (!tableFreeze) {\n      return <IconPlay color={theme.colors.palette.green.base} />;\n    }\n    else {\n      return <IconPause color={theme.colors.palette.yellow.base} />;\n    }\n  }\n  else {\n    return null;\n  }\n}\n\ntype Props = { onSceneSelect: (scene: IScene) => any, selectedSceneId: string };\nconst SceneList: React.SFC<Props> = ({ onSceneSelect, selectedSceneId }) => {\n  const theme = useExtendedTheme();\n\n  const allScenes = useAllValues();\n  const [searchText, setSearchText] = useState(\"\");\n\n  function addNewScene() {\n    const scene = createNewScene();\n    if (allScenes) {\n      scene.name = `Scene ${allScenes.size + 1}`;\n    }\n    createItem(scene.id, scene);\n    onSceneSelect(scene);\n  }\n\n  if (!allScenes) {\n    return <LoadingScenes />\n  }\n\n  if (allScenes.size === 0) {\n    return <NoScenes onAdd={addNewScene} />\n  }\n\n  let sceneList = Array.from(allScenes.values());\n  if (searchText) {\n    sceneList = sceneList.filter((scene) => scene.name.toLowerCase().includes(searchText.toLowerCase()));\n  }\n\n  return (\n    <List\n      className={css`\n        display: ${theme.sceneListWidth > 0 ? 'flex' : 'none'};\n        width: ${theme.sceneListWidth}px;\n        flex-shrink: 0;\n        flex-direction: column;\n        z-index: 300;\n      `}\n    >\n      <div\n        className={css`\n          display: flex;\n          padding: ${theme.spaces.sm};\n        `}\n      >\n        <Input type=\"search\" placeholder=\"Find a scene...\" onChange={(e) => setSearchText(e.target.value)} value={searchText} />\n        <IconButton icon={<IconPlusCircle />} label=\"Add Scene\" variant=\"ghost\" onClick={addNewScene} />\n      </div>\n      <div\n        className={css`\n          overflow: auto;\n        `}\n      >\n        {sceneList.map((scene) => (\n          <ListItem\n            primary={scene.name}\n            key={scene.id}\n            contentAfter={<SceneStatusIcon scene={scene} />}\n            onPress={() => onSceneSelect(scene)}\n            className={css`\n              background: ${selectedSceneId === scene.id ? theme.colors.intent.primary.dark : undefined} !important;\n            `}\n          />\n        ))}\n      </div>\n    </List>\n  );\n};\nexport default SceneList;","import React from \"react\";\nimport { css } from 'emotion'\nimport { Global } from '@emotion/core'\nimport { useTheme } from 'sancho';\nimport { Helmet } from 'react-helmet';\nimport { Switch, Route, useRouteMatch, useHistory } from \"react-router-dom\";\n\nimport SceneEditor from \"../scene/editor\";\nimport SceneList from \"../scene/list\";\nimport { IScene } from \".\";\n\nfunction useCurrentSelectedScene() {\n  const routeMatch = useRouteMatch();\n  const matchedSceneRoute = useRouteMatch<{ id: string }>({ path: routeMatch.path + '/:id' });\n  return matchedSceneRoute?.params.id;\n}\n\ntype Props = {};\nconst ScenePage: React.SFC<Props> = () => {\n  const theme = useTheme();\n  const history = useHistory();\n  const routeMatch = useRouteMatch();\n\n  const currentSelectedScene = useCurrentSelectedScene();\n\n  function onSceneSelect(scene: IScene) {\n    history.push(`${routeMatch.path}/${scene.id}`)\n  }\n\n  return (\n    <>\n      <Helmet\n        title='D&amp;D Tabletop'\n      />\n      <Global\n        styles={{\n          html: {\n            background: theme.colors.background.default,\n            color: theme.colors.text.default,\n            fontFamily: theme.fonts.base,\n          },\n          body: {\n            padding: 0,\n            margin: 0,\n            width: '100vw',\n            height: '100vh',\n            \"*:focus\": {\n              outline: 'none'\n            },\n            overflow: 'hidden'\n          }\n        }}\n      />\n      <Switch>\n        <Route path={[`${routeMatch.path}`, `${routeMatch.path}/:id`]} exact>\n          <div\n            className={css`\n              display: flex;\n              flex-direction: row;\n              width: 100%;\n              height: 100vh;\n            `}\n          >\n            <SceneList onSceneSelect={onSceneSelect} selectedSceneId={currentSelectedScene!} />\n            <SceneEditor />\n          </div>\n        </Route>\n      </Switch>\n    </>\n  );\n};\nexport default ScenePage;","import React, { useState, useEffect } from 'react';\nimport { useSettingsDatabase, Settings, useTableResolution } from '../settings';\nimport { useSceneDatabase, IScene } from '../scene';\nimport { Stage } from 'react-konva';\nimport { Global } from '@emotion/core';\nimport { Helmet } from 'react-helmet';\nimport { LayerTypeToComponent } from '../scene/layer';\nimport TableViewOverlay, { TableViewLayer } from '../scene/layer/tableView';\n\nconst { useOneValue } = useSceneDatabase();\nconst { useOneValue: useOneSettingValue } = useSettingsDatabase();\n\ntype Props = {};\nconst TablePage: React.SFC<Props> = () => {\n\tconst [displayedScene] = useOneSettingValue(Settings.DISPLAYED_SCENE);\n\tconst [tableFreeze] = useOneSettingValue(Settings.TABLE_FREEZE);\n\tconst [tableResolution] = useTableResolution();\n\n\tconst [scene] = useOneValue(displayedScene as string);\n\tconst [tableScene, setTableScene] = useState<IScene | null>();\n\n\tconst [windowSize, setWindowSize] = useState({ width: window.innerWidth, height: window.innerHeight })\n\n\tuseEffect(() => {\n\t\tif (!tableFreeze && scene) {\n\t\t\tsetTableScene(scene);\n\t\t}\n\t}, [scene, tableFreeze])\n\n\tuseEffect(() => {\n\t\tfunction onResize() {\n\t\t\tsetWindowSize({ width: window.innerWidth, height: window.innerHeight });\n\t\t}\n\t\twindow.addEventListener('resize', onResize);\n\t\treturn () => window.removeEventListener('resize', onResize)\n\t}, [])\n\n\tif (!tableResolution) {\n    return null;\n  }\n\n\treturn (\n\t\t<>\n\t\t\t<Global\n\t\t\t\tstyles={{\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tbackground: 'black',\n\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<Helmet title=\"D&amp;D Table View\" />\n\t\t\t{tableScene &&\n\t\t\t\t<Stage\n\t\t\t\t\t{...windowSize}\n\t\t\t\t\toffsetX={tableScene.table.offset.x}\n\t\t\t\t\toffsetY={tableScene.table.offset.y}\n\t\t\t\t\tscaleX={tableScene.table.scale}\n\t\t\t\t\tscaleY={tableScene.table.scale}\n\t\t\t\t\t// clipFunc={(ctx: CanvasRenderingContext2D) => {\n          //   ctx.beginPath();\n          //   ctx.rect(tableScene.table.offset.x, tableScene.table.offset.y, tableResolution.width, tableResolution.height);\n          //   ctx.rotate(tableScene.table.rotation);\n          //   ctx.closePath();\n          // }}\n\t\t\t\t>\n\t\t\t\t\t{\n\t\t\t\t\t\ttableScene.layers.map((layer) => {\n\t\t\t\t\t\t\tconst Component = LayerTypeToComponent[layer.type];\n\t\t\t\t\t\t\tif (!Component || layer.visible === false) return null;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Component\n\t\t\t\t\t\t\t\t\tkey={layer.id}\n\t\t\t\t\t\t\t\t\tisTable={true}\n\t\t\t\t\t\t\t\t\tlayer={layer}\n\t\t\t\t\t\t\t\t\tonUpdate={() => { }}\n\t\t\t\t\t\t\t\t\tactive={false}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\t<TableViewOverlay\n\t\t\t\t\t\tlayer={{\n\t\t\t\t\t\t\t...TableViewLayer,\n\t\t\t\t\t\t\toptions: tableScene.table\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tisTable={true}\n\t\t\t\t\t\tactive={false}\n\t\t\t\t\t\tonUpdate={() => { }}\n\t\t\t\t\t\tshowBorder={false}\n\t\t\t\t\t\tshowGrid={tableScene.table.displayGrid}\n\t\t\t\t\t/>\n\t\t\t\t</Stage>\n\t\t\t}\n\t\t</>\n\t)\n}\nexport default TablePage;","import React from \"react\";\nimport ScenePage from \"./scene/page\";\nimport TablePage from \"./table/page\";\nimport { IconFilm, IconMap } from \"sancho\";\nimport { Redirect } from \"react-router-dom\";\nimport { SIDEBAR_WIDTH, useSceneSidebarOpen } from \"./theme\";\n\nexport interface IRoute {\n\tname: string;\n\tpath: string;\n\tsidebarIcon: React.ComponentType<any>,\n\tmain: React.ComponentType<any>;\n\tpopout?: boolean;\n\texact?: boolean;\n\tuseOnClick?: () => () => void;\n}\n\nconst routes = {\n\thome: {\n\t\tname: 'Home',\n\t\tpath: '/',\n\t\tsidebarIcon: () => <img width={SIDEBAR_WIDTH / 1.5} height={SIDEBAR_WIDTH / 1.5} src=\"favicon.png\" alt=\"home icon\" />,\n\t\tmain: () => <Redirect to={routes.scenes.path} />,\n\t\texact: true,\n\t},\n\tscenes: {\n\t\tname: 'Scenes',\n\t\tpath: '/scenes',\n\t\tsidebarIcon: IconFilm,\n\t\tmain: () => <ScenePage />,\n\t\tuseOnClick: () => {\n\t\t\tconst [sidebarOpen, setSidebarOpen] = useSceneSidebarOpen()\n\t\t\treturn () => {\n\t\t\t\tsetSidebarOpen(!sidebarOpen)\n\t\t\t}\n\t\t}\n\t},\n\ttable: {\n\t\tname: 'Table View',\n\t\tpath: '/table',\n\t\tsidebarIcon: IconMap,\n\t\tmain: () => <TablePage />,\n\t\tpopout: true,\n\t\texact: true,\n\t}\n} as { [key: string]: IRoute }\n\nexport default routes;","import React from 'react';\nimport { useRouteMatch, Link, useLocation } from 'react-router-dom';\nimport { css } from \"emotion\";\nimport { useTheme, IconButton, Tooltip } from 'sancho';\n\nimport routes, { IRoute } from './routes';\nimport SettingsSidebarItem from './settings';\nimport { useExtendedTheme } from './theme';\n\ntype Props = { route: IRoute }\nconst SidebarItem: React.SFC<Props> = ({ route }) => {\n\tconst theme = useTheme();\n\tconst match = !!useRouteMatch({\n\t\tpath: route.path,\n\t\texact: route.exact\n\t});\n\tconst onClick = route.useOnClick ? route.useOnClick() : undefined;\n\n\tconst inner = (\n\t\t<Tooltip content={route.name} placement=\"right\">\n\t\t\t<IconButton variant=\"ghost\" color={match ? theme.colors.text.default : theme.colors.text.muted} size=\"lg\" icon={<route.sidebarIcon />} label={route.name} />\n\t\t</Tooltip>\n\t);\n\n\tif (match) {\n\t\treturn (\n\t\t\t<div onClick={onClick}>\n\t\t\t\t{inner}\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Link to={route.path} target={route.popout ? '_blank' : undefined}>\n\t\t\t{inner}\n\t\t</Link>\n\t)\n}\n\nconst Sidebar: React.SFC = () => {\n\tconst theme = useExtendedTheme();\n\tconst location = useLocation();\n\n\tconst hideSidebar = Object.keys(routes)\n\t\t.map((routeName) => routes[routeName])\n\t\t.some((route) => route.exact && route.popout && route.path === location.pathname) || location.pathname === routes.home.path;\n\n\tif (hideSidebar) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={css`\n\t\t\t\twidth: ${theme.sidebarWidth}px;\n\t\t\t\theight: 100vh;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tbackground-color: ${theme.colors.background.default};\n\t\t\t\tz-index: 300;\n\t\t\t`}\n\t\t>\n\t\t\t{Object.keys(routes).map(routeName => {\n\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\treturn <SidebarItem key={routeName} route={route} />\n\t\t\t})}\n\t\t\t<div className={css`flex-grow: 1;`} />\n\t\t\t<SettingsSidebarItem />\n\t\t</div>\n\t)\n}\nexport default Sidebar;","import React from 'react';\nimport {\n\tHashRouter as Router,\n\tSwitch,\n\tRoute\n} from 'react-router-dom';\nimport { DarkMode } from 'sancho';\nimport { css } from 'emotion';\n\nimport routes from './routes';\nimport Sidebar from './sidebar';\n\nconst App: React.SFC = () => {\n\treturn (\n\t\t<DarkMode>\n\t\t\t<Router>\n\t\t\t\t<div\n\t\t\t\t\tclassName={css`\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<Sidebar />\n\t\t\t\t\t<Switch>\n\t\t\t\t\t\t{Object.keys(routes).map((routeName) => {\n\t\t\t\t\t\t\tconst route = routes[routeName as keyof typeof routes];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\t\t\tkey={routeName}\n\t\t\t\t\t\t\t\t\tpath={route.path}\n\t\t\t\t\t\t\t\t\texact={route.exact}\n\t\t\t\t\t\t\t\t\tcomponent={route.main}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</Switch>\n\t\t\t\t</div>\n\t\t\t</Router>\n\t\t</DarkMode>\n\t);\n}\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(<App/>, document.getElementById('root'));"],"sourceRoot":""}