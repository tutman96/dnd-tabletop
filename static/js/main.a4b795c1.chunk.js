(this["webpackJsonpdnd-tt"]=this["webpackJsonpdnd-tt"]||[]).push([[0],{138:function(e,t,n){e.exports=n(229)},229:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(37),i=n.n(c),l=n(16),o=n(47),u=n(22),s=n(5),f=n(17),d=n(2),b=n(69),m=n(14),v=n(7),h=n(26),p=n(133),E=n(250),O=n(256),g=n(251),j=n(240),y=n(241),w=n(252),x=n(74),k=n(253),S=n(254),L=n(258),A=n(15),I=n.n(A),N=n(23),D=n(145);function T(e){var t=new D({name:e});return{useAllValues:function(){var e=Object(a.useState)(),n=Object(v.a)(e,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){function e(){t.keys().then(function(){var e=Object(N.a)(I.a.mark((function e(n){var a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Map,e.next=3,Promise.all(n.map(function(){var e=Object(N.a)(I.a.mark((function e(n){var r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getItem(n);case 2:r=e.sent,a.set(n,r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:c(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}e();var n=t.subscribe(e);return function(){n.unsubscribe()}}),[]),r},useOneValue:function(e){var n=Object(a.useState)(void 0),r=Object(v.a)(n,2),c=r[0],i=r[1];return Object(a.useEffect)((function(){t.getItem(e).then((function(e){i(e||null)}));var n=t.subscribe(e,(function(e){return i(e)}));return function(){n.unsubscribe()}}),[e]),[c,function(){var n=Object(N.a)(I.a.mark((function n(a){return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(a),n.next=3,t.setItem(e,a);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()]},createItem:function(e,n){t.setItem(e,n)},storage:t}}var C=n(38),R=n(48),B=n(28),U=function(e){var t=e.rectTransform,n=e.onTransform,c=e.isSelected,i=e.onSelected,l=e.children,o=Object(s.b)(),u=Object(a.useRef)(),f=Object(a.useRef)();return Object(a.useEffect)((function(){var e,t,n;c&&(null===(e=f.current)||void 0===e||e.setNode(u.current),null===(t=f.current)||void 0===t||null===(n=t.getLayer())||void 0===n||n.batchDraw())}),[c]),r.a.createElement(r.a.Fragment,null,r.a.createElement(B.Group,{onClick:function(e){0===e.evt.button?(i(),e.cancelBubble=!0):e.cancelBubble=!1},ref:u,draggable:c,x:t.x,y:t.y,height:t.height,width:t.width,rotation:t.rotation,onDragEnd:function(e){var t=u.current,a=t.scaleX(),r=t.scaleY(),c=t.rotation();n({x:e.target.x(),y:e.target.y(),rotation:c,width:Math.max(5,t.width()*a),height:Math.max(t.height()*r)})},onTransformEnd:function(e){var t=u.current,a=t.scaleX(),r=t.scaleY(),c=t.rotation();t.scaleX(1),t.scaleY(1),n({x:t.x(),y:t.y(),rotation:c,width:t.width()*a,height:t.height()*r})}},l),c&&r.a.createElement(B.Transformer,{ref:f,anchorFill:o.colors.background.overlay,anchorStroke:o.colors.palette.blue.light,rotationSnaps:[0,45,90,135,180,225,270,315],rotateAnchorOffset:20}))},F=n(70),z=n.n(F),_=T("asset_file");function V(){return _}function P(e){return new Promise((function(t){var n=document.createElement("video");n.src=URL.createObjectURL(e),n.addEventListener("loadedmetadata",(function(){t({width:n.videoWidth,height:n.videoHeight})}))}))}var G=V().storage;function M(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(N.a)(I.a.mark((function e(t){var n,a,r,c;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t);case 2:return n=e.sent,a=n.width,r=n.height,c={id:Object(L.a)(),type:H.VIDEO,transform:{x:0,y:0,width:a,height:r,rotation:0}},e.next=8,G.setItem(c.id,t);case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(N.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.removeItem(t.id);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H,X=new z.a({max:524288e3,length:function(e){return e?e.file.size:0},maxAge:36e5});function J(){var e=document.createElement("input");return e.type="file",e.multiple=!0,e.accept="image/*,video/*",e.click(),new Promise((function(t){e.onchange=function(){var e=Object(N.a)(I.a.mark((function e(n){var a,r,c,i;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.target.files){e.next=3;break}return e.abrupt("return");case 3:r=new Array,c=0;case 5:if(!(c<a.length)){e.next=26;break}if(i=a.item(c)){e.next=9;break}return e.abrupt("continue",23);case 9:if(0!==i.type.indexOf("image")){e.next=17;break}return e.t0=r,e.next=13,ee(i);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=23;break;case 17:if(0!==i.type.indexOf("video")){e.next=23;break}return e.t2=r,e.next=21,M(i);case 21:e.t3=e.sent,e.t2.push.call(e.t2,e.t3);case 23:c++,e.next=5;break;case 26:t(r);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}))}function q(e){return K.apply(this,arguments)}function K(){return(K=Object(N.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.type!==H.IMAGE){e.next=5;break}return e.next=3,ne(t);case 3:e.next=8;break;case 5:if(t.type!==H.VIDEO){e.next=8;break}return e.next=8,W(t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return new Promise((function(t){var n=new Image;n.src=URL.createObjectURL(e),n.onload=function(){t({width:n.width,height:n.height})}}))}!function(e){e[e.IMAGE=0]="IMAGE",e[e.VIDEO=1]="VIDEO"}(H||(H={}));var $=V().storage;function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(N.a)(I.a.mark((function e(t){var n,a,r,c;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t);case 2:return n=e.sent,a=n.width,r=n.height,c={id:Object(L.a)(),type:H.IMAGE,transform:{x:0,y:0,width:a,height:r,rotation:0}},e.next=8,$.setItem(c.id,t);case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(N.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.removeItem(t.id);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var re=new z.a({max:20971520,length:function(e){return e?e.file.size:0},maxAge:36e5});var ce=function(e){var t=e.asset,n=e.onUpdate,c=e.selected,i=e.onSelected,l=function(e){var t=Object(a.useState)(re.get(e.id)),n=Object(v.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){if(void 0===r)$.getItem(e.id).then((function(t){var n={file:t};re.set(e.id,n),c(n)}));else if(r&&!r.image){var t=new FileReader,n=document.createElement("img");t.onload=function(){t.result&&(n.src=t.result,r.image=n,re.set(e.id,r),c(Object(m.a)({},r)))},t.readAsDataURL(r.file)}}),[r,e.id]),null===r?null:null===r||void 0===r?void 0:r.image}(t);return r.a.createElement(U,{isSelected:c,onSelected:i,rectTransform:t.transform,onTransform:function(e){n(Object(m.a)(Object(m.a)({},t),{},{transform:e}))}},l&&r.a.createElement(B.Image,{image:l,width:t.transform.width,height:t.transform.height}))},ie=function(e){var t=e.asset,n=e.onUpdate,c=e.selected,i=e.onSelected,l=function(e){var t=Object(a.useState)(X.get(e.id)),n=Object(v.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){void 0===r&&G.getItem(e.id).then((function(t){var n=document.createElement("video");n.src=URL.createObjectURL(t),n.muted=!0,n.autoplay=!0,n.play();var a={file:t,video:n};X.set(e.id,a),c(a)}))}),[r,e.id]),null===r?null:null===r||void 0===r?void 0:r.video}(t);return r.a.createElement(U,{isSelected:c,onSelected:i,rectTransform:t.transform,onTransform:function(e){n(Object(m.a)(Object(m.a)({},t),{},{transform:e}))}},l&&r.a.createElement(B.Image,{image:l,width:t.transform.width,height:t.transform.height}))},le=n(60),oe=n.n(le),ue=n(233),se=n(234),fe=n(134),de=n(120),be=function(e){var t=e.label,n=e.keyboardShortcuts,c=Object(fe.a)(e,["label","keyboardShortcuts"]);return Object(a.useEffect)((function(){if(n&&c.onClick){var e=function(e){n.includes(e.key)&&c.onClick(e)};return window.addEventListener("keyup",e),function(){return window.removeEventListener("keyup",e)}}}),[n,c.onClick]),r.a.createElement(de.a,{content:t,placement:"bottom"},r.a.createElement(p.b,Object.assign({variant:"ghost",label:t},c)))},me=n(132);function ve(){var e=Object(l.a)(["\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 0; left: 0; right: 0;\n\t\t\t\tmin-height: 40px;\n\t\t\t\tbackground-color: ",";\n\t\t\t\tbox-shadow: ",";\n\t\t\t\tz-index: 100;\n\t\t\t"]);return ve=function(){return e},e}var he,pe,Ee=function(e){var t=e.children,n=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(ve(),n.colors.background.tint1,n.shadows.md)},t)},Oe=Object(me.a)([void 0,function(){}],(function(){return Object(a.useState)(void 0)})),ge=function(e){var t=e.children,n=Oe(),c=Object(v.a)(n,1)[0];return Object(a.useEffect)((function(){return c?(i.a.render(r.a.createElement(s.a,null,t),c),function(){return i.a.unmountComponentAtNode(c)}):function(){}}),[t,c]),null},je=function(e){var t=e.children,n=Object(a.useRef)(),c=Oe(),i=Object(v.a)(c,2)[1];return Object(a.useEffect)((function(){i(n.current)}),[n,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Ee,null,r.a.createElement("span",{ref:n})),t)},ye=(he={},Object(C.a)(he,H.IMAGE,ce),Object(C.a)(he,H.VIDEO,ie),he),we=function(e){var t=e.layer,n=e.onUpdate,c=e.active,i=Object(a.useState)(null),l=Object(v.a)(i,2),o=l[0],u=l[1],s=Object(a.useRef)(),f=Object(a.useCallback)(Object(N.a)(I.a.mark((function e(){var a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!t.assets.has(o)){e.next=7;break}return a=t.assets.get(o),t.assets.delete(o),e.next=5,q(a);case 5:n(Object(m.a)({},t)),u(null);case 7:case"end":return e.stop()}}),e)}))),[o,t,n,u]);Object(a.useEffect)((function(){if(s.current&&Array.from(t.assets.values()).some((function(e){return e.type===H.VIDEO}))){var e=new oe.a.Animation((function(){}),s.current);return e.start(),function(){e.stop()}}}),[s,t]),Object(a.useEffect)((function(){c||null===o||u(null)}),[c,o]);var d=Object(a.useMemo)((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(be,{icon:r.a.createElement(ue.a,null),label:"Add Asset",onClick:Object(N.a)(I.a.mark((function e(){var a,r,c,i;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:a=e.sent,r=Object(R.a)(a);try{for(r.s();!(c=r.n()).done;)i=c.value,t.assets.set(i.id,i)}catch(l){r.e(l)}finally{r.f()}n(Object(m.a)({},t));case 6:case"end":return e.stop()}}),e)})))}),r.a.createElement(be,{icon:r.a.createElement(se.a,null),label:"Delete Asset",disabled:null===o,onClick:f,keyboardShortcuts:["Delete","Backspace"]}))}),[t,o,n,f]);return r.a.createElement(r.a.Fragment,null,c&&r.a.createElement(ge,null,d),r.a.createElement(B.Layer,{ref:s},Array.from(t.assets.values()).map((function(e){var a=ye[e.type];return r.a.createElement(a,{key:e.id,asset:e,selected:c&&o===e.id,onSelected:function(){return c&&u(e.id)},onUpdate:function(e){t.assets.set(e.id,e),n(Object(m.a)({},t))}})}))))};!function(e){e[e.ASSETS=0]="ASSETS",e[e.FOG=1]="FOG",e[e.TABLE_OVERLAY=2]="TABLE_OVERLAY"}(pe||(pe={}));var xe=Object(C.a)({},pe.ASSETS,we);function ke(e){var t={id:Object(L.a)(),name:"Untitled",type:e,visible:!0};return e===pe.ASSETS&&(t.assets=new Map),t}function Se(e,t){return Le.apply(this,arguments)}function Le(){return(Le=Object(N.a)(I.a.mark((function e(t,n){var a,r,c,i;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(a=t.layers.indexOf(n))){e.next=3;break}return e.abrupt("return",t);case 3:if(n.type!==pe.ASSETS){e.next=12;break}r=0,c=Array.from(n.assets.values());case 5:if(!(r<c.length)){e.next=12;break}return i=c[r],e.next=9,q(i);case 9:r++,e.next=5;break;case 12:return t.layers.splice(a,1),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ae=T("scene");function Ie(){return Ae}var Ne,De=n(30),Te=n(125),Ce=n.n(Te),Re=n(236),Be=n(237),Ue=n(238),Fe=n(40),ze=n(239),_e=n(242),Ve=n(235),Pe=n(257);function Ge(){var e=Object(l.a)(["padding: ",";"]);return Ge=function(){return e},e}function Me(){var e=Object(l.a)(["\n            display: flex; \n            align-items: center;\n          "]);return Me=function(){return e},e}function Ye(){var e=Object(l.a)(["\n            display: flex; \n            align-items: center;\n          "]);return Ye=function(){return e},e}function We(){var e=Object(l.a)(["margin: 0 ",";"]);return We=function(){return e},e}!function(e){e.DISPLAYED_SCENE="displayed_scene",e.TABLE_FREEZE="table_freeze",e.TABLE_RESOLUTION="table_resolution",e.TABLE_SIZE="table_size"}(Ne||(Ne={}));var Ze=T("settings");function He(){return Ze}var Xe=He().useOneValue;function Je(){var e=Xe(Ne.TABLE_RESOLUTION),t=Object(v.a)(e,2),n=t[0],a=t[1];return null===n?[{width:1920,height:1080},a]:[n,a]}function qe(){var e=Xe(Ne.TABLE_SIZE),t=Object(v.a)(e,2),n=t[0],a=t[1];return null===n?[45,a]:[n,a]}var Ke=function(){var e=Object(s.b)(),t=Je(),n=Object(v.a)(t,2),a=n[0],c=n[1],i=qe(),l=Object(v.a)(i,2),o=l[0],u=l[1],d=Object(f.a)(We(),e.spaces.sm);return void 0===a||void 0===o?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{variant:"h6"},"Table Display Settings"),r.a.createElement(O.b,{label:"Resolution"},r.a.createElement("div",{className:Object(f.a)(Ye())},r.a.createElement(O.a,{type:"number",min:1,placeholder:"width",value:a.width,onChange:function(e){var t=Number(e.target.value);isNaN(t)||c(Object(m.a)(Object(m.a)({},a),{},{width:t}))}}),r.a.createElement("div",{className:d},"x"),r.a.createElement(O.a,{type:"number",min:1,placeholder:"height",value:a.height,onChange:function(e){var t=Number(e.target.value);isNaN(t)||c(Object(m.a)(Object(m.a)({},a),{},{height:t}))}}))),r.a.createElement(O.b,{label:"Screen Size"},r.a.createElement("div",{className:Object(f.a)(Me())},r.a.createElement(O.a,{type:"number",min:1,value:o,onChange:function(e){var t=Number(e.target.value);isNaN(t)||u(t)}}),r.a.createElement("div",{className:d},"inches"))))},Qe=function(){var e=Object(s.b)(),t=Object(a.useState)(!1),n=Object(v.a)(t,2),c=n[0],i=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(de.a,{content:"Settings",placement:"right"},r.a.createElement(p.b,{variant:"ghost",color:e.colors.text.muted,size:"lg",icon:r.a.createElement(Ve.a,null),label:"Settings",onClick:function(){return i(!0)}})),r.a.createElement(Pe.a,{isOpen:c,onRequestClose:function(){return i(!1)},title:"Settings"},r.a.createElement("div",{className:Object(f.a)(Ge(),e.spaces.lg)},r.a.createElement(Ke,null))))};function $e(){var e=Object(l.a)(["\n              background: "," !important;\n            "]);return $e=function(){return e},e}function et(){var e=Object(l.a)(["\n          overflow: auto;\n        "]);return et=function(){return e},e}function tt(){var e=Object(l.a)(["\n          display: flex;\n          padding: ",";\n        "]);return tt=function(){return e},e}function nt(){var e=Object(l.a)(["\n        width: ","px;\n        flex-shrink: 0;\n        display: flex;\n        flex-direction: column;\n        z-index: 300;\n      "]);return nt=function(){return e},e}function at(){var e=Object(l.a)(["\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      "]);return at=function(){return e},e}function rt(){var e=Object(l.a)(["\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      "]);return rt=function(){return e},e}var ct=Ie(),it=ct.useAllValues,lt=ct.createItem,ot=He().useOneValue;function ut(){return r.a.createElement(Re.a,null,r.a.createElement(Re.b,{primary:r.a.createElement(Be.a,{animated:!0})}))}function st(e){var t=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(rt())},r.a.createElement("div",{className:Object(f.a)(at())},r.a.createElement(Ue.a,{size:"xl",color:"#BDBEBF"}),r.a.createElement(Fe.a,{iconBefore:r.a.createElement(ze.a,null),variant:"ghost",color:t.colors.text.muted,onClick:e.onAdd},"Add a scene")))}function ft(e){var t=e.scene,n=Object(s.b)(),a=ot(Ne.DISPLAYED_SCENE),c=Object(v.a)(a,1)[0],i=ot(Ne.TABLE_FREEZE),l=Object(v.a)(i,1)[0];return c===t.id?l?r.a.createElement(y.a,{color:n.colors.palette.yellow.base}):r.a.createElement(j.a,{color:n.colors.palette.green.base}):null}var dt=function(e){var t=e.onSceneSelect,n=e.selectedSceneId,c=Object(s.b)(),i=it(),l=Object(a.useState)(""),o=Object(v.a)(l,2),u=o[0],d=o[1];function b(){var e=function(){var e=ke(pe.ASSETS);return e.name="Layer 1",{id:Object(L.a)(),name:"Untitled",table:{offset:{x:0,y:0},rotation:0,scale:1,displayGrid:!0},layers:[e]}}();lt(e.id,e),t(e)}if(!i)return r.a.createElement(ut,null);if(0===i.size)return r.a.createElement(st,{onAdd:b});var m=Array.from(i.values());return u&&(m=m.filter((function(e){return e.name.toLowerCase().includes(u.toLowerCase())}))),r.a.createElement(Re.a,{className:Object(f.a)(nt(),240)},r.a.createElement("div",{className:Object(f.a)(tt(),c.spaces.sm)},r.a.createElement(O.a,{type:"search",placeholder:"Find a scene...",onChange:function(e){return d(e.target.value)},value:u}),r.a.createElement(p.b,{icon:r.a.createElement(_e.a,null),label:"Add Scene",variant:"ghost",onClick:b})),r.a.createElement("div",{className:Object(f.a)(et())},m.map((function(e){return r.a.createElement(Re.b,{primary:e.name,key:e.id,contentAfter:r.a.createElement(ft,{scene:e}),onPress:function(){return t(e)},className:Object(f.a)($e(),n===e.id?c.colors.intent.primary.dark:void 0)})}))))};function bt(){var e=Object(l.a)(["\n\t\t\t\tflex-grow: 2;\n\t\t\t\twidth: calc(100vw - ","px);\n\t\t\t\theight: calc(100vh - ","px);\n\t\t\t\t\n\t\t\t\tbackground-color: ",";\n\t\t\t\tbackground-image: linear-gradient(45deg, "," 25%, transparent 25%, transparent 75%, "," 75%, ","),\n\t\t\t\tlinear-gradient(45deg, "," 25%, transparent 25%, transparent 75%, "," 75%, ",");\n\t\t\t\tbackground-size: 20px 20px;\n\t\t\t\tbackground-position: 0 0, 10px 10px;\n\t\t\t"]);return bt=function(){return e},e}oe.a.dragButtons=[0,1,2];var mt=function(e){var t=e.children,n=e.draggable,c=Object(s.b)(),i=Object(a.useRef)(null),l=Ce()(i),o=Object(a.useRef)(),u=Object(a.useState)(1),d=Object(v.a)(u,2),b=d[0],m=d[1],h=function(e){var t=Object(a.useState)(!1),n=Object(v.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){function t(t){t.key===e&&c(!0)}var n=function(t){t.key===e&&c(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[c,e]),r}("Shift");return r.a.createElement("div",{ref:i,className:Object(f.a)(bt(),288,Ft,c.colors.background.tint2,c.colors.background.tint1,c.colors.background.tint1,c.colors.background.tint1,c.colors.background.tint1,c.colors.background.tint1,c.colors.background.tint1)},r.a.createElement(B.Stage,{ref:o,width:l.width,height:l.height,draggable:void 0===n||n,onDragStart:function(e){var t;1!==e.evt.buttons||h||(null===(t=o.current)||void 0===t||t.setDraggable(!1))},onMouseUp:function(){var e;null===(e=o.current)||void 0===e||e.setDraggable(void 0===n||n)},scale:{x:b,y:b},onWheel:function(e){e.evt.preventDefault();var t=b,n=o.current,a=n.getPointerPosition();if(a){var r=(a.x-n.x())/t,c=(a.y-n.y())/t,i=e.evt.deltaY;if(0!==i){var l=1+.004*Math.abs(i),u=e.evt.deltaY>0?t/l:t*l;m(u);var s={x:a.x-r*u,y:a.y-c*u};n.position(s),n.batchDraw()}}},onContextMenu:function(e){return e.evt.preventDefault(),!1}},t))},vt=n(129),ht=n(243),pt=n(244),Et=n(245),Ot=n(246),gt=n(247),jt=n(127),yt=n(248),wt=n(249);function xt(){var e=Object(l.a)(["\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\t\tbackground-color: ",";\n\t\t\t\t\t\t"]);return xt=function(){return e},e}function kt(){var e=Object(l.a)(["\n\t\t\t\t\t\t\t\tbackground-color: "," !important;\n\t\t\t\t\t\t\t"]);return kt=function(){return e},e}function St(){var e=Object(l.a)(["\n\t\t\t\t\t\tmax-height: 350px;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t\t"]);return St=function(){return e},e}function Lt(){var e=Object(l.a)(["\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twidth: 300px;\n\t\t\t\t"]);return Lt=function(){return e},e}function At(){var e=Object(l.a)(["\n\t\t\t\tposition: absolute;\n\t\t\t\tright: ",";\n\t\t\t\tbottom: ",";\n\t\t\t"]);return At=function(){return e},e}var It=function(e){var t=e.scene,n=e.activeLayer,a=e.setActiveLayer,c=e.updateLayer,i=e.addLayer,l=e.moveActiveLayer,o=e.deleteActiveLayer,u=t.layers.findIndex((function(e){return e.id===n})),d=u===t.layers.length-1,b=0===u,v=Object(s.b)();return r.a.createElement("div",{className:Object(f.a)(At(),v.spaces.md,v.spaces.md)},r.a.createElement(vt.a,{className:Object(f.a)(Lt())},r.a.createElement(Re.a,{className:Object(f.a)(St())},Array.from(t.layers).reverse().map((function(e){return r.a.createElement(Re.b,{key:e.id,className:Object(f.a)(kt(),n===e.id?v.colors.intent.primary.base:"initial"),contentBefore:r.a.createElement(p.b,{variant:"ghost",label:e.visible?"Hide Layer":"Show Layer",onClick:function(t){c(Object(m.a)(Object(m.a)({},e),{},{visible:!e.visible})),t.preventDefault()},icon:e.visible?r.a.createElement(ht.a,null):r.a.createElement(pt.a,null)}),primary:e.name,contentAfter:r.a.createElement(h.a,{variant:"subtitle"},pe[e.type]),onClick:function(){return a(e.id)}})}))),r.a.createElement("div",{className:Object(f.a)(xt(),v.colors.background.tint1)},r.a.createElement(p.b,{variant:"ghost",disabled:null===n,color:v.colors.intent.danger.base,icon:r.a.createElement(se.a,null),label:"Delete Layer",onClick:o}),r.a.createElement("div",null,r.a.createElement(p.b,{variant:"ghost",disabled:null===n||d,icon:r.a.createElement(Et.a,null),label:"Layer Up",onClick:function(){return l("up")}}),r.a.createElement(p.b,{variant:"ghost",disabled:null===n||b,icon:r.a.createElement(Ot.a,null),label:"Layer Down",onClick:function(){return l("down")}})),r.a.createElement(gt.a,{placement:"top-end",content:r.a.createElement(jt.c,null,r.a.createElement(jt.a,{contentBefore:r.a.createElement(yt.a,null),onPress:function(){return i(pe.ASSETS)}},"Asset Layer"),r.a.createElement(jt.a,{contentBefore:r.a.createElement(wt.a,null),onPress:function(){return i(pe.FOG)},disabled:!0},"Fog Layer"))},r.a.createElement(p.b,{variant:"ghost",icon:r.a.createElement(ze.a,null),label:"Add Layer"})))))},Nt=function(e){var t=e.offset,n=e.rotation,a=e.showGrid,c=e.showBorder,i=Object(s.b)(),l=Je(),o=Object(v.a)(l,1)[0],u=function(){var e=Je(),t=Object(v.a)(e,1)[0],n=qe(),a=Object(v.a)(n,1)[0];if(!t||!a)return null;var r=Math.atan(t.height/t.width),c=a*Math.cos(r);return t.width/c}();if(!o||null===u)return null;var f=new Array;if(a){for(var d=0;d<=o.width;d+=u)f.push({start:{x:d,y:0},end:{x:d,y:o.height}});for(var b=0;b<=o.height;b+=u)f.push({start:{x:0,y:b},end:{x:o.width,y:b}})}return r.a.createElement(B.Layer,null,f.map((function(e,a){return r.a.createElement(B.Line,{key:a,x:t.x,y:t.y,rotation:n,points:[e.start.x,e.start.y,e.end.x,e.end.y],stroke:i.colors.palette.gray.dark,dash:[1,1],strokeWidth:1})})),c&&r.a.createElement(B.Rect,{x:t.x,y:t.y,rotation:n,width:o.width,height:o.height,stroke:i.colors.palette.gray.light,dash:[10,10],strokeWidth:5,listening:!1}))},Dt=function(e){var t=e.scene,n=e.onUpdate,c=Object(a.useState)(null),i=Object(v.a)(c,2),l=i[0],o=i[1];Object(a.useEffect)((function(){null!==l&&t.layers.some((function(e){return e.id===l}))||!t.layers.length||o(t.layers[0].id)}),[l,t]);var u=Object(a.useCallback)((function(e){var a=t.layers.findIndex((function(t){return t.id===e.id}));t.layers[a]=e,n(Object(m.a)({},t))}),[t,n]);function s(){return(s=Object(N.a)(I.a.mark((function e(){var a,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.layers.find((function(e){return e.id===l})))){e.next=7;break}return e.next=4,Se(t,a);case 4:r=e.sent,n(Object(m.a)(Object(m.a)({},r),{},{layers:Object(De.a)(r.layers)})),o(null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement(je,null,r.a.createElement(mt,null,t.layers.map((function(e){var t=xe[e.type];return t&&!1!==e.visible?r.a.createElement(t,{key:e.id,layer:e,onUpdate:u,active:l===e.id}):null})),r.a.createElement(Nt,{offset:t.table.offset,rotation:0,showGrid:t.table.displayGrid,showBorder:!0})),r.a.createElement(It,{scene:t,activeLayer:l,setActiveLayer:o,updateLayer:function(e){var a=t.layers.findIndex((function(t){return t.id===e.id}));t.layers[a]=e,n(Object(m.a)(Object(m.a)({},t),{},{layers:Object(De.a)(t.layers)}))},addLayer:function(e){var a=ke(e);a.name="Layer "+(t.layers.length+1),t.layers.push(a),n(Object(m.a)({},t))},editActiveLayerName:function(e){var a=t.layers.find((function(e){return e.id===l}));a&&(a.name=e,n(Object(m.a)(Object(m.a)({},t),{},{layers:Object(De.a)(t.layers)})))},moveActiveLayer:function(e){var a=t.layers.findIndex((function(e){return e.id===l}));if(-1!==a){var r="up"===e?a+1:a-1;if(r>t.layers.length-1||r<0)return;var c=t.layers[a],i=t.layers[r];t.layers[r]=c,t.layers[a]=i,n(Object(m.a)(Object(m.a)({},t),{},{layers:Object(De.a)(t.layers)}))}},deleteActiveLayer:function(){return s.apply(this,arguments)}}))};function Tt(){var e=Object(l.a)(["\n\t\t\t\t\tbackground-color: ",";\n\t\t\t\t\tpadding: "," ",";\n\t\t\t\t\tbox-shadow: ",";\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\theight: ","px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t"]);return Tt=function(){return e},e}function Ct(){var e=Object(l.a)(["\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-grow: 1;\n\t\t\t"]);return Ct=function(){return e},e}function Rt(){var e=Object(l.a)(["\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 200;\n\t\t\t"]);return Rt=function(){return e},e}var Bt=Ie().useOneValue,Ut=He().useOneValue,Ft=56;function zt(e){var t=e.name,n=e.onUpdate,c=Object(s.b)(),i=Object(a.useState)(!1),l=Object(v.a)(i,2),o=l[0],u=l[1],d=Object(a.useState)(t),b=Object(v.a)(d,2),m=b[0],j=b[1];return Object(a.useEffect)((function(){j(t)}),[t]),r.a.createElement("div",{className:Object(f.a)(Rt())},!o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{variant:"lead"},t),r.a.createElement(p.b,{icon:r.a.createElement(E.a,null),size:"sm",variant:"ghost",label:"Edit Name",onClick:function(){return u(!0)}})),o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{value:m,onChange:function(e){return j(e.target.value)}}),r.a.createElement(p.b,{icon:r.a.createElement(g.a,null),size:"sm",variant:"ghost",color:c.colors.intent.success.base,label:"Save Name",onClick:function(){n(m),u(!1)},disabled:!m.trim()})))}function _t(e){var t=e.scene,n=Object(s.b)(),a=Ut(Ne.DISPLAYED_SCENE),c=Object(v.a)(a,2),i=c[0],l=c[1],o=Ut(Ne.TABLE_FREEZE),u=Object(v.a)(o,2),f=u[0],d=u[1];return i===t.id?f?r.a.createElement(p.b,{icon:r.a.createElement(j.a,null),variant:"ghost",label:"Unfreeze Table",color:n.colors.palette.green.base,onPress:function(){return d(!1)}}):r.a.createElement(p.b,{icon:r.a.createElement(y.a,null),variant:"ghost",label:"Freeze Table",color:n.colors.palette.yellow.base,onPress:function(){return d(!0)}}):r.a.createElement(p.b,{icon:r.a.createElement(w.a,null),variant:"ghost",label:"Display on Table",color:n.colors.text.heading,onPress:function(){l(t.id),d(!1)}})}var Vt=function(){var e=Object(s.b)(),t=Object(u.i)(),n=Bt(t.params.id),a=Object(v.a)(n,2),c=a[0],i=a[1];return t.params.id?void 0===c?r.a.createElement(x.a,{label:"Loading scene...",center:!0}):null===c?null:r.a.createElement("div",{className:Object(f.a)(Ct())},r.a.createElement("div",{className:Object(f.a)(Tt(),e.colors.background.layer,e.spaces.sm,e.spaces.md,e.shadows.sm,Ft)},r.a.createElement(zt,{name:c.name,onUpdate:function(e){return i(Object(m.a)(Object(m.a)({},c),{},{name:e}))}}),r.a.createElement("div",null,r.a.createElement(p.b,{icon:r.a.createElement(k.a,null),variant:"ghost",label:"Undo"}),r.a.createElement(p.b,{icon:r.a.createElement(S.a,null),variant:"ghost",label:"Redo"})),r.a.createElement("div",null,r.a.createElement(_t,{scene:c}))),r.a.createElement(Dt,{scene:c,onUpdate:i})):null};function Pt(){var e=Object(l.a)(["\n              display: flex;\n              flex-direction: row;\n              width: 100%;\n              height: 100vh;\n            "]);return Pt=function(){return e},e}var Gt=function(){var e=Object(s.b)(),t=Object(u.g)(),n=Object(u.i)(),a=function(){var e=Object(u.i)(),t=Object(u.i)({path:e.path+"/:id"});return null===t||void 0===t?void 0:t.params.id}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{title:"D&D Tabletop"}),r.a.createElement(d.a,{styles:{html:{background:e.colors.background.default,color:e.colors.text.default,fontFamily:e.fonts.base},body:{padding:0,margin:0,width:"100vw",height:"100vh","*:focus":{outline:"none"},overflow:"hidden"}}}),r.a.createElement(u.d,null,r.a.createElement(u.b,{path:["".concat(n.path),"".concat(n.path,"/:id")],exact:!0},r.a.createElement("div",{className:Object(f.a)(Pt())},r.a.createElement(dt,{onSceneSelect:function(e){t.push("".concat(n.path,"/").concat(e.id))},selectedSceneId:a}),r.a.createElement(Vt,null)))))},Mt=Ie().useOneValue,Yt=He().useOneValue,Wt=function(){var e=Yt(Ne.DISPLAYED_SCENE),t=Object(v.a)(e,1)[0],n=Yt(Ne.TABLE_FREEZE),c=Object(v.a)(n,1)[0],i=Mt(t),l=Object(v.a)(i,1)[0],o=Object(a.useState)(),u=Object(v.a)(o,2),s=u[0],f=u[1],m=Object(a.useState)({width:window.innerWidth,height:window.innerHeight}),h=Object(v.a)(m,2),p=h[0],E=h[1];return Object(a.useEffect)((function(){!c&&l&&f(l)}),[l,c]),Object(a.useEffect)((function(){function e(){E({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{styles:{body:{background:"black",margin:0,padding:0,overflow:"hidden"}}}),r.a.createElement(b.a,{title:"D&D Table View"}),s&&r.a.createElement(B.Stage,p,s.layers.map((function(e){var t=xe[e.type];return t&&!1!==e.visible?r.a.createElement(t,{key:e.id,layer:e,onUpdate:function(){},active:!1}):null})),r.a.createElement(Nt,{offset:s.table.offset,rotation:0,showGrid:s.table.displayGrid,showBorder:!1})))},Zt=n(255);function Ht(){var e=Object(l.a)(["flex-grow: 1;"]);return Ht=function(){return e},e}function Xt(){var e=Object(l.a)(["\n\t\t\t\twidth: ","px;\n\t\t\t\theight: 100vh;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tbackground-color: ",";\n\t\t\t"]);return Xt=function(){return e},e}var Jt=function(e){var t=e.route,n=Object(s.b)(),a=!!Object(u.i)({path:t.path,exact:t.exact});return r.a.createElement(o.b,{to:t.path,target:t.popout?"_blank":void 0},r.a.createElement(de.a,{content:t.name,placement:"right"},r.a.createElement(p.b,{variant:"ghost",color:a?n.colors.text.default:n.colors.text.muted,size:"lg",icon:r.a.createElement(t.sidebarIcon,null),label:t.name})))},qt=function(){var e=Object(s.b)(),t=Object(u.h)();return Object.keys(Qt).map((function(e){return Qt[e]})).some((function(e){return e.exact&&e.popout&&e.path===t.pathname}))||t.pathname===Qt.home.path?null:r.a.createElement("div",{className:Object(f.a)(Xt(),48,e.colors.background.tint2)},Object.keys(Qt).map((function(e){var t=Qt[e];return r.a.createElement(Jt,{key:e,route:t})})),r.a.createElement("div",{className:Object(f.a)(Ht())}),r.a.createElement(Qe,null))},Kt={home:{name:"Home",path:"/",sidebarIcon:function(){return r.a.createElement("img",{width:32,height:32,src:"favicon.png",alt:"home icon"})},main:function(){return r.a.createElement(u.a,{to:Kt.scenes.path})},exact:!0},scenes:{name:"Scenes",path:"/scenes",sidebarIcon:Ue.a,main:function(){return r.a.createElement(Gt,null)}},table:{name:"Table View",path:"/table",sidebarIcon:Zt.a,main:function(){return r.a.createElement(Wt,null)},popout:!0,exact:!0}},Qt=Kt;function $t(){var e=Object(l.a)(["\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t"]);return $t=function(){return e},e}var en=function(){return r.a.createElement(s.a,null,r.a.createElement(o.a,null,r.a.createElement("div",{className:Object(f.a)($t())},r.a.createElement(qt,null),r.a.createElement(u.d,null,Object.keys(Qt).map((function(e){var t=Qt[e];return r.a.createElement(u.b,{key:e,path:t.path,exact:t.exact,component:t.main})}))))))};i.a.render(r.a.createElement(en,null),document.getElementById("root"))}},[[138,1,2]]]);
//# sourceMappingURL=main.a4b795c1.chunk.js.map